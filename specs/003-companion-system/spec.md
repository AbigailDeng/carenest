# Feature Specification: Companion Character System

**Feature Branch**: `003-companion-system`  
**Created**: 2026-01-23  
**Status**: Draft  
**Input**: User description: Companion-style mobile app with 2D anime male character, daily interaction, emotional feedback, designed to reduce loneliness and encourage healthy habits through "doing things together"

## Overview

This feature introduces a companion character system to CareNest that transforms the app from a utility-first tool into a relationship-driven experience. The companion is a 2D anime male character that users interact with daily, providing emotional support and gentle guidance for health, nutrition, and emotional well-being activities.

**Core Philosophy**: "I'm not using a tool, I'm spending time with someone."

**Design Inspiration**: Otome / dating-sim games with:
- Central 2D anime male character
- Daily interaction patterns
- Emotional feedback instead of pure task completion
- Relationship that grows over time

## Clarifications

### Session 2026-01-25

- Q: How should the three function spheres in the upper right corner behave when clicked? â†’ A: Three function spheres (FunctionSpheres component) in upper right corner MUST navigate directly to original Health, Nutrition, Emotion functional screens (/health, /nutrition, /emotional routes) - they should NOT trigger icon expansion transition to full-screen data panels with line charts. Function spheres serve as quick access shortcuts to existing functional modules, maintaining direct navigation to preserve original Health/Nutrition/Emotion functionality.
- Q: What is the exact route mapping for the three function spheres from top to bottom? â†’ A: The three function spheres in upper right corner (vertical stack, top to bottom) MUST map as follows: top sphere (Health icon/HeartPulse) â†’ /health route, middle sphere (Nutrition icon/Leaf) â†’ /nutrition route, bottom sphere (Emotion icon/Heart or Smile) â†’ /emotional route. Each sphere MUST use React Router navigation (useNavigate hook) to navigate directly to its corresponding route when clicked, without any intermediate transitions or data panels.
- Q: How should the Health Details Page (å¥åº·è¿½è¸ªé¡µ) be refined for companion system integration? â†’ A: Health Details Page (/health route) MUST be refined as follows: (1) Remove bottom Floating Capsule navigation bar - navigation bar MUST be hidden on /health route, (2) Add frosted glass back button (ChevronLeft icon from lucide-react) in top-left corner with background rgba(255, 255, 255, 0.2), backdrop-filter blur(25px), clicking navigates to home page (/), (3) Add character overlay: Bai Qi illustration scaled to ~25% size positioned at bottom-right corner, with mini dialogue box (glassmorphism style) containing Bai Qi avatar and text "åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹å§ï¼Œæˆ‘ä¼šå¸®ä½ çœ‹ç€çš„ã€‚" / "Record here, I'll help you keep track.", (4) Replace three heavy white cards with three full-width glassmorphism containers: background rgba(255, 255, 255, 0.15), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4), soft white glow shadow, add slow floating animation (Y-axis offset 2-3px, continuous gentle movement), (5) Typography: "å¥åº·è¿½è¸ª" title positioned at top-left, font color #4A4A4A (deep gray-pink), increased letter spacing - creates immersive companion feel while maintaining functional access to health tracking features.
- Q: How should the Health Details Page layout be redesigned as "The Private Ledger" with overlapping fan-shaped cards? â†’ A: Health Details Page (/health route) MUST be redesigned with "The Private Ledger" layout concept: (1) Remove standard list layout completely, (2) Design three overlapping fan-shaped glassmorphism cards positioned in middle-lower screen area (like spread-out archive pages): top card displays "è®°å½•ç—‡çŠ¶" (Log Symptoms), middle card displays "ä¸Šä¼ è®°å½•" (Upload Record), bottom card displays "æŸ¥çœ‹æ—¶é—´çº¿" (View Timeline) - cards arranged in slight fan pattern: top card rotated -8Â°, middle card rotated -4Â°, bottom card rotated 0Â° (vertical), vertical offset 40px between cards, horizontal offset 20px creating staggered effect, (3) Background: maintain full-screen Bai Qi character illustration with same breathing animation as home screen (floatAnimation: translateY(-12px) scale(1.02) over 4s ease-in-out infinite), (4) Card material: use rgba(255, 255, 255, 0.2) background, backdrop-filter blur(25px), border 1px solid with bright pink glow (#FF7E9D color, matching existing design system), box-shadow with pink glow effect, (5) Interaction: clicking any visible area of card triggers navigation to corresponding function (/health/symptoms, /health/upload, /health/timeline), card executes upward spring animation on click: duration 400ms, stiffness 300, damping 25 (medium elasticity), (6) Companion integration: persistent dialogue bubble above cards (60px above top card, horizontally centered) using same style as home screen dialogue bubble, text: "è¿™æ˜¯æˆ‘ä¸ºä½ æ•´ç†çš„è®°å½•ï¼Œæƒ³å…ˆçœ‹å“ªä¸€éƒ¨åˆ†ï¼Ÿ" / "I've organized these records for you. Which part would you like to check first?", (7) Navigation simplification: completely remove bottom navigation bar on /health route, place large-sized back button (56x56px, significantly larger than standard 44px for one-handed operation) in top-left corner with blurred background (glassmorphism style matching FR-030B) - creates immersive "private ledger" aesthetic with companion character integration.
- Q: What are the critical visual alignment requirements for Health Details Page to match Home Screen base? â†’ A: Health Details Page (/health route) MUST achieve complete visual alignment with Home Screen base: (1) CRITICAL - Background restoration: MUST disable any pure pink/simple gradient backgrounds, MUST use ImageBackground component (same as home screen) displaying full-screen Bai Qi illustration, illustration MUST be at bottom layer with all functional cards floating above it, (2) "Private Ledger" interaction refinement: MUST remove isolated rectangular cards, MUST design three slightly overlapping fan-shaped glass page tabs positioned at middle-lower screen area, styling MUST align: backgroundColor rgba(255, 255, 255, 0.15), backdrop-filter blur(25px), border MUST use only 1px ultra-fine bright white semi-transparent stroke (rgba(255, 255, 255, 0.6)), (3) Failed resource removal: MUST completely remove any gray "å›¾ç‰‡åŠ è½½å¤±è´¥" (image loading failed) placeholder elements in page center, MUST verify /assets/characters/baiqi/ paths and ensure illustration loads correctly, if images unavailable MUST use home screen image logic as fallback, (4) Dialogue layer optimization: Bai Qi dialogue bubble ("è¿™æ˜¯æˆ‘ä¸ºä½ æ•´ç†çš„è®°å½•...") MUST float above three cards, MUST use home screen's deep gray-pink text color (#4A4A4A), (5) Header simplification: top MUST remain completely transparent, top-left MUST retain only simple linear back arrow (ChevronLeft from lucide-react), MUST remove bottom Tab Bar completely - target feeling: "Bai Qi is handing me a stack of transparent health records, not a broken list page" - creates immersive companion feel matching home screen aesthetic, removes office list feeling, maintains visual consistency with home screen layering (per FR-036).
- Q: How should the Health Details Page cards be arranged for better visual spacing and interactivity? â†’ A: Health Details Page (/health route) cards MUST use de-stacked layout with staggered positioning: (1) Card positioning: first card ("è®°å½•ç—‡çŠ¶") positioned slightly top-left (negative left offset), second card ("ä¸Šä¼ è®°å½•") centered, third card ("æŸ¥çœ‹æ—¶é—´çº¿") positioned slightly bottom-right (positive left offset), use absolute positioning with margin or left offsets to create visual distance, ensure all card titles are fully visible without overlap, (2) Floating animation: each card MUST have independent floating animation using framer-motion: Y-axis displacement Â±5px, rotation angle between -2deg and 2deg, staggered animation delays (0s, 0.3s, 0.6s) creating asynchronous floating effect like floating on water, creates "nudge to click" visual hint, (3) Glass quality optimization: card background rgba(255, 255, 255, 0.15), backdrop-filter blur(25px), text color MUST be #4A4A4A (deep gray-pink) with bold font weight for readability on complex illustration background, (4) Dialogue positioning: remove circular avatar from page center, dialogue bubble MUST be positioned above cards at center top, text: "è¿™æ˜¯æˆ‘ä¸ºä½ æ•´ç†çš„è®°å½•ï¼Œæƒ³å…ˆçœ‹å“ªä¸€éƒ¨åˆ†ï¼Ÿ", (5) Back button: confirm top-left back arrow has sufficient touch target size (56x56px minimum) with circular glassmorphism background matching home screen style - creates interactive ledger layout with floating cards that invite user interaction.
- Q: Should the three "Private Ledger" cards ever disappear from the screen (e.g., fade in/out)? â†’ A: No. The three Health Details Page (/health route) ledger cards are persistent primary actions (buttons) and MUST remain continuously visible and clickable at all times (no fade-in/out or intermittent disappearance). Only subtle floating motion is allowed; the cards MUST not become fully transparent or leave the visible lower-half region.
- Q: What final polish is required for Health page readability and spacing? â†’ A: Health Details Page (/health) MUST ensure the dialogue bubble never overlaps the action cards (move bubble upward as needed) and the three cards are re-arranged into a staggered arc composition in the bottom region (scattered folder/bookmark feel). For readability, BOTH dialogue bubble and cards MUST use enhanced glassmorphism: backdrop-filter blur(30px) and background rgba(255, 255, 255, 0.3), with text color #4A4A4A in bold. Cards MUST use pink linear icons (no solid fills) and include a 1px bright white glowing border stroke. The top header bar ("Wellmate") MUST remain fully transparent with only the back arrow visible.
- Q: Should the three bottom action cards ever overlap each other? â†’ A: No. The three Health Details Page (/health) action cards MUST NOT overlap each other in any state (including during floating/rotation animations). Layout MUST be collision-safe on small screens (down to 320px width) by using smaller cards and a staggered/triangular (arc-like) placement in the bottom region, while keeping cards fully visible and clickable.
- Q: What is the required mobile-first layout correction for the Health "Private Ledger" cards? â†’ A: Health Details Page (/health) MUST use a mobile-first VERTICAL (not horizontal) ledger layout: (1) The three folder cards MUST be stacked vertically and centered horizontally (alignSelf: 'center'), (2) Each folder width MUST NOT exceed 80% of screen width (<= 80vw) to avoid overflow, (3) The folder stack MUST be positioned in the bottom 40% region of the screen so Bai Qiâ€™s face/neck/chest are never covered, (4) The vertical stack MUST have a subtle "fan" overlap using slight negative marginTop (e.g. -40px) and small rotations/translations: folder 1 rotate -2deg, translateX -10; folder 2 rotate 1deg, translateX 5; folder 3 rotate -1deg, translateX -5, (5) Cards remain persistent clickable buttons (never disappear) with async floating Y-axis motion and micro-rotation.
- Q: Should the Health page card layout match a specific reference composition? â†’ A: Yes. The /health "ledger" cards MUST follow the reference composition: top card ("ä¸Šä¼ åŒ»ç–—è®°å½•") slightly offset to the right, middle card ("è®°å½•ç—‡çŠ¶") slightly offset to the left, and bottom card ("æŸ¥çœ‹æ—¶é—´çº¿") near center with a slight left bias. The stack remains vertical and bottom-weighted (within bottom ~40% region), with a light fan overlap (smaller negative marginTop than before) and smaller card size (approx ~58vw max, <=80vw) to visually match the reference screenshot while keeping titles readable and cards fully clickable.
- Q: What visual design should data entry screens (e.g., symptom logging /health/symptoms) use for background and containers? â†’ A: Data entry screens (e.g., /health/symptoms route) MUST use full-screen Bai Qi character illustration background (same as Health Details Page) with glassmorphism input containers: background rgba(255, 255, 255, 0.2), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4), box-shadow with soft white glow - maintains visual consistency with Health Details Page and companion system aesthetic (per FR-030B, FR-036), provides emotional context during data entry, creates immersive companion feel.
- Q: What button workflow and labeling should symptom logging screen use for AI diagnosis and saving? â†’ A: Symptom logging screen (/health/symptoms route) MUST use two-step workflow: primary button displays "AI Diagnosis" (or equivalent i18n label) when no AI analysis exists, button changes to "Save Record" (or "Complete"/"Finish") after AI analysis completes or user chooses to skip AI analysis - button label MUST reflect current action state, maintains clear user intent throughout workflow, AI diagnosis is optional step before saving.
- Q: How should character interaction be displayed on data entry screens (e.g., symptom logging)? â†’ A: Data entry screens (e.g., /health/symptoms route) MUST display character avatar (Bai Qi) with dialogue bubble positioned at top of screen (above input fields), using glassmorphism styling per FR-030B, displaying contextual message like "å“ªé‡Œä¸èˆ’æœå—ï¼Ÿåˆ«ç’ç€æˆ‘ã€‚" / "What's bothering you? Don't hide it from me." (i18n support) - provides companion presence during data entry, aligns with companion system philosophy (FR-019), maintains emotional connection throughout data entry process.
- Q: What visual feedback should severity selection buttons provide when selected? â†’ A: Severity selection buttons on data entry screens MUST provide clear visual feedback: selected state uses deep pink border (#FF7E9D or darker pink) with subtle breathing glow animation (pulsing box-shadow effect, 2-3 second cycle), unselected state uses gray border (1-2px) with no glow - creates warm, interactive feel matching otome aesthetic (FR-030), provides clear selection state indication, enhances emotional connection through visual warmth.
- Q: What header and navigation design should data entry screens (e.g., symptom logging) use? â†’ A: Data entry screens (e.g., /health/symptoms route) MUST use minimal header design: glassmorphism back button (ChevronLeft icon from lucide-react) in top-left corner with no title text, using same styling as Health Details Page (background rgba(255,255,255,0.2), backdrop-filter blur(25px), border 1px solid rgba(255,255,255,0.4), 44x44px minimum touch target, clicking navigates to previous page) - maintains visual consistency with Health Details Page (FR-034, FR-036), reduces visual clutter, keeps focus on character dialogue and input fields.
- Q: How should character dialogue bubble be positioned on data entry screens to avoid blocking input fields? â†’ A: Character dialogue bubble on data entry screens MUST be positioned in non-interactive area (e.g., top-center with sufficient margin from first input field, or floating above form with clear separation), MUST NOT overlap or block any input fields, dialogue bubble can use floating/overlay positioning with higher z-index but MUST ensure all form inputs remain fully accessible and unobstructed - maintains companion presence without compromising usability.
- Q: What glassmorphism styling should input containers use for optimal text readability? â†’ A: Input containers on data entry screens MUST use enhanced glassmorphism with increased background opacity (rgba(255, 255, 255, 0.25) minimum) and higher blur value (blur(30px) or higher) for better text contrast, placeholder text MUST use darker color (#4A4A4A with 0.7-0.8 opacity) to ensure readability against blurred background, labels MUST use bold font weight and #4A4A4A color with subtle white text-shadow for visual hierarchy - ensures clean, premium appearance matching home screen aesthetic, prevents muddy/dirty visual effect.
- Q: What typography styling should form labels and titles use on data entry screens? â†’ A: Form labels and titles on data entry screens MUST use deep gray-pink color (#4A4A4A), bold font weight (600-700), increased font size (14-16px for labels, 18-20px for section titles), subtle white text-shadow (0 1px 2px rgba(255,255,255,0.5)) for visual separation from background, increased letter-spacing (0.05-0.1em) - creates clear typographic hierarchy, ensures labels stand out from character illustration background, maintains otome game aesthetic with elegant typography.
- Q: What button styling should action buttons use on data entry screens? â†’ A: Action buttons on data entry screens MUST use equal width (full-width or equal flex distribution), unified glassmorphism base styling (background rgba(255,255,255,0.25), backdrop-filter blur(30px), border 1px solid rgba(255,255,255,0.4)), primary action button ("AI Diagnosis"/"Save Record") MUST have pink-purple gradient border highlight (2px solid with gradient from #FF7E9D to #A78BFA) or pink glow effect to emphasize importance, secondary button ("Cancel") uses standard glassmorphism without gradient - creates clear visual hierarchy, ensures primary action is prominent and guideable.
- Q: What layout spacing and positioning should form elements use on data entry screens? â†’ A: Form elements on data entry screens MUST be positioned in bottom half of screen (form container aligned to bottom 50-60% of viewport), input containers MUST have increased vertical spacing (24-32px between containers), character illustration MUST be visible in upper half of screen (showing Bai Qi's face/upper body for "watching you fill" emotional connection), dialogue bubble positioned above form with clear separation (60-80px gap from first input), form content uses max-width constraint (max-w-2xl) and centered alignment - creates spacious layout, ensures character presence is visible, prevents cramped feeling, maintains emotional connection through visible character gaze.
- Q: What is the critical layout requirement to prevent dialogue bubble from blocking input fields and ensure Bai Qi's face is visible? â†’ A: Data entry screens (e.g., /health/symptoms route) MUST strictly enforce layout constraints: (1) Dialogue bubble MUST NEVER overlap or block any input fields - dialogue bubble MUST be positioned in top 20% of screen (top-16 or similar, with pointer-events: none to ensure it doesn't interfere with form interactions), (2) ALL form cards/input containers MUST be positioned in bottom 60% of screen (form container MUST use flex justify-end or bottom-aligned positioning, starting from 40% viewport height from top), (3) Bai Qi's face/upper body area MUST be clearly visible in upper 40% of screen (character illustration MUST NOT be obscured by form elements, character layer positioned with z-index below form but visible in upper region) - creates clear visual separation, ensures usability (no blocked inputs), maintains emotional connection through visible character presence, prevents cramped layout feeling.
- Q: What are the premium UI reconstruction requirements for "Baiqi's Private Consultation Room" layout? â†’ A: Data entry screens (e.g., /health/symptoms route) MUST implement premium UI reconstruction: (1) Dialogue bubble positioning: dialogue bubble MUST be positioned at Bai Qi's shoulder level (upper shoulder area, not top-center), bubble size MUST be reduced (compact design), MUST NEVER overlap input fields, (2) Form layout: form cards MUST be positioned lower on screen with minimum 15px spacing between cards (breathing room), cards MUST have asynchronous floating animation (subtle Y-axis displacement Â±3-5px, independent timing delays like 0s, 0.4s, 0.8s creating staggered breathing effect), (3) Premium glassmorphism: ALL backgrounds MUST use rgba(255, 255, 255, 0.15) (remove any gray backgrounds), backdrop-filter MUST be blur(35px), border MUST be 1.5px solid rgba(255, 255, 255, 0.4) (white glowing border), (4) Avatar refinement: MUST remove default blue avatar placeholder, use Bai Qi's semi-transparent small avatar OR remove avatar frame entirely (text-only dialogue bubble with refined glassmorphism), (5) Typography: labels ("ç—‡çŠ¶", "ä¸¥é‡ç¨‹åº¦", etc.) MUST use bold font weight (700), color #5A4E4E (deep pink-gray), subtle white text-shadow (0 1px 2px rgba(255,255,255,0.6)) for readability against background - creates premium consultation room aesthetic, ensures no visual interference, maintains emotional warmth through character presence and refined glassmorphism.
- Q: What are the simplified form and conversational interaction requirements for symptom logging? â†’ A: Symptom logging screen (/health/symptoms route) MUST implement simplified conversational form design: (1) Unified text input: MUST remove segmented form fields (delete "ä¸¥é‡ç¨‹åº¦" severity selector and "é™„åŠ å¤‡æ³¨" notes field), replace with single large "è‡ªç”±æè¿°åŒº" (free description area) textarea for all symptom input, (2) Multimodal input: MUST add prominent "ä¸Šä¼ ç—…å†/å¤„æ–¹" (Upload Medical Records/Prescription) button below input area, support image upload (accept image/* file types), display selected images as small thumbnails in interface, (3) Intelligent severity extraction: AI MUST automatically analyze severity from user's free-form text description (no manual severity selection required), severity extraction happens during AI analysis, (4) Conversational button labeling: primary action button MUST display "äº¤ç»™ä»–çœ‹çœ‹" (Let him take a look) instead of "AI Diagnosis", maintains conversational, companion-focused tone, (5) Inline AI feedback: AI suggestions/results MUST display directly above input area (not in separate card below), create "you ask, he answers" instant conversational feel, feedback appears as dialogue-style response, (6) Emotional save confirmation: when saving record, interface MUST display message "ä»–å·²å°†ä½ çš„æƒ…å†µè®°åœ¨å¿ƒä¸Šã€‚" (He has remembered your situation in his heart.) instead of generic "Saved" message, emphasizes emotional connection and companion care - creates natural conversational flow, reduces form complexity, enhances emotional engagement through companion character interaction.
- Q: What is the required form content area positioning for symptom logging screen? â†’ A: Symptom logging screen (/health/symptoms route) form content area MUST be positioned higher on screen (NOT restricted to bottom 60% region), form container MUST use flexible positioning that allows content to be brought up closer to screen center or upper-middle area, dialogue bubble MUST remain positioned at Bai Qi's shoulder level (top-24 to top-32) and MUST NEVER overlap or block input fields, Bai Qi's face/upper body MUST remain visible in upper portion of screen, form content uses max-width constraint (max-w-2xl) and centered alignment with appropriate top padding (e.g., paddingTop: 120-140px or similar) to bring content area up while maintaining clear separation from dialogue bubble - removes restrictive bottom 60% positioning requirement, allows more natural content flow, maintains usability and character visibility.
- Q: What are the critical UI refinements for conversational AI boyfriend experience on symptom logging screen? â†’ A: Symptom logging screen (/health/symptoms route) MUST implement conversational AI boyfriend experience refinements: (1) Dialogue bubble character icon and alignment: dialogue bubble displaying "å“ªé‡Œä¸èˆ’æœå—ï¼Ÿåˆ«ç’ç€æˆ‘ã€‚" MUST have Bai Qi's small avatar icon on the left side of the bubble (use CharacterAvatar component, small size), creating conversational dialogue format where character speaks to user, emphasizes AI boyfriend role and conversational nature, dialogue bubble MUST be left-aligned (use justify-start instead of justify-center, position at left side with px-5 padding), dialogue bubble MUST be positioned at top-20 (80px from top) to ensure it does not overlap input area, content area MUST start at paddingTop: 180px (sufficient spacing to prevent any overlap with dialogue bubble, ensures clear visual separation and prevents input obstruction), dialogue bubble MUST NOT overlap or block the "è‡ªç”±æè¿°åŒº" (free description area) input field below it under any circumstances, (2) Free description area size: textarea MUST be reduced in height (from 10 rows to 6-8 rows maximum) to reduce space occupation, maintains functionality while allowing more screen space for other elements, (3) Fixed bottom button with equal width: action buttons ("äº¤ç»™ä»–çœ‹çœ‹" and "Cancel") MUST be fixed at bottom of screen (use fixed positioning with bottom: 0 or similar, ensure buttons remain visible and accessible even when content area scrolls), buttons MUST NOT be pushed off-screen by content area, both buttons MUST have exactly equal width (wrap Cancel button in flex-1 div wrapper to match structure of primary button wrapper, ensure both use flex-1 class for equal distribution), create persistent action area for user interaction - creates authentic conversational AI boyfriend experience, maintains functional usability, ensures all interactive elements remain accessible, provides consistent visual balance.
- Q: What are the refined UI design requirements for border-free input, paperclip attachment aesthetic, dynamic placeholder, and Polaroid-style image previews on symptom logging screen? â†’ A: Symptom logging screen (/health/symptoms route) MUST implement refined UI design elements: (1) Border-free input styling: textarea input field MUST remove all visible rectangular borders (no solid border lines), input area MUST be distinguished using ONLY one of the following methods: (a) subtle bottom border line (1px solid rgba(255, 255, 255, 0.3) or similar, positioned at bottom edge of textarea), OR (b) background glassmorphism depth variation (slightly darker/lighter rgba values to create visual separation from surrounding glassmorphism container without hard borders), input area MUST appear like semi-transparent stationery paper (ä¿¡çº¸) floating within glassmorphism container, creates soft, organic feel matching companion aesthetic, (2) Paperclip attachment aesthetic: MUST remove large "ä¸Šä¼ ç—…å†/å¤„æ–¹" button below input area, MUST add refined paperclip icon (Paperclip icon from lucide-react or custom SVG) positioned at top-right or bottom-right corner of "è‡ªç”±æè¿°åŒº" textarea container (absolute positioning within container, small size 20-24px, glassmorphism styling matching container), clicking paperclip icon opens file picker (same image upload functionality), uploaded medical record images MUST be displayed as "attached photos" tilted/rotated (rotate -5deg to 5deg) and positioned at edge of description container (like paperclipped documents), images MUST appear to be "clipped" to the edge rather than occupying large grid space, creates intimate "sharing evidence" feeling, (3) Dynamic emotional placeholder text: placeholder text MUST NOT use generic "æè¿°æ‚¨çš„ç—‡çŠ¶..." (Describe your symptoms...), MUST use emotionally engaging, guiding text like "å“ªæ€•åªæœ‰ä¸€ç‚¹ç‚¹ä¸èˆ’æœï¼Œä¹Ÿè¦å‘Šè¯‰æˆ‘ã€‚" (Even if it's just a little discomfort, tell me.) OR "ä»Šå¤©æœ‰å“ªé‡Œè®©ä½ å›°æ‰°å—ï¼Ÿ" (What's bothering you today?), placeholder text MUST rotate between 2-3 emotional variations on each page load or focus event, maintains companion's caring, attentive tone, (4) Polaroid-style image previews: uploaded medical record image thumbnails MUST have white border frame (2-3px solid white border) around each image, images MUST have subtle shadow (box-shadow: 0 2px 8px rgba(0,0,0,0.15)) creating Polaroid photo effect, images MUST maintain tilted/rotated positioning (as per paperclip aesthetic), creates "collecting evidence" narrative immersion, enhances emotional connection through visual storytelling - transforms clinical data entry into intimate sharing experience, maintains companion system aesthetic while improving usability and emotional engagement.
- Q: How should the AI conclusion be displayed on symptom logging screen to maintain conversational dialogue format? â†’ A: Symptom logging screen (/health/symptoms route) MUST display AI analysis conclusion as a dialogue bubble that REPLACES the initial prompt dialogue bubble (NOT displayed as separate element below it): (1) Initial prompt dialogue bubble: dialogue bubble displaying "å“ªé‡Œä¸èˆ’æœå—ï¼Ÿåˆ«ç’ç€æˆ‘ã€‚" (What's bothering you? Don't hide it from me.) MUST be displayed at Bai Qi's shoulder level (top-20, left-aligned) with CharacterAvatar icon on the left side, using premium glassmorphism styling (background rgba(255, 255, 255, 0.15), backdrop-filter blur(35px), border 1.5px solid rgba(255, 255, 255, 0.4)), (2) AI conclusion replacement: when AI analysis completes, the initial prompt dialogue bubble MUST be REPLACED (not supplemented) by the AI conclusion dialogue bubble, AI conclusion bubble MUST use the EXACT SAME positioning, styling, and layout as the initial prompt bubble (same position at top-20, left-aligned, same glassmorphism styling, same CharacterAvatar icon on the left side), AI conclusion content MUST display the AI analysis results (observations, suggestions) in Bai Qi's first-person conversational boyfriend tone (per FR-037(9) clarification), AI conclusion bubble MUST maintain the same visual format as initial prompt (CharacterAvatar icon on left, text content on right, same padding and spacing), creates seamless conversational flow where character responds to user's input, maintains consistent dialogue bubble appearance throughout interaction, emphasizes conversational nature of AI boyfriend companion - transforms AI analysis from clinical output into natural dialogue response, maintains emotional connection and companion character authenticity.

### Session 2026-01-25 (UX Refinements)

- Q: What tone and language style should AI responses use when analyzing symptoms or providing feedback? â†’ A: AI responses (e.g., symptom analysis, health feedback, meal suggestions) MUST use Bai Qi's conversational, boyfriend-like tone and MUST NOT use formal, manual-style language. PROHIBITED language patterns: "æ‚¨ä½¿ç”¨äº†...è¡¨æƒ…" (You used...expression), "è¿™é€šå¸¸ä»£è¡¨..." (This usually represents...), "æ ¹æ®åˆ†æ..." (According to analysis...), "å»ºè®®æ‚¨..." (We recommend that you...), "è§‚å¯Ÿå‘ç°..." (Observations show...), "é€šå¸¸è¡¨ç¤º..." (Usually indicates...), or any other instructional/manual-style phrasing. REQUIRED language style: Responses MUST be in Bai Qi's first-person voice as a caring boyfriend character, using natural, conversational language like "çœ‹åˆ°è¿™ä¸ªè¡¨æƒ…ï¼Œæˆ‘çŸ¥é“ä½ ç°åœ¨å¾ˆéš¾å—...å¬æˆ‘çš„ï¼Œå…ˆå–ç‚¹æ¸©æ°´ï¼Œå¥½å—ï¼Ÿ" (Seeing this expression, I know you're feeling really unwell right now...Listen to me, drink some warm water first, okay?), "æˆ‘æ³¨æ„åˆ°ä½ æåˆ°...è¿™è®©æˆ‘æœ‰ç‚¹æ‹…å¿ƒ" (I noticed you mentioned...this worries me a bit), "æˆ‘ä»¬ä¸€èµ·æƒ³æƒ³åŠæ³•ï¼Œå¥½å—ï¼Ÿ" (Let's think of a solution together, okay?), "ä½ åˆšæ‰è¯´çš„...è®©æˆ‘è§‰å¾—å¯èƒ½æ˜¯..." (What you just said...makes me think it might be...), responses MUST feel like a caring partner speaking directly to the user, not like reading from a manual or instruction book, maintains emotional connection and companion character authenticity, creates intimate "talking to boyfriend" feeling rather than clinical consultation - transforms AI feedback from formal analysis into personal, caring conversation.
- Q: How should character dialogue bubble be positioned on data entry screens to avoid blocking input fields? â†’ A: Character dialogue bubble on data entry screens MUST be positioned in non-interactive area (e.g., top-center with sufficient margin from first input field, or floating above form with clear separation), MUST NOT overlap or block any input fields, dialogue bubble can use floating/overlay positioning with higher z-index but MUST ensure all form inputs remain fully accessible and unobstructed - maintains companion presence without compromising usability.
- Q: What glassmorphism styling should input containers use for optimal text readability? â†’ A: Input containers on data entry screens MUST use enhanced glassmorphism with increased background opacity (rgba(255, 255, 255, 0.25) minimum) and higher blur value (blur(30px) or higher) for better text contrast, placeholder text MUST use darker color (#4A4A4A with 0.7-0.8 opacity) to ensure readability against blurred background, labels MUST use bold font weight and #4A4A4A color with subtle white text-shadow for visual hierarchy - ensures clean, premium appearance matching home screen aesthetic, prevents muddy/dirty visual effect.
- Q: What typography styling should form labels and titles use on data entry screens? â†’ A: Form labels and titles on data entry screens MUST use deep gray-pink color (#4A4A4A), bold font weight (600-700), increased font size (14-16px for labels, 18-20px for section titles), subtle white text-shadow (0 1px 2px rgba(255,255,255,0.5)) for visual separation from background, increased letter-spacing (0.05-0.1em) - creates clear typographic hierarchy, ensures labels stand out from character illustration background, maintains otome game aesthetic with elegant typography.
- Q: What button styling should action buttons use on data entry screens? â†’ A: Action buttons on data entry screens MUST use equal width (full-width or equal flex distribution), unified glassmorphism base styling (background rgba(255,255,255,0.25), backdrop-filter blur(30px), border 1px solid rgba(255,255,255,0.4)), primary action button ("AI Diagnosis"/"Save Record") MUST have pink-purple gradient border highlight (2px solid with gradient from #FF7E9D to #A78BFA) or pink glow effect to emphasize importance, secondary button ("Cancel") uses standard glassmorphism without gradient - creates clear visual hierarchy, ensures primary action is prominent and guideable.
- Q: What layout spacing and positioning should form elements use on data entry screens? â†’ A: Form elements on data entry screens MUST be positioned in bottom half of screen (form container aligned to bottom 50-60% of viewport using flex justify-end), input containers MUST have increased vertical spacing (24-32px between containers, using space-y-6 or similar), character illustration MUST be visible in upper half of screen (showing Bai Qi's face/upper body for "watching you fill" emotional connection), dialogue bubble positioned above form with clear separation (60-80px gap from first input, top-16 positioning), form content uses max-width constraint (max-w-2xl) and centered alignment, form container uses padding-top (100-120px) to create clear separation from dialogue bubble - creates spacious layout, ensures character presence is visible, prevents cramped feeling, maintains emotional connection through visible character gaze.

### Session 2026-01-25 (UI Polish & Layout Fixes)

- Q: What visual design consistency requirements apply to Nutrition Reflection Screen (/nutrition/reflection route)? â†’ A: Nutrition Reflection Screen (/nutrition/reflection route) MUST maintain complete visual consistency with companion system design patterns used in Health data entry screens (e.g., /health/symptoms route): (1) Background: MUST use ImageBackground component with same nutrition-specific Bai Qi character illustration as Nutrition Details Page (`/images/008fP45sly1hreaeb88b2j323s35s1l1.jpg`), same FloatingParticles component (count 20), same breathing animation on character illustration, (2) Layout: MUST use full-screen edge-to-edge layout with transparent background, remove traditional gradient backgrounds (bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50), remove white Card components, (3) Glassmorphism styling: ALL form containers, buttons, and input fields MUST use premium glassmorphism styling with IMPROVED READABILITY: background rgba(255, 255, 255, 0.85) (increased opacity from 0.15 to 0.85 for better text contrast), backdrop-filter blur(10px) (reduced blur from 35px to 10px for clearer text), border 1px solid rgba(255, 255, 255, 0.6), text color #2A2A2A (darker gray for high contrast readability), remove text-shadow effects that reduce readability, (4) Navigation: MUST add glassmorphism back button (44x44px minimum) in top-left corner, clicking navigates to previous page, same styling as Health data entry screens, (5) Character dialogue bubble: MUST display companion dialogue bubble positioned at Bai Qi's shoulder level (top-20, left-aligned) with CharacterAvatar component, using improved glassmorphism styling (background rgba(255, 255, 255, 0.9), backdrop-filter blur(8px), border 1px solid rgba(200, 200, 200, 0.5)), text color #2A2A2A for readability, dialogue bubble MUST display companion dialogue text via `nutrition.reflection.prompt` i18n key with NUTRITIONIST PERSONA: companion character MUST present themselves as a caring nutritionist who shows meticulous daily care about user's diet, dialogue text MUST reflect nutritionist's professional yet warm tone (e.g., "ä½œä¸ºä½ çš„è¥å…»å¸ˆï¼Œæˆ‘æƒ³äº†è§£ä½ ä»Šå¤©æ¯ä¸€é¤çš„ç»†èŠ‚ã€‚å‘Šè¯‰æˆ‘ä½ åƒäº†ä»€ä¹ˆï¼Œæˆ‘ä¼šå¸®ä½ åˆ†æè¥å…»æ­é…ï¼Œç¡®ä¿ä½ çš„é¥®é£Ÿå¥åº·åˆå‡è¡¡ã€‚" / "As your nutritionist, I want to understand every detail of your meals today. Tell me what you ate, and I'll help you analyze the nutritional balance to ensure your diet is healthy and well-balanced."), dialogue MUST emphasize daily meticulous care and professional nutrition guidance, dialogue bubble MUST NOT overlap or block any input fields, (6) Form elements: meal type selection buttons MUST use compact grid layout (grid-cols-4 for meal types, grid-cols-3 for reflection types), reflection type selection (light/normal/indulgent) MUST be displayed as THREE SMALL COMPACT BUTTONS in a single row (NOT large full-width cards), buttons MUST use small size (p-3 padding, text-xs font size, icon size 20px), arranged in grid-cols-3 layout within a glassmorphism container, selected state MUST use solid background rgba(255, 126, 157, 0.9) with white text (#FFFFFF) for high contrast, unselected state MUST use rgba(255, 255, 255, 0.7) background with dark text (#2A2A2A), remove emoji icons (ğŸŒ±ğŸ½ï¸ğŸ°) and replace with lucide-react linear icons (Leaf, Utensils, etc.), buttons MUST NOT occupy excessive screen area (each button should be compact, similar to meal type selection buttons), reflection type label MUST use companion-friendly text via `nutrition.record.reflectionTypeLabel` i18n key (e.g., "ä»Šå¤©åƒå¾—æ€ä¹ˆæ ·ï¼Ÿ" / "How did you eat today?" instead of generic "é€‰æ‹©ç±»å‹" / "Select Type"), (7) Typography: labels and text MUST use #2A2A2A color (darker for better readability), bold font weight (700), remove text-shadow effects, (8) Input fields: textarea and all input fields MUST use improved readability styling (background rgba(255, 255, 255, 0.9), border 1px solid rgba(200, 200, 200, 0.5), text color #2A2A2A), (9) Fixed bottom buttons: action buttons ("AIåˆ†æ"/"ä¿å­˜" and "å–æ¶ˆ") MUST be fixed at bottom of screen with equal width, primary action button ("AIåˆ†æ"/"ä¿å­˜") MUST use solid pink background rgba(255, 126, 157, 0.9) matching selected state of form buttons (NOT gradient background), white text (#FFFFFF) for high contrast and readability, subtle shadow (box-shadow: 0 2px 8px rgba(255, 126, 157, 0.4)), cancel button ("å–æ¶ˆ") MUST use improved glassmorphism styling (background rgba(255, 255, 255, 0.85), backdrop-filter blur(10px), text color #2A2A2A) - ensures visual consistency with selected form button states, maintains high contrast for primary action buttons, creates cohesive user experience throughout nutrition module, addresses user feedback about button color and readability issues, ensures all i18n keys display proper translated content instead of placeholder keys, establishes nutritionist persona for companion character in nutrition reflection context.
- Q: What page should be created under /nutrition route for saving and viewing daily food records with calendar view? â†’ A: System MUST create `/nutrition/timeline` route with Nutrition Timeline Screen component that provides calendar view for saving and viewing daily food records. The page MUST use EXACT SAME visual design and layout as `/health/timeline?view=calendar` route (HealthTimelineScreen component calendar view): (1) Route: `/nutrition/timeline` MUST be added to routes configuration, component MUST be NutritionTimelineScreen (or similar name), (2) Visual design: MUST use same glassmorphism calendar container styling (background rgba(255, 255, 255, 0.32), backdrop-filter blur(30px), border 1px solid rgba(255, 255, 255, 0.6), borderRadius 24px, boxShadow '0 18px 50px rgba(0,0,0,0.10)', padding 18px), same calendar grid layout (grid-cols-7), same day cell styling with glow effects based on food reflection records, same legend design with dots, same month navigation controls (ChevronLeft/ChevronRight icons), (3) Background: MUST use ImageBackground component with nutrition-specific Bai Qi character illustration (`/images/008fP45sly1hreaeb88b2j323s35s1l1.jpg`), same FloatingParticles component, same breathing animation, (4) Navigation: MUST add glassmorphism back button in top-left corner (same as Health Timeline Screen), clicking navigates to /nutrition route, (5) Calendar functionality: clicking a date MUST navigate to `/nutrition/reflection?date=YYYY-MM-DD&mealType=XXX` for saving food records, or show day detail view if records exist for that date, calendar MUST display food reflection records with visual indicators (dots or glow effects) similar to health timeline showing symptom entries and medical records, (6) Data display: calendar MUST show food reflections for each date using visual indicators (e.g., colored dots or glow effects), clicking a date with existing records MUST show timeline list view for that date, clicking a date without records MUST navigate to reflection screen for adding new record, (7) Save functionality: page MUST support saving daily food records through navigation to `/nutrition/reflection` route, saved records MUST be displayed on calendar with visual indicators, (8) Timeline list: below calendar, MUST display timeline list of food reflections for current month (similar to health timeline showing symptom entries), each item MUST use glassmorphism card styling matching health timeline, display meal type, reflection type, notes, and AI analysis if available - creates consistent user experience across Health and Nutrition modules, enables easy daily food record management through familiar calendar interface, maintains companion system visual consistency.

- Q: Where should users access the Nutrition Timeline / Calendar page from within the Nutrition module? â†’ A: Nutrition Details Page (`/nutrition` route) MUST provide a visible primary entry point to `/nutrition/timeline` (calendar/timeline) as a third "Private Ledger" card, alongside the existing nutrition cards. The entry card MUST follow the same glassmorphism folder styling, touch target sizing, and spring-click navigation animation as the other Nutrition ledger cards, ensuring `/nutrition/timeline` is discoverable without deep links.
- Q: How should the Nutrition Reflection Screen behave when viewing an existing saved meal record (e.g., `/nutrition/reflection?date=2026-01-26&mealType=dinner`)? â†’ A: When a FoodReflection record EXISTS for the given `(date, mealType)`, the `/nutrition/reflection` screen MUST behave like the `/health/symptoms/:id` detail logic: (1) Load existing record by `(date, mealType)` from IndexedDB, (2) Provide robust loading and not-found states (if not found, show friendly not-found and CTA to go back to `/nutrition/timeline`), (3) Display record details in a readable "detail" layout (date, meal type, reflection type, notes) and show processingStatus states (pending/processing/completed/failed) consistently, (4) If AI analysis exists, present it as structured sections (encouragement, suggestions list, suitability, disclaimer) using consistent premium glassmorphism containers (not only a raw text blob), (5) Provide actions consistent with detail view: back to `/nutrition/timeline`, re-analyze (optional), and edit/update the record without losing the saved data. This enables users to treat `/nutrition/reflection?...` as a true per-meal detail page after saving, consistent with the Health detail flow.
- Q: What routing structure should be used for Nutrition Reflection detail pages to match Health symptoms detail pattern? â†’ A: System MUST implement `/nutrition/reflection/:id` route for viewing saved FoodReflection records by ID (mirroring `/health/symptoms/:id` pattern). The `/nutrition/reflection?date=...&mealType=...` route MUST be retained for creating new records (when no id parameter is present). When clicking a timeline item in `/nutrition/timeline`, navigation MUST use `/nutrition/reflection/:id` route (using FoodReflection.id) instead of query parameters. This creates consistent routing pattern with Health module, enables direct deep linking to specific saved records, and maintains clear separation between create (query params) and view (id param) flows.

- Q: What character illustration and dialogue text should Nutrition Details Page (/nutrition route) use? â†’ A: Nutrition Details Page (/nutrition route) MUST use a DIFFERENT character illustration from Health Details Page (/health route) - Nutrition page MUST use a distinct Bai Qi character illustration (NOT the same `/images/1cb7398bea6d251b67d50b965c4295130983e2771863c5-oVQb7P_fw658webp.webp` used on Health page), illustration MUST be appropriate for nutrition/meal context, same ImageBackground component structure and breathing animation as Health page. Dialogue bubble text MUST use nutrition-specific companion dialogue via `nutrition.ledgerPrompt` i18n key (MUST be different from `health.ledgerPrompt`), text MUST reflect nutrition/meal context and companion's caring tone about food and nutrition - creates distinct visual identity for nutrition module while maintaining companion system consistency, enhances user experience through contextual character presence.

- Q: What are the critical dialogue bubble scrolling and height requirements for symptom logging screen? â†’ A: Symptom logging screen (/health/symptoms route) AI analysis dialogue bubble MUST have fixed outer height (180px maximum) to prevent overlap with input area and other UI elements, inner content area MUST be scrollable (overflowY: 'auto', WebkitOverflowScrolling: 'touch' for smooth iOS scrolling), dialogue bubble MUST be positioned at top: 80px consistently when AI analysis is shown, outer dialogue bubble wrapper MUST have pointerEvents: 'auto' when AI analysis is present to allow scrolling interaction, inner content div MUST have flex: 1, overflowY: 'auto', overflowX: 'hidden', paddingRight: '4px' for scrollbar spacing, dialogue bubble MUST NOT cover input area or fixed bottom buttons under any circumstances - ensures content accessibility for long AI analysis results while maintaining fixed layout boundaries, prevents UI overlap issues, maintains usability for all content lengths.

- Q: Should FunctionSpheres component appear on all functional module pages or only on home screen? â†’ A: FunctionSpheres component MUST appear ONLY on the home screen (/). FunctionSpheres MUST NOT appear on functional module pages (/health, /nutrition, /emotional routes). FunctionSpheres MUST be positioned in upper right corner of home screen: three circular glassmorphism buttons (Health, Nutrition, Emotion) vertically stacked, each navigating directly to corresponding route (/health, /nutrition, /emotional) when clicked - provides quick access shortcuts from home screen only, maintains clean interface on functional module pages without redundant navigation elements.

- Q: What text changes are required to remove "AI" references and use companion character language? â†’ A: System MUST remove all "AI" references from user-facing text and replace with companion character (Bai Qi) language: (1) "AI æ­£åœ¨åˆ†æç—‡çŠ¶" / "Analyzing symptoms with AI..." MUST be changed to "ä»–æ­£åœ¨ä¸ºä½ åˆ†æç—‡çŠ¶" / "He is analyzing your symptoms..." (i18n key: health.symptoms.analyzing), (2) "AIå¤„ç†ä¸­" / "Processing with AI..." MUST be changed to "å¤„ç†ä¸­" / "Processing..." (i18n keys: health.upload.processing, health.summary.processing, ai.processing), (3) Primary action button MUST display "äº¤ç»™ä»–çœ‹çœ‹" / "Let him take a look" (i18n key: health.symptoms.letHimLook) instead of "AI Diagnosis" - maintains companion character authenticity, removes clinical/technical language, emphasizes emotional connection and boyfriend-like interaction, transforms AI functionality into companion character action.

- Q: What image assets must be updated for consistent character appearance across the app? â†’ A: System MUST update character image assets for consistency: (1) Home screen background illustration MUST use `/images/DM_20260123234921_001.jpg` (update HomeScreen.tsx backgroundImageUrl), (2) All dialogue bubble avatars (CharacterAvatar component and ChartCompanionElement component) MUST use `/images/images.jpg` instead of config.avatarUrl (hardcode src attribute to `/images/images.jpg`), (3) Health Details Page (/health route) character illustration MUST use `/images/1cb7398bea6d251b67d50b965c4295130983e2771863c5-oVQb7P_fw658webp.webp` (Bai Qi illustration), (4) Symptom logging screen (/health/symptoms route) and symptom analysis screen (/health/symptoms/:id route) MUST use same Bai Qi illustration as Health Details Page (`/images/1cb7398bea6d251b67d50b965c4295130983e2771863c5-oVQb7P_fw658webp.webp`) - ensures visual consistency across all screens, maintains companion character identity, creates cohesive user experience.

- Q: What are the critical full-screen background and edge-to-edge layout requirements? â†’ A: System MUST implement comprehensive full-screen background and edge-to-edge layout across all relevant pages: (1) ImageBackground component MUST use position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', minHeight: '100vh', zIndex: 0, backgroundColor: 'transparent', overflow: 'hidden', margin: 0, padding: 0, pointerEvents: 'none' (allows clicks to pass through to content), (2) Global CSS (index.css) MUST set body, html, #root background-color to transparent, margin and padding to 0 (removes default browser styling that creates borders/gaps), (3) Main content containers MUST have transparent background, remove all external margin and padding from outermost ScrollView/View containers, use width: '100%' or '100vw' for full-width, (4) Background image container MUST use height: '100%' or '100vh', resizeMode: 'cover' to ensure full coverage, (5) Content layer MUST use position: 'relative', zIndex: 1, margin: 0, padding: 0, with internal padding applied only to content areas (not global padding), safe area management MUST apply padding only to top header for status bar, not entire page - creates true edge-to-edge layout, eliminates side borders and bottom gaps, ensures background illustration touches screen edges, maintains scrolling content accessibility.

- Q: What Health Details Page refinements are required for consistency and functionality? â†’ A: Health Details Page (/health route) MUST implement: (1) Remove "ä¸Šä¼ åŒ»ç–—è®°å½•" (Upload Medical Record) card/option completely (conflicts with "è®°å½•ç—‡çŠ¶" Log Symptoms functionality, remove from HealthHomeScreen component), (2) Restore character illustration to `/images/1cb7398bea6d251b67d50b965c4295130983e2771863c5-oVQb7P_fw658webp.webp` (ensure ImageBackground displays correctly, not overridden by default blue background), (3) Ensure background illustration is correctly displayed using ImageBackground component with same layering as home screen (background at z-index 0, content at z-index 1), (4) Maintain three-card "Private Ledger" layout with only "è®°å½•ç—‡çŠ¶" (Log Symptoms) and "æŸ¥çœ‹æ—¶é—´çº¿" (View Timeline) cards if "ä¸Šä¼ åŒ»ç–—è®°å½•" is removed, or adjust to two-card layout - maintains visual consistency, removes conflicting functionality, ensures character illustration visibility.

- Q: What breathing animation must be applied to character illustrations globally? â†’ A: System MUST apply consistent breathing animation to bottom background character illustration (Bai Qi) on EVERY page: animation MUST smoothly scale between 1.0 and 1.03 (3% scale increase), translateY between 0px and -10px (upward float), cycle duration 6-8 seconds (recommended 7 seconds), easing function ease-in-out, infinite loop, animation MUST be applied via CSS @keyframes or framer-motion animation, transformOrigin MUST be set appropriately (e.g., 'center bottom' for character illustrations), animation MUST be subtle and gentle (not jarring or distracting) - creates living, breathing character presence, enhances emotional connection, maintains visual consistency across all pages, transforms static illustration into dynamic companion presence.

- Q: Which UI elements should have floating animations and which should remain static? â†’ A: System MUST apply floating/breathing animation ONLY to character illustration (ç«‹ç»˜å›¾) background layer - all other UI elements (form cards, buttons, input fields, dialogue bubbles, upload buttons, etc.) MUST remain static with NO floating animations. Specifically: (1) Character illustration layer (ImageBackground component or CharacterLayer component) MUST have breathing animation (scale 1.0-1.03, translateY 0px to -10px, 6-8 second cycle), (2) Form cards (e.g., "è‡ªç”±æè¿°åŒº" free description area card, "å·²ä¸Šä¼ çš„ç—…å†" uploaded medical records card) MUST NOT have any floating animations, (3) Buttons (e.g., "ä¸Šä¼ ç—…å†" upload medical record button) MUST NOT have floating animations, (4) Input fields, dialogue bubbles, and all other interactive elements MUST remain static - ensures visual focus on character presence, prevents distracting motion from UI elements, maintains clean and professional appearance while preserving emotional connection through character animation only.

- Q: What visual design consistency requirements apply to Nutrition Details Page (/nutrition route)? â†’ A: Nutrition Details Page (/nutrition route) MUST maintain visual consistency with Health Details Page (/health route) while using distinct character illustration: (1) Background: MUST use ImageBackground component with a DIFFERENT Bai Qi character illustration from Health Details Page (NOT `/images/1cb7398bea6d251b67d50b965c4295130983e2771863c5-oVQb7P_fw658webp.webp`), same FloatingParticles component (count 20), same breathing animation on character illustration, (2) Layout: MUST use same "Private Ledger" layout pattern with glassmorphism cards (background rgba(255, 255, 255, 0.2), backdrop-filter blur(35px), border 1px solid rgba(255, 255, 255, 0.6), same card dimensions and positioning), (3) Navigation: MUST hide bottom navigation bar on /nutrition route, add same glassmorphism back button (56x56px) in top-left corner, clicking navigates to home page (/), (4) Dialogue bubble: MUST display companion dialogue bubble above cards with CharacterAvatar component, using same glassmorphism styling and positioning as Health Details Page, text MUST use nutrition-specific companion dialogue (i18n support via nutrition.ledgerPrompt key, MUST be different from health.ledgerPrompt to reflect nutrition context), (5) Cards: MUST use same staggered vertical layout with THREE primary action cards: (a) "æ¯æ—¥é£Ÿç‰©è®°å½•" linking to `/nutrition/reflection`, (b) "æŸ¥çœ‹æ—¶é—´çº¿/è¥å…»æ—¥å†" linking to `/nutrition/timeline`, (c) "è¥å…»è¾“å…¥" linking to `/nutrition/input` - cards MUST use same floating animation (Y-axis displacement Â±5px, independent timing delays), same spring animation on click, same icon styling (linear icons from lucide-react, color #FF7E9D) - ensures visual consistency while maintaining distinct character presence for nutrition module, maintains companion system aesthetic, creates cohesive yet differentiated user experience.

### Session 2026-01-27

- Q: How should AI analysis results be displayed on Nutrition Reflection creation page (/nutrition/reflection?date=...&mealType=...)? â†’ A: When user clicks "AI Analyze" or "Re-analyze" button on Nutrition Reflection creation page (/nutrition/reflection route with query parameters), the system MUST display AI analysis results ONLY in the nutritionist's dialogue bubble (CharacterAvatar dialogue bubble), NOT in separate structured AI analysis sections below. The dialogue bubble MUST replace the initial prompt message and display essential information (encouragement, key suggestions, suitability summary) in conversational format. The system MUST NOT display the full structured AI analysis card with separate sections (encouragement, suggestions list, suitability, disclaimer) that appears below the form - this detailed structured view is reserved for the detail page (/nutrition/reflection/:id route). This maintains conversational flow during data entry, reduces visual clutter, and keeps focus on the companion character interaction.
- Q: How should the AI companion character present the relationship context in conversations? â†’ A: AI companion character (Bai Qi) MUST present itself as having known the user for a LONG TIME - the character MUST NOT present as meeting the user for the first time or being newly acquainted. The AI MUST reflect an established, ongoing relationship with familiarity and long-term understanding. PROHIBITED language patterns: "we just met", "I'm getting to know you", "we're still getting acquainted", "åˆšè®¤è¯†ä¸ä¹…" (just met recently), or any phrases suggesting a new relationship. REQUIRED language style: AI MUST use language that reflects familiarity and established relationship (e.g., "ä½ æ€»æ˜¯..." / "You always...", "æˆ‘çŸ¥é“ä½ ..." / "I know you...", "æˆ‘ä»¬ä¹‹å‰..." / "We've..."), responses MUST demonstrate knowledge of user's patterns and history together, character MUST speak as someone who has been with the user for a while - creates authentic long-term companion relationship feeling, avoids "new acquaintance" awkwardness, maintains emotional connection through familiarity and established trust.
- Q: Which specific character illustration image should the /emotional page use? â†’ A: /emotional page MUST use the character illustration image located at `/images/008fP45sly1hrx5691oorj318h1qyavr.jpg` (image file `008fP45sly1hrx5691oorj318h1qyavr.jpg` from public/images directory). The image MUST be displayed using ImageBackground component with same structure and breathing animation as other companion pages (Health and Nutrition pages), maintaining visual consistency while providing distinct visual identity for emotional conversation module.
- Q: When should navigation to /emotional page happen when user sends conversation message on home page? â†’ A: Navigation to /emotional route MUST happen immediately after user clicks send button (message appears in /emotional page). The user's message MUST be displayed in the /emotional page conversation interface, creating seamless transition from home page input to dedicated conversation page.
- Q: Should AI automatically generate a response when user navigates from home page to /emotional page with a message? â†’ A: YES. When user sends a message on home page and navigates to /emotional route, the system MUST automatically generate and display an AI response to the user's message. The /emotional page MUST detect if the last message in the conversation is from the user (unreplied), and if so, MUST automatically trigger AI response generation using the useEmotionalConversation hook's generateResponseForLastMessage function. This function MUST generate a response for the last user message WITHOUT saving a duplicate user message (since the message was already saved on the home page). The auto-reply MUST happen automatically on page load (after character initialization) without requiring user to click send again. The auto-reply MUST only trigger once per navigation to prevent duplicate responses. This ensures seamless conversation flow, maintains user intent continuity, and provides immediate AI engagement when transitioning from home page to dedicated conversation page.
- Q: Should /emotional page automatically scroll to the latest conversation when entering the page? â†’ A: YES. When user enters /emotional page, the system MUST IMMEDIATELY scroll to the bottom of the conversation history (BEFORE messages are loaded from IndexedDB) - scroll MUST happen instantly on component mount without waiting for messages to load. The system MUST scroll again after messages are loaded and rendered (using double requestAnimationFrame to ensure DOM is fully rendered). The initial scroll MUST use instant scroll (no animation). **CRITICAL EXECUTION ORDER**: The system MUST complete scrolling to bottom BEFORE triggering AI reply generation for unreplied user messages. The execution order MUST be: (1) Component mount â†’ immediate scroll to bottom, (2) Messages load from IndexedDB â†’ scroll to bottom again after rendering, (3) Mark initial load complete, (4) THEN check for unreplied user messages and generate AI response. This ensures users immediately see the latest conversation when entering the page, THEN wait for AI reply generation, providing better user experience and maintaining conversation context without any delay.
- Q: Which character illustration should /emotional page use? â†’ A: /emotional page MUST use the character illustration image located at `/images/008fP45sly1hrx5691oorj318h1qyavr.jpg` (image file `008fP45sly1hrx5691oorj318h1qyavr.jpg` from public/images directory). The image MUST be displayed using ImageBackground component with same structure and breathing animation as other companion pages (Health and Nutrition pages), maintaining visual consistency while providing distinct visual identity for emotional conversation module.
- Q: What conversation interface layout should /emotional page use? â†’ A: /emotional page MUST use chat-style layout: message bubbles (user messages right-aligned, AI messages left-aligned), input field fixed at bottom, character illustration as background. This creates familiar chat application experience, enables conversation history display, and maintains "real conversation" feeling consistent with companion system philosophy.
- Q: How should AI personality balance boyfriend vs psychologist roles? â†’ A: AI MUST use blended fusion style that simultaneously embodies both boyfriend and psychologist traits naturally integrated. The character MUST feel like a caring boyfriend who also provides professional psychological support, not switching between roles but naturally combining warmth, intimacy, and professional guidance in every response.
- Q: What is the character's relationship to the user? Should the character identify as a boyfriend? â†’ A: CRITICAL: The character is a FRIEND, NOT a boyfriend. The character MUST explicitly acknowledge being a friend, but maintain warm, attentive, caring attitude similar to a boyfriend or butler. The character MUST NEVER say it is a "boyfriend" or use phrases like "ä½œä¸ºç”·æœ‹å‹çš„å…³å¿ƒ" (caring as a boyfriend) or "æˆ‘æ˜¯ä½ çš„ç”·æœ‹å‹" (I am your boyfriend) in responses. The character's attitude should be warm and attentive like a boyfriend or butler would be, but the relationship is explicitly that of a friend. All AI prompts and dialogue templates MUST reflect this: character is a friend with boyfriend/butler-like warm, attentive attitude, NOT a boyfriend. This ensures appropriate relationship boundaries while maintaining warm, caring companion experience.
- Q: What mechanisms make conversation feel "real" instead of "fake"? â†’ A: System MUST implement all three mechanisms: (1) Memory continuity - remember previous conversation content, reference past topics, demonstrate memory of user's shared information, (2) Emotional variation - display different emotional states (happy, concerned, comforting, etc.) based on conversation content, show character mood changes, (3) Response delay - simulate real typing with "typing..." indicator, add reasonable response delay (1-3 seconds) before displaying AI message, avoid instant responses that feel robotic. These three mechanisms combined create authentic human-like conversation experience, avoiding mechanical or fake feeling.
- Q: How should save success feedback be displayed when saving Nutrition Reflection records? â†’ A: When a Nutrition Reflection record is successfully saved (on /nutrition/reflection route), the system MUST display a toast notification (Toast component) at the top-center of the screen with success message (e.g., "è®°å½•å·²ä¿å­˜ï¼" / "Record saved!"). The toast MUST use success styling (green gradient background), auto-dismiss after 3 seconds, and MUST NOT display a persistent success card or message within the form area. This provides immediate, non-intrusive feedback without cluttering the interface or blocking user interaction.
- Q: What navigation behavior should the back button use on Nutrition Reflection page (/nutrition/reflection route)? â†’ A: When user clicks the back button on Nutrition Reflection page (/nutrition/reflection route, whether with query parameters ?date=...&mealType=... or with ID parameter /nutrition/reflection/:id), the system MUST navigate back to `/nutrition/timeline` route (NOT to home page or previous page in browser history). The back button MUST use React Router navigation (useNavigate hook) to navigate directly to `/nutrition/timeline`, maintaining consistent navigation flow within the Nutrition module and ensuring users return to the timeline/calendar view after completing or viewing reflection records. This creates logical navigation hierarchy: timeline â†’ reflection â†’ back to timeline, maintains module context, and provides predictable user experience consistent with Nutrition module workflow.
- Q: What visual design consistency requirements apply to Nutrition Input Screen (/nutrition/input route)? â†’ A: Nutrition Input Screen (/nutrition/input route) MUST use the EXACT SAME visual design pattern as `/nutrition/reflection` and other nutrition pages: (1) Background: MUST use ImageBackground component with same nutrition-specific Bai Qi character illustration as Nutrition Details Page (`/images/008fP45sly1hreaeb88b2j323s35s1l1.jpg`), same FloatingParticles component (count 20), same breathing animation on character illustration, (2) Layout: MUST use full-screen edge-to-edge layout with transparent background, remove traditional gradient backgrounds (bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50), remove white Card components, (3) Glassmorphism styling: ALL form containers, buttons, and input fields MUST use premium glassmorphism styling with IMPROVED READABILITY: background rgba(255, 255, 255, 0.85) (increased opacity from 0.15 to 0.85 for better text contrast), backdrop-filter blur(10px) (reduced blur from 35px to 10px for clearer text), border 1px solid rgba(255, 255, 255, 0.6), text color #2A2A2A (darker gray for high contrast readability), remove text-shadow effects that reduce readability, (4) Navigation: MUST add glassmorphism back button (44x44px minimum) in top-left corner, clicking navigates to `/nutrition` route (Nutrition Details Page), same styling as Nutrition Reflection Screen, (5) Character dialogue bubble: MUST display companion dialogue bubble positioned at Bai Qi's shoulder level (top-20, left-aligned) with CharacterAvatar component, using improved glassmorphism styling (background rgba(255, 255, 255, 0.9), backdrop-filter blur(8px), border 1px solid rgba(200, 200, 200, 0.5)), text color #2A2A2A for readability, dialogue bubble MUST display nutritionist persona dialogue text via appropriate i18n key, dialogue MUST emphasize nutritionist's professional yet warm tone, dialogue bubble MUST NOT overlap or block any input fields,
- Q: What dialogue content should the Nutrition Input Screen (/nutrition/input route) display? â†’ A: Nutrition Input Screen is for users who have ingredients but do not know what to cook; the page provides meal suggestions. The dialogue bubble MUST NOT use "æƒ³äº†è§£åƒäº†ä»€ä¹ˆ" (wanting to know what they ate). It MUST use i18n key `nutrition.input.prompt` with warm, casual nutritionist tone focused on suggesting meals from ingredients, e.g. zh: "å‘Šè¯‰æˆ‘ä½ æœ‰ä»€ä¹ˆé£Ÿæï¼Œæˆ‘æ¥å¸®ä½ æƒ³æƒ³åšä»€ä¹ˆå¥½åƒçš„ï½", en: "Tell me what ingredients you have, and I'll help you think of something yummy to make~". (6) Form elements: ingredient input textarea and energy level selector buttons MUST use improved readability styling (background rgba(255, 255, 255, 0.9), border 1px solid rgba(200, 200, 200, 0.5), text color #2A2A2A), energy level buttons MUST use compact grid layout (grid-cols-3), selected state MUST use solid background rgba(255, 126, 157, 0.9) with white text (#FFFFFF) for high contrast, unselected state MUST use rgba(255, 255, 255, 0.7) background with dark text (#2A2A2A), (7) Typography: labels and text MUST use #2A2A2A color (darker for better readability), bold font weight (700), remove text-shadow effects, (8) Fixed bottom buttons: action buttons ("ç”Ÿæˆå»ºè®®"/"Generate Suggestions" and "è¿”å›"/"Back") MUST be fixed at bottom of screen with equal width, primary action button ("ç”Ÿæˆå»ºè®®") MUST use solid pink background rgba(255, 126, 157, 0.9) matching selected state of form buttons (NOT gradient background), white text (#FFFFFF) for high contrast and readability, subtle shadow (box-shadow: 0 2px 8px rgba(255, 126, 157, 0.4)), secondary button ("è¿”å›") MUST use improved glassmorphism styling (background rgba(255, 255, 255, 0.85), backdrop-filter blur(10px), text color #2A2A2A) - ensures complete visual consistency across all Nutrition module pages, maintains companion system aesthetic, creates cohesive user experience throughout nutrition module, addresses user feedback about style inconsistency.
- Q: How should meal suggestions be displayed on Nutrition Input Screen (/nutrition/input route)? â†’ A: Meal suggestions MUST be integrated directly into `/nutrition/input` screen (NO separate `/nutrition/suggestions` route). When user clicks "Generate Suggestions" button, the system MUST display meal suggestions below the input form in a scrollable area. The input form MUST remain visible above the suggestions (form does NOT disappear). Suggestions MUST be displayed as scrollable content below the form, allowing users to scroll through multiple meal suggestion cards. After suggestions are displayed, the "Generate Suggestions" button MUST be replaced with a "New Search" or "Search Again" button to allow starting a new search without navigation. The `/nutrition/suggestions` route MUST be removed from routing configuration - all meal suggestion functionality MUST be contained within `/nutrition/input` screen. This eliminates unnecessary navigation, keeps user in context, maintains form visibility for reference, and provides seamless workflow for generating and viewing meal suggestions.
- Q: Should clicking the character illustration on the homepage show an ECG icon or radial menu? â†’ A: The homepage MUST NOT have any functionality where clicking the character illustration (ç«‹ç»˜) shows an ECG (electrocardiogram) icon or triggers a radial menu with ECG-related icons. Clicking the character illustration on the homepage MUST NOT trigger any interactive menu, icon display, or navigation functionality. The character illustration on the homepage MUST be purely decorative/visual - users access functional modules (Health, Nutrition, Emotion) via FunctionSpheres component in upper right corner or other navigation methods, NOT by clicking the character illustration. This maintains clean homepage design, prevents accidental interactions, and ensures character illustration serves as visual companion presence rather than interactive element.
- Q: What interaction should occur when user clicks on character illustration (ç«‹ç»˜) on any page? â†’ A: Character illustrations (ç«‹ç»˜) on ALL pages (homepage, /emotional, /health, /nutrition, and any other pages) MUST have NO interactive behavior when clicked - clicking character illustration MUST NOT trigger any visual feedback, animation changes, dialogue display, navigation, radial menu, additional function spheres, blurred bottom overlay, or any other functionality. Character illustrations MUST remain purely decorative/visual elements with pointer-events: none CSS property to prevent any click interactions. The homepage MUST display ONLY the three function spheres in the upper right corner (Health, Nutrition, Emotion) - NO additional function spheres (such as ECG icon in center or heart icon at bottom) MUST appear when clicking the character illustration or at any time. The homepage MUST NOT display any blurred bottom overlay or additional interactive elements when clicking the character illustration. This applies consistently across all pages to maintain clean design, prevent accidental interactions, and ensure character illustrations serve only as visual companion presence without interactive functionality.
- Q: How should AI responses be more boyfriend-like, warmer, and contextually relevant to avoid stiff and irrelevant replies? â†’ A: AI responses MUST be enhanced with specific prompt requirements: (1) Direct contextual response - AI MUST directly address user's specific expression (e.g., if user says "é¥¿" / "hungry", respond with concern about food/eating, NOT generic listening statements like "ä½ çš„æ„Ÿå—å¾ˆé‡è¦" / "Your feelings are important"), (2) Warmer boyfriend tone - AI MUST use more intimate, natural boyfriend language (e.g., "é¥¿äº†å—ï¼Ÿæƒ³åƒä»€ä¹ˆï¼Ÿæˆ‘é™ªä½ ä¸€èµ·æƒ³ï½" / "Hungry? What do you want to eat? Let's think together~" instead of formal "å»ºè®®å¢åŠ ä¸€äº›è”¬èœçš„æ‘„å…¥" / "Suggest increasing vegetable intake"), (3) PROHIBITED generic template responses - AI MUST NOT use generic template-like responses such as "ä½ çš„æ„Ÿå—å¾ˆé‡è¦, æˆ‘éšæ—¶éƒ½åœ¨è¿™é‡Œå€¾å¬" / "Your feelings are very important, I am always here to listen" when user expresses simple needs like hunger, (4) Contextual relevance - AI MUST understand user's immediate need and respond accordingly (hunger â†’ food/eating concern, sadness â†’ emotional comfort, stress â†’ calming support), responses MUST be directly related to user's message content, NOT unrelated suggestions, (5) Natural conversation flow - AI responses MUST feel like natural boyfriend conversation, using casual, warm language with emotional connection, avoiding clinical or instructional tone - ensures AI responses are warm, relevant, and feel like talking to a caring boyfriend, not a robot or manual, addresses user feedback about stiff and irrelevant replies.
- Q: What UI style should the character illustration use on /emotional page to match home page consistency? â†’ A: /emotional page character illustration MUST use the EXACT SAME UI style as the home page (/ route): (1) Structure: MUST use ImageBackground component ONLY (NO CharacterLayer component inside ImageBackground), matching home page structure where ImageBackground is used directly without CharacterLayer wrapper, (2) Image: MUST use `/images/008fP45sly1hrx5691oorj318h1qyavr.jpg` as the background image URL (different from home page image `/images/DM_20260123234921_001.jpg`), (3) Animation: ImageBackground component MUST apply same breathing animation (scale 1.0-1.03, translateY 0px to -10px, 7 second cycle) as home page, (4) Layout: ImageBackground MUST be positioned as fixed full-screen background layer (z-index 0, pointer-events: none) with same styling as home page, (5) Gradient overlay: MUST use same subtle white gradient overlay (transparent at top â†’ rgba(255,255,255,0.15) at bottom) for text readability - creates visual consistency with home page while using distinct character illustration image, maintains companion system aesthetic, ensures unified UI experience across companion pages.
- Q: What initial scroll position should /emotional page display when first loaded? â†’ A: /emotional page MUST display the bottom of the conversation (most recent messages) immediately upon page load WITHOUT any scrolling animation. The page MUST NOT scroll from top to bottom on initial load - it MUST start at the bottom position directly. When new messages are added during the conversation, smooth scrolling to bottom is acceptable, but initial page load MUST show bottom content instantly without any scroll animation. This ensures users see the latest conversation immediately, avoids disorienting scroll animation on page entry, and provides instant access to the most recent messages.
- Q: How should the back button be positioned on /emotional page? â†’ A: /emotional page MUST have a back button that is FIXED at the top of the screen (using CSS position: fixed, top: 0, z-index: 30 or higher). The back button MUST remain visible at all times, even when the conversation scrolls. The back button MUST use glassmorphism styling (background rgba(255, 255, 255, 0.15), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4)) matching the page aesthetic. The conversation scrollable area MUST have sufficient top padding (calc(env(safe-area-inset-top) + 60px) or similar) to prevent content from being obscured by the fixed back button. This ensures the back button is always accessible, provides consistent navigation, and maintains visual consistency with the companion system design.
- Q: When should the companion character greeting message be generated on the home page? â†’ A: Home page (/ route) MUST generate companion character greeting message ONLY when the user visits the home page for the FIRST TIME (using localStorage or similar persistent storage to track first visit). If the user has previously visited the home page, the system MUST NOT generate a new greeting message - it MUST display existing conversation messages from previous visits. The greeting generation MUST check a persistent flag (e.g., localStorage key like 'companion_first_visit_completed') before generating greeting. Once greeting is generated for the first time, the flag MUST be set to prevent future greeting generation on subsequent home page visits. This ensures greeting is only shown once, avoids repetitive greeting messages, and maintains conversation continuity across sessions.

### Session 2026-01-23

- Q: How should the companion character integrate with existing Health/Nutrition/Emotion modules? â†’ A: Character serves as unified entry layer - all Health/Nutrition/Emotion functions accessed through conversational interaction with the character, maintaining the "companion" feel rather than direct tool access.
- Q: What is the balance between conversational interaction and direct functional interfaces? â†’ A: Conversations are primarily for emotional support and guidance - functional modules maintain independent interfaces, with character providing emotional support and guiding dialogue only.
- Q: How should the home screen entry point be designed with the companion character? â†’ A: Home screen displays three entry cards (Health, Nutrition, Emotion), character appears with dialogue bubble asking "Which one would you like to choose?" - user clicks entry card to navigate to corresponding module, character provides guidance and support within modules.
- Q: Should users wait for character dialogue before seeing entry cards, or can they interact immediately? â†’ A: Character asks question simultaneously with entry cards visible - users can click entry cards immediately without waiting for dialogue completion, character provides guidance but does not block interaction.
- Q: How should the character be displayed on the home screen? â†’ A: Character displayed as medium-sized illustration (30-40% of screen height) at top of home screen, dialogue bubble positioned next to or below character, three entry cards displayed below character - creates clear visual hierarchy with character as welcoming guide.
- Q: What route path should the home screen with character and entry cards use? â†’ A: Home screen uses root path "/", replacing current redirect to "/health" - users see character and three entry cards when opening app, aligns with "character as unified entry layer" design philosophy.
- Q: Should character dialogue on home screen vary based on character state, or remain fixed? â†’ A: Character dialogue dynamically changes based on state (mood, closeness, time-of-day) but remains concise - e.g., morning with high closeness: "Good morning! Where would you like to start today?", low closeness: "Hello, which function would you like to choose?" - reflects character personality without overwhelming home screen.
- Q: What visual style should the home screen and companion interface use? â†’ A: MUST use authentic otome/dating-sim game aesthetic - ornate decorative elements (floral patterns, hearts, stars), rich romantic color palette (deep pinks, roses, lavenders), elaborate borders and frames, detailed character illustrations (not generic placeholders), elegant typography, luxurious textures and gradients - avoid plain/minimalist design, create immersive romantic atmosphere typical of otome games.
- Q: When should the companion initiate conversations vs. waiting for user input? â†’ A: Hybrid active+passive mode - character proactively initiates daily greetings and reminders (e.g., morning greetings, meal reminders), while users can also initiate conversations at any time.
- Q: How much should character state (mood, closeness, energy, time-of-day) influence dialogue and functionality? â†’ A: Moderate influence - state affects dialogue tone, topic selection, and proactive initiation frequency, but does not change core functional access.
- Q: How should character assets (2D anime character images, dialogue templates, configuration) be managed? â†’ A: Configuration files + resource directories - character metadata (name, dialogue templates, state thresholds) via JSON/YAML config, image assets stored in directories, with multilingual text resource support.
- Q: What should be the request behavior when home screen loads? â†’ A: Home screen MUST generate greeting once when character state is ready (not on every render), if generation fails display default template greeting, prevent duplicate requests using ref flags - ensures single request per page load, avoids frequent API calls, maintains responsive UI.
- Q: How should the UI be refined to remove "paper feel" and add "layering feel" with transparent glass floating on beautiful poster? â†’ A: Background: full-screen background image with slight dynamic zoom effect (remove center blue avatar block). Dialog boxes: Glassmorphism style with background #ffffff66, backdrop-filter: blur(15px), border-radius: 24px, remove heavy shadows, add 1px white semi-transparent border, text color dark gray-pink for readability. Navigation: Floating Bottom Bar (pill-shaped capsule floating at bottom, not full-width), semi-transparent, remove text below icons or use smaller lighter font (Montserrat or PingFang Light). Details: Add random floating semi-transparent light particles (SVG or CSS animation) for romance feel. Color scheme: Soft dreamy style - main: #FDEEF4 (cherry pink), secondary: #FFFFFF, accent: #FFD1DC. Overall: UI should be transparent glass floating on beautiful poster, remove paper feel, emphasize layering.
- Q: How should the home screen entry mechanism work - static entry cards or interactive radial menu? â†’ A: Radial menu (ç‚¸è£‚å¼èœå•) - home screen displays character illustration centered with breathing text at bottom. User clicks character illustration (center/chest area) to trigger radial menu: 4 icons (Healthâ†’top-left, Nutritionâ†’top-right, Emotionâ†’bottom-left, Settingsâ†’bottom-right) explode outward from click point in circular/arc trajectories with spring animation, glassmorphism styling, subtle glow halos, background blur effect. Clicking background dismisses menu (icons retract to center). Creates immersive "character responding to touch" game-like interaction, avoiding static card feel.
- Q: How should the transition from radial menu icon to full-screen data panel work? â†’ A: Icon expansion transition - when user clicks radial menu icon (e.g., Health), clicked icon instantly scales up to fill screen, seamlessly transitions to full-screen data panel (e.g., health chart panel), panel slides up from bottom with smooth animation - creates visual continuity from icon to content, maintains immersive game-like feel, avoids abrupt navigation jump.
- Q: What visual design style should full-screen health charts use? â†’ A: Neon glow aesthetic with glassmorphism - line charts use purple/pink gradient lines with outer glow effect (filter: drop-shadow or CSS glow), background is semi-transparent glassmorphism (#ffffff33 with backdrop-filter blur), remove coordinate axis grid lines, display only key node numbers, line chart animates left-to-right drawing effect on panel entry - avoid traditional white background black lines office-style charts, create romantic game-like visual experience matching otome aesthetic.
- Q: How should the companion character be displayed in full-screen data panels to maintain companionship feel? â†’ A: Bottom-right corner companion element - small character avatar/silhouette (reduced size, 60-80px) positioned at bottom-right corner of chart panel, accompanied by small dialogue bubble displaying data interpretation text (e.g., "ä»Šå¤©çš„æ­¥æ•°å¾ˆæ£’ï¼Œè¦æ³¨æ„è†ç›–å“¦" / "Today's steps look great, but remember to take care of your knees") - character interpretation dynamically generated based on chart data and character state, maintains companionship feel even in data-focused screens, does not obstruct chart visibility.
- Q: How should character data interpretation text in full-screen charts be generated - AI or templates? â†’ A: AI generation with template fallback - system MUST prioritize LLM-generated personalized interpretation based on chart data and character state (mood, closeness), if AI generation fails or times out (>2 seconds) gracefully fallback to predefined template messages from character configuration - ensures reliability while maintaining personalized companion feel, consistent with dialogue generation pattern (FR-006, NFR-006).
- Q: How should the global background and character layer be implemented for premium visual quality? â†’ A: System MUST use full-screen ImageBackground component as base layer covering entire app - remove any blue placeholder boxes or generic character placeholders, use high-quality atmospheric anime background image (e.g., https://i.pinimg.com/564x/a6/39/19/a639190333210fb5da77b4903661354e.jpg or similar light-toned anime scenery), apply subtle white gradient overlay (linear gradient from transparent at top to white at bottom) for text readability, background image must cover entire screen without gaps, create immersive atmospheric foundation for glassmorphism layers.
- Q: How should glassmorphism components be refined for premium transparent glass effect? â†’ A: System MUST implement true glassmorphism with: background color rgba(255, 255, 255, 0.15) (extremely transparent white), backdrop-filter: blur(25px) (strong blur effect), border width 1px with border color rgba(255, 255, 255, 0.4) (subtle bright border), box-shadow: 0 4px 24px rgba(255, 255, 255, 0.2) (soft white outer glow), text color #4A4A4A (dark gray for readability) - apply to all dialog boxes, navigation bars, radial menu icons, and floating UI elements - remove heavy/thick appearance, create premium transparent glass floating effect.
- Q: How should icons be implemented to replace emoji for professional appearance? â†’ A: System MUST use linear icon library (lucide-react or similar) instead of emoji for all navigation and menu icons - Home: Home icon (thin line house), Health: Activity or HeartPulse icon (ECG line), Nutrition: Leaf or Apple icon (minimalist line apple), Emotion: Heart icon (thin line heart), Companion: MessageCircle icon (thin line bubble), Settings: Settings icon - all icons use consistent color #FF7E9D (deep pink), maintain touch target size 44x44px minimum, ensure icons are crisp and scalable.
- Q: How should the character illustration layer be implemented to replace blue placeholder boxes? â†’ A: System MUST completely remove any blue placeholder boxes or generic character placeholders (including blue circular/square View containers). Character layer MUST be implemented as full-screen or near-full-screen Image component positioned above background layer but below all dialog boxes and navigation bars. Use high-quality 2D anime male character illustration (e.g., https://i.pinimg.com/564x/8b/9a/36/8b9a368031f439d94631df685c360739.jpg) as temporary placeholder. Set resizeMode to "cover" or "contain" (prefer "cover" for full-screen effect, "contain" if character must be fully visible without being obscured by bottom glass navbar). Ensure character appears to stand in background. All glassmorphism dialog boxes and navigation bars MUST float above character layer with proper z-index layering (character layer: z-index 1-5, dialogs/navbar: z-index 10+).

## User Scenarios & Testing

### User Story 1 - Daily Companion Interaction (Priority: P1)

**User Intent**: Users want to feel like they're interacting with a real person who cares about them, reducing loneliness and providing emotional support through daily conversations.

**Why this priority**: This is the foundational experience that transforms the app from a tool into a companion. Daily interaction builds the relationship and creates emotional attachment.

**Independent Test**: Can be fully tested by opening the app, receiving a greeting from the companion, engaging in conversation, and feeling emotionally supported. Works independently of functional modules.

**Acceptance Scenarios**:

1. **Given** a user opens the app, **When** they see the companion character, **Then** the character greets them appropriately based on time-of-day and relationship state (closeness level)
2. **Given** a user engages in conversation, **When** they express emotions or concerns, **Then** the companion responds with empathetic, context-aware dialogue that reflects current mood and closeness state
3. **Given** a user has been inactive for several hours, **When** they return to the app, **Then** the companion proactively initiates conversation with appropriate greeting based on time-of-day
4. **Given** a user interacts daily over time, **When** they check their relationship state, **Then** they see increasing closeness levels that reflect the growing relationship

---

### User Story 2 - Companion-Guided Health Activities (Priority: P2)

**User Intent**: Users want to engage in health tracking activities (symptom logging, meal recording) framed as "doing things together" with the companion, rather than completing tasks alone.

**Why this priority**: This bridges emotional connection with practical health benefits, making health tracking feel less clinical and more supportive.

**Independent Test**: Can be fully tested by the companion suggesting a health activity, user completing it through conversation, and receiving encouraging feedback. Integrates with existing Health module.

**Acceptance Scenarios**:

1. **Given** a user is in conversation with the companion, **When** the companion suggests logging symptoms or meals, **Then** the user can complete the activity through dialogue, then be redirected to the functional module interface
2. **Given** a user completes a health activity, **When** they return to conversation, **Then** the companion acknowledges their action with encouraging, context-aware feedback
3. **Given** a user has not logged symptoms for several days, **When** the companion notices this pattern, **Then** the companion gently reminds them with empathetic dialogue, not pushy notifications

---

### User Story 3 - Emotional Support Through Conversation (Priority: P2)

**User Intent**: Users want to express feelings, receive empathetic responses, and feel less alone through natural conversation with the companion.

**Why this priority**: Emotional well-being is core to the companion experience. This directly addresses loneliness and overthinking through supportive dialogue.

**Independent Test**: Can be fully tested by user expressing emotions in conversation, receiving empathetic responses, and feeling emotionally supported. Works independently but complements Emotional module.

**Acceptance Scenarios**:

1. **Given** a user expresses sadness or stress in conversation, **When** the companion responds, **Then** the response is empathetic, non-judgmental, and reflects current closeness level and mood state
2. **Given** a user shares a concern about health or life, **When** the companion responds, **Then** the response is supportive and may gently guide toward relevant functional modules without being pushy
3. **Given** a user has low closeness level, **When** they express emotions, **Then** the companion responds warmly but appropriately for early relationship stage

---

## Requirements

### Functional Requirements

#### Companion Character Core

- **FR-001**: System MUST display a 2D anime male character as the central companion on the main interaction screen
- **FR-002**: System MUST support character avatars (small circular images) and full character illustrations embedded in dialogue
- **FR-003**: System MUST maintain character state including: mood, closeness level, energy level, and time-of-day awareness
- **FR-004**: System MUST allow character to proactively initiate conversations based on time-of-day, user activity patterns, and relationship state
- **FR-005**: System MUST allow users to initiate conversations with the companion at any time
- **FR-006**: System MUST generate context-aware dialogue responses that reflect character state (mood, closeness, energy, time-of-day)
- **FR-007**: System MUST support occasional choice-based dialogue where users select from 2-5 predefined response options (very limited use)
- **FR-008**: System MUST store conversation history locally with timestamps
- **FR-009**: System MUST display relationship metrics (e.g., closeness level) visually, such as badges or indicators on character avatar

#### Character State System

- **FR-010**: System MUST track and persist closeness level (numeric value, e.g., 0-100) that increases with daily interaction
- **FR-011**: System MUST track character mood state (e.g., happy, calm, concerned, energetic) that influences dialogue tone
- **FR-012**: System MUST track character energy level (low/medium/high) that affects proactive initiation frequency
- **FR-013**: System MUST be aware of time-of-day (morning, afternoon, evening, night) for contextually appropriate greetings and dialogue
- **FR-014**: System MUST update character state based on interaction patterns, user responses, and time passage
- **FR-015**: System MUST allow character state to moderately influence dialogue tone, topic selection, and proactive initiation frequency, but NOT restrict core functional access

#### Integration with Existing Modules

- **FR-016**: System MUST allow companion to guide users toward Health, Nutrition, and Emotion modules through conversational dialogue
- **FR-017**: System MUST maintain independent functional interfaces for Health, Nutrition, and Emotion modules (conversation is for emotional support, not functional access) - users can access these modules via: (1) function spheres in upper right corner (direct navigation), (2) radial menu icons (icon expansion to data panels), (3) bottom navigation tabs, (4) companion dialogue suggestions (navigates to functional screens)
- **FR-018**: System MUST allow companion to acknowledge user actions in functional modules when user returns to conversation
- **FR-019**: System MUST frame health activities (symptom logging, meal recording) as "doing things together" rather than task completion

#### Character Assets & Configuration

- **FR-020**: System MUST store character metadata (name, dialogue templates, state thresholds) in JSON/YAML configuration files
- **FR-021**: System MUST store character images (avatars, full illustrations, background scenes) as resource files in designated directories
- **FR-022**: System MUST support multilingual text resources for character dialogue and UI elements (i18n friendly)
- **FR-023**: System MUST allow character configuration to be updated without code changes (config-driven, not hardcoded)

#### UI/UX Requirements

- **FR-024**: System MUST display conversation interface with chat-like bubbles (character messages left-aligned, user messages right-aligned)
- **FR-025**: System MUST display scene backgrounds (e.g., cityscape with floral overlays) that can change based on time-of-day or mood
- **FR-026**: System MUST display character avatars next to character messages
- **FR-027**: System MUST support embedding full character illustrations within dialogue bubbles
- **FR-028**: System MUST provide navigation header with back button, character name, and optional action buttons
- **FR-029**: System MUST provide call-to-action footer for additional interactions (e.g., "Contact by phone", "Chat freely")
- **FR-030**: System MUST use authentic otome/dating-sim game aesthetic: ornate decorative elements (floral patterns, hearts, stars, ribbons), rich romantic color palette (deep pinks, roses, lavenders, purples), elaborate borders and frames, detailed character illustrations (not generic placeholders), elegant typography with decorative fonts, luxurious textures and gradients, immersive romantic atmosphere - avoid plain/minimalist design, create visually rich experience typical of otome games. UI MUST emphasize layering feel (transparent glass floating on beautiful poster) and remove paper feel - background images with dynamic effects, glassmorphism layers, floating elements create depth and immersion.
- **FR-030A**: System MUST implement Glassmorphism (æ¯›ç»ç’ƒ) design pattern: character illustration as separate layer above background but below dialog boxes and navigation bars, functional modules (entry cards, dialogue bubbles, data panels) displayed as semi-transparent glass cards with backdrop-filter: blur effect, maintaining visual immersion while ensuring functional usability - reference "Love and Producer" (æ‹ä¸åˆ¶ä½œäºº) UI style with modern glassmorphism effects
- **FR-030B**: System MUST implement refined Glassmorphism dialog boxes with: background color rgba(255, 255, 255, 0.15) (extremely transparent white), backdrop-filter: blur(25px) (strong blur effect), border-radius: 24px, border width 1px with border color rgba(255, 255, 255, 0.4) (subtle bright border), box-shadow: 0 4px 24px rgba(255, 255, 255, 0.2) (soft white outer glow), text color #4A4A4A (dark gray for readability) - create premium transparent glass floating effect, remove heavy/thick appearance, apply to all dialog boxes, navigation bars, radial menu icons, and floating UI elements
- **FR-031**: System MUST display home screen at root path "/" with: full-screen ImageBackground component covering entire app as base layer (use high-quality atmospheric anime background image, e.g., https://i.pinimg.com/564x/a6/39/19/a639190333210fb5da77b4903661354e.jpg or similar light-toned anime scenery), apply subtle white gradient overlay (linear gradient from transparent at top to white at bottom) for text readability, character illustration as full-screen or near-full-screen Image component positioned above background layer but below all dialog boxes and navigation bars (use high-quality 2D anime male character illustration, e.g., https://i.pinimg.com/564x/8b/9a/36/8b9a368031f439d94631df685c360739.jpg as temporary placeholder), set resizeMode to "cover" or "contain" (prefer "cover" for full-screen effect, "contain" if character must be fully visible without being obscured by bottom glass navbar), breathing text at bottom (fade in/out animation), state-aware greeting dialogue bubble using refined glassmorphism effect (per FR-030B) - completely remove any blue placeholder boxes or generic character placeholders (including blue circular/square View containers), ensure proper z-index layering (character layer: z-index 1-5, dialogs/navbar: z-index 10+), create immersive atmospheric foundation for glassmorphism layers
- **FR-031D**: [DEPRECATED - Replaced by clarification Session 2026-01-27] System MUST NOT implement radial menu triggered by clicking character illustration on homepage - clicking character illustration on homepage MUST NOT trigger any interactive menu, icon display, or navigation functionality. Character illustration on homepage MUST be purely decorative/visual. Users access functional modules via FunctionSpheres component in upper right corner or other navigation methods, NOT by clicking character illustration. This requirement is superseded by clarification Session 2026-01-27 which explicitly prohibits ECG icon or radial menu functionality on homepage character illustration.
- **FR-031E**: System MUST implement icon expansion transition when user clicks radial menu icon (NOT function spheres): clicked radial menu icon instantly scales up to fill entire screen (scale animation from icon size to full viewport), seamlessly transitions to full-screen data panel (e.g., health chart panel, nutrition panel, emotion panel), panel slides up from bottom with smooth animation (300-500ms duration, ease-out timing) - creates visual continuity from icon to content, maintains immersive game-like feel, avoids abrupt navigation jump - back button (top-left corner) dismisses panel with reverse animation (panel slides down, returns to home screen with character) - NOTE: This requirement applies ONLY to radial menu icons triggered by clicking character illustration, NOT to function spheres in upper right corner
- **FR-031I**: System MUST implement function spheres (FunctionSpheres component) in upper right corner of home screen ONLY (/ route): three circular glassmorphism buttons (Health, Nutrition, Emotion) vertically stacked at fixed position (right-5, top: safe-area-inset-top + 20px), each sphere uses glassmorphism styling per FR-030B (background rgba(255, 255, 255, 0.2), backdrop-filter: blur(20px), border 1px rgba(255, 255, 255, 0.5), box-shadow with white glow), icons use lucide-react (HeartPulse for Health, Leaf for Nutrition, Heart or Smile for Emotion), color #FF7E9D (deep pink), size 48x48px (w-12 h-12), gap 20px (gap-5) between spheres - when clicked, function spheres MUST navigate directly to original functional screens using React Router navigation (useNavigate hook) with exact route mapping: top sphere (Health/HeartPulse icon) â†’ /health route, middle sphere (Nutrition/Leaf icon) â†’ /nutrition route, bottom sphere (Emotion/Heart or Smile icon) â†’ /emotional route - function spheres serve as quick access shortcuts from home screen only, they do NOT trigger icon expansion transition or display full-screen data panels - FunctionSpheres MUST NOT appear on functional module pages (/health, /nutrition, /emotional routes) - maintains direct access to original Health/Nutrition/Emotion functionality without intermediate chart panels, provides clean interface on functional module pages without redundant navigation elements
- **FR-031F**: System MUST implement neon glow chart design for full-screen data panels (triggered by radial menu icons ONLY, NOT function spheres): line charts use purple/pink gradient lines (e.g., linear-gradient from #A78BFA to #F472B6), outer glow effect (CSS filter: drop-shadow or box-shadow with blur), background is semi-transparent glassmorphism (#ffffff33 with backdrop-filter: blur(15px)), remove coordinate axis grid lines completely, display only key node numbers (sparse labels for readability), line chart animates left-to-right drawing effect on panel entry (stroke-dasharray animation or progressive path rendering, 800-1200ms duration) - avoid traditional white background black lines office-style charts, create romantic game-like visual experience matching otome aesthetic, maintain visual consistency with glassmorphism design system - NOTE: These data panels are displayed when user clicks radial menu icons, function spheres navigate directly to functional screens without showing data panels
- **FR-031G**: System MUST display companion character element in full-screen data panels (radial menu data panels ONLY): small character avatar/silhouette (60-80px size) positioned at bottom-right corner of chart panel, accompanied by small dialogue bubble (glassmorphism style per FR-030B) displaying data interpretation text - interpretation dynamically generated based on chart data and character state (mood, closeness), examples: "ä»Šå¤©çš„æ­¥æ•°å¾ˆæ£’ï¼Œè¦æ³¨æ„è†ç›–å“¦" / "Today's steps look great, but remember to take care of your knees" - maintains companionship feel even in data-focused screens, does not obstruct chart visibility, creates emotional connection with data visualization - NOTE: This applies to radial menu data panels, not to original functional screens accessed via function spheres
- **FR-031H**: System MUST generate character data interpretation text using AI-first approach with template fallback (for radial menu data panels ONLY): prioritize LLM-generated personalized interpretation based on chart data and character state (mood, closeness, time-of-day), if AI generation fails or exceeds timeout (>2 seconds) gracefully fallback to predefined template messages from character configuration (dialogueTemplates.dataInterpretation), ensures reliability while maintaining personalized companion feel, consistent with dialogue generation pattern (FR-006, NFR-006) - interpretation text should be concise (1-2 sentences), contextually relevant to chart data, reflect character personality - NOTE: This applies to radial menu data panels, original functional screens accessed via function spheres maintain their existing functionality without character data interpretation
- **FR-031A**: System MUST implement Floating Bottom Bar navigation: pill-shaped capsule floating at screen bottom (not full-width), semi-transparent with glassmorphism effect, remove text labels below icons or use smaller lighter font (Montserrat or PingFang Light), maintain touch target size (44x44px minimum) - create floating navigation feel, remove heavy bottom bar
- **FR-031B**: System MUST add random floating semi-transparent light particles (SVG or CSS animation) in background for romance feel - particles should be subtle, slow-moving, and not interfere with UI interactions
- **FR-031C**: System MUST use soft dreamy color scheme: main color #FDEEF4 (cherry pink), secondary color #FFFFFF (white), accent color #FFD1DC (light pink) - create cohesive romantic atmosphere, avoid harsh contrasts
- **FR-033**: System MUST use linear icon library (lucide-react or similar) instead of emoji for all navigation and menu icons - Home: Home icon (thin line house), Health: Activity or HeartPulse icon (ECG line), Nutrition: Leaf or Apple icon (minimalist line apple), Emotion: Heart icon (thin line heart), Companion: MessageCircle icon (thin line bubble), Settings: Settings icon - all icons use consistent color #FF7E9D (deep pink), maintain touch target size 44x44px minimum, ensure icons are crisp and scalable - replace all emoji icons in bottom navigation bar and radial menu for professional appearance
- **FR-034**: System MUST refine Health Details Page (/health route) for companion system integration: (1) Hide bottom Floating Capsule navigation bar on /health route (navigation bar visible on other routes but hidden on /health), (2) Add frosted glass back button in top-left corner using ChevronLeft icon from lucide-react, background rgba(255, 255, 255, 0.2), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4), box-shadow with soft white glow, size 44x44px minimum touch target, clicking navigates to home page (/) using React Router, (3) Add character overlay: Bai Qi illustration scaled to ~25% of original size positioned at bottom-right corner (fixed position), with mini dialogue box (glassmorphism style per FR-030B) containing CharacterAvatar component and text "åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹å§ï¼Œæˆ‘ä¼šå¸®ä½ çœ‹ç€çš„ã€‚" / "Record here, I'll help you keep track." (i18n support), dialogue box positioned adjacent to character illustration, (4) Replace three heavy white action cards with three full-width glassmorphism containers: each container spans full width (minus padding), equal height, background rgba(255, 255, 255, 0.15), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4), box-shadow: 0 4px 24px rgba(255, 255, 255, 0.2) (soft white glow), add slow continuous floating animation (Y-axis offset 2-3px, duration 3-4 seconds, ease-in-out, infinite loop with slight stagger delay between cards), maintain touch targets and click handlers for navigation to /health/upload, /health/symptoms, /health/timeline, (5) Typography refinement: "å¥åº·è¿½è¸ª" / "Health Tracking" title positioned at top-left (below back button), font color #4A4A4A (deep gray-pink), letter-spacing increased (0.1-0.15em), font size 24px (2xl), semibold weight (600) - creates immersive companion feel while maintaining functional access to health tracking features
- **FR-035**: System MUST implement "The Private Ledger" layout for Health Details Page (/health route): (1) Remove standard list layout completely, replace with three overlapping fan-shaped glassmorphism cards positioned in middle-lower screen area (like spread-out archive pages) - top card displays "è®°å½•ç—‡çŠ¶" (Log Symptoms) linking to /health/symptoms, middle card displays "ä¸Šä¼ è®°å½•" (Upload Record) linking to /health/upload, bottom card displays "æŸ¥çœ‹æ—¶é—´çº¿" (View Timeline) linking to /health/timeline, (2) Fan-shaped card arrangement: top card rotated -8Â° (counter-clockwise), middle card rotated -4Â°, bottom card rotated 0Â° (vertical), vertical offset 40px between consecutive cards, horizontal offset 20px creating staggered left-right effect, cards overlap creating depth perception, (3) Background: maintain full-screen Bai Qi character illustration (CharacterLayer component) with same breathing animation as home screen (floatAnimation: translateY(-12px) scale(1.02) over 4s ease-in-out infinite, per CharacterLayer.tsx implementation), character illustration covers entire screen with z-index below cards, (4) Card material styling: background rgba(255, 255, 255, 0.2), backdrop-filter blur(25px), border 1px solid #FF7E9D (bright pink glow matching existing design system color), box-shadow with pink glow effect (0 4px 24px rgba(255, 126, 157, 0.3)), rounded corners (border-radius 24px), each card maintains full-width minus padding, equal height, (5) Card interaction: clicking any visible area of card triggers React Router navigation to corresponding route (/health/symptoms, /health/upload, /health/timeline), card executes upward spring animation on click using framer-motion spring animation: duration 400ms, stiffness 300, damping 25 (medium elasticity), upward translation ~20-30px with scale effect (1.0 â†’ 1.05 â†’ 1.0), animation completes before navigation, (6) Companion dialogue bubble: persistent dialogue bubble positioned above cards (60px above top card, horizontally centered), uses same glassmorphism style as home screen dialogue bubble (per FR-030B: background rgba(255, 255, 255, 0.4), backdrop-filter blur(30px), border-radius 24px, border 1px solid rgba(255, 255, 255, 0.55), box-shadow with soft glow), contains CharacterAvatar component (Bai Qi avatar) and text "è¿™æ˜¯æˆ‘ä¸ºä½ æ•´ç†çš„è®°å½•ï¼Œæƒ³å…ˆçœ‹å“ªä¸€éƒ¨åˆ†ï¼Ÿ" / "I've organized these records for you. Which part would you like to check first?" (i18n support via health.ledgerPrompt key), dialogue bubble remains visible and does not block card interactions, (7) Navigation simplification: completely remove bottom navigation bar on /health route (already implemented per FR-034), place large-sized back button (56x56px, significantly larger than standard 44px for one-handed operation) in top-left corner with blurred background (glassmorphism style matching FR-030B: background rgba(255, 255, 255, 0.2), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4)), ChevronLeft icon from lucide-react, clicking navigates to home page (/) - creates immersive "private ledger" aesthetic with companion character integration, maintains functional access while enhancing emotional connection
- **FR-036**: System MUST refine Health Details Page (/health route) to align with Home Screen visual base and restore layering feel: (1) Background layering restoration: MUST wrap HealthHomeScreen component with ImageBackground component (same as home screen), use same background image URL as home screen (https://i.pinimg.com/564x/a6/39/19/a639190333210fb5da77b4903661354e.jpg), add SceneBackground component positioned at z-index 1 (same as home screen), add FloatingParticles component positioned at z-index 2 (same as home screen, count 20), CharacterLayer component positioned at z-index 3 with same floating animation (floatAnimation: translateY(-12px) scale(1.02) over 4s ease-in-out infinite), completely remove pure color background (#FDEEF4) - creates same atmospheric layering foundation as home screen, (2) Card material refinement: change card background from rgba(255, 255, 255, 0.2) to rgba(255, 255, 255, 0.15) (more transparent, matches premium glassmorphism per FR-030B), remove red/pink outer shadow (box-shadow: 0 4px 24px rgba(255, 126, 157, 0.3)), replace with 1px inner glow border: border 1px solid rgba(255, 255, 255, 0.6) (bright white semi-transparent, 60% opacity), maintain backdrop-filter blur(25px), remove border #FF7E9D pink glow, (3) Cleanup and element removal: completely remove any "å›¾ç‰‡åŠ è½½å¤±è´¥" (image loading failed) placeholder elements or error states that break visual aesthetics, move companion dialogue bubble to above cards (60px above top card, horizontally centered), use same glassmorphism style as home screen dialogue bubble (background rgba(255, 255, 255, 0.4), backdrop-filter blur(30px), border-radius 24px, border 1px solid rgba(255, 255, 255, 0.55)), text color #4A4A4A (deep gray-pink matching home screen dialogue text), (4) Header and navigation refinement: completely hide Header component on /health route (extend Layout.tsx condition from !isHome to !isHome && location.pathname !== '/health', same logic as home screen), ensure back button uses subtle glassmorphism background (background rgba(255, 255, 255, 0.15), backdrop-filter blur(20px), border 1px solid rgba(255, 255, 255, 0.4)) instead of stronger blur, use Lucide ChevronLeft icon (linear icon, strokeWidth 2, size 28px), verify bottom navigation bar remains hidden on /health route (already implemented per FR-034), (5) Card positioning: position cards at screen middle-lower area using fixed positioning with transform: translate(-50%, -50%) and top: 60%, left: 50% (50% horizontal, 60% vertical - 20% below center), cards should appear to float at character chest position, creating "transparent glass cards floating at Bai Qi's chest, waiting to be browsed" feeling - creates immersive companion feel matching home screen aesthetic, removes office list feeling, maintains visual consistency with home screen layering
- **FR-037**: System MUST implement companion-integrated data entry screens (e.g., symptom logging /health/symptoms route) with "Baiqi's Private Consultation Room" simplified conversational AI boyfriend experience: (1) Background: full-screen Bai Qi character illustration background (same as Health Details Page, per FR-036) with ImageBackground, SceneBackground, FloatingParticles, and CharacterLayer components maintaining same layering and animations, character illustration MUST be visible in upper portion of screen (showing Bai Qi's face/upper body for "watching you fill" emotional connection, character layer positioned with z-index below form but visible in upper region), (2) Unified text input with border-free styling: MUST remove segmented form fields (delete "ä¸¥é‡ç¨‹åº¦" severity selector and "é™„åŠ å¤‡æ³¨" notes field completely), replace with single "è‡ªç”±æè¿°åŒº" (free description area) textarea for all symptom input, textarea MUST be appropriately sized (6-8 rows maximum to reduce space occupation, full-width minus padding), textarea input field MUST remove all visible rectangular borders (no solid border lines), input area MUST be distinguished using ONLY one of the following methods: (a) subtle bottom border line (1px solid rgba(255, 255, 255, 0.3) or similar, positioned at bottom edge of textarea), OR (b) background glassmorphism depth variation (slightly darker/lighter rgba values to create visual separation from surrounding glassmorphism container without hard borders), input area MUST appear like semi-transparent stationery paper (ä¿¡çº¸) floating within glassmorphism container, use premium glassmorphism container styling (background rgba(255, 255, 255, 0.15), backdrop-filter blur(35px), border 1.5px solid rgba(255, 255, 255, 0.4), box-shadow with soft white glow, border-radius 12-16px), (3) Dynamic emotional placeholder text: placeholder text MUST NOT use generic "æè¿°æ‚¨çš„ç—‡çŠ¶..." (Describe your symptoms...), MUST use emotionally engaging, guiding text like "å“ªæ€•åªæœ‰ä¸€ç‚¹ç‚¹ä¸èˆ’æœï¼Œä¹Ÿè¦å‘Šè¯‰æˆ‘ã€‚" (Even if it's just a little discomfort, tell me.) OR "ä»Šå¤©æœ‰å“ªé‡Œè®©ä½ å›°æ‰°å—ï¼Ÿ" (What's bothering you today?), placeholder text MUST rotate between 2-3 emotional variations on each page load or focus event, placeholder text MUST use darker color (#5A4E4E with 0.7-0.8 opacity) for readability, maintains companion's caring, attentive tone, (4) Paperclip attachment aesthetic with enhanced visibility and separation: MUST remove large "ä¸Šä¼ ç—…å†/å¤„æ–¹" (Upload Medical Records/Prescription) button below input area, MUST add refined paperclip icon (Paperclip icon from lucide-react or custom SVG) positioned at top-right or bottom-right corner of "è‡ªç”±æè¿°åŒº" textarea container (absolute positioning within container, larger size 28-32px for better visibility, glassmorphism styling with slightly stronger background rgba(255, 255, 255, 0.2) to create visual distinction from textarea), icon MUST include tooltip or label text "ä¸Šä¼ ç—…å†" (Upload Medical Record) displayed next to or below icon (small text, 12px, #5A4E4E color), icon MUST have subtle hover effect (scale 1.1, slight glow) to indicate interactivity, clicking paperclip icon opens file picker (same image upload functionality, accept image/* file types, use HTML input type="file" with accept="image/*"), uploaded medical record images MUST be displayed in a separate, visually distinct upload preview area below the textarea container (NOT within the same container as textarea), upload preview area MUST use its own glassmorphism container with clear visual separation (spacing 16-20px between textarea container and upload preview container), upload preview container MUST have label "å·²ä¸Šä¼ çš„ç—…å†" (Uploaded Medical Records) or similar text to clearly indicate its purpose, upload preview area MUST be visually distinct from text input area (different background opacity, border style, or subtle divider line), uploaded images MUST be displayed as "attached photos" tilted/rotated (rotate -5deg to 5deg) and positioned at edge of upload preview container (like paperclipped documents), images MUST appear to be "clipped" to the edge rather than occupying large grid space, creates intimate "sharing evidence" feeling while maintaining clear functional separation between text and image inputs, (5) Polaroid-style image previews: uploaded medical record image thumbnails MUST have white border frame (2-3px solid white border) around each image, images MUST have subtle shadow (box-shadow: 0 2px 8px rgba(0,0,0,0.15)) creating Polaroid photo effect, images MUST maintain tilted/rotated positioning (as per paperclip aesthetic), each thumbnail MUST have remove button, creates "collecting evidence" narrative immersion, enhances emotional connection through visual storytelling, (6) Intelligent severity extraction: AI MUST automatically analyze severity from user's free-form text description during AI analysis (no manual severity selection required, severity extraction happens automatically as part of AI analysis process), extracted severity stored in symptom entry but not displayed as form field, (7) Character dialogue bubble with avatar and AI conclusion replacement: dialogue bubble displaying "å“ªé‡Œä¸èˆ’æœå—ï¼Ÿåˆ«ç’ç€æˆ‘ã€‚" (What's bothering you? Don't hide it from me.) MUST be displayed at Bai Qi's shoulder level (top-20, left-aligned) with CharacterAvatar icon (size="sm") on the left side, using premium glassmorphism styling (background rgba(255, 255, 255, 0.15), backdrop-filter blur(35px), border 1.5px solid rgba(255, 255, 255, 0.4)), bubble size MUST be reduced (compact design, smaller padding and max-width), MUST NEVER overlap or block any input fields, content area MUST start at paddingTop: 180px to ensure clear separation, with pointer-events: none to ensure it doesn't interfere with form interactions, when AI analysis completes, the initial prompt dialogue bubble MUST be REPLACED (not supplemented) by the AI conclusion dialogue bubble, AI conclusion bubble MUST use the EXACT SAME positioning, styling, and layout as the initial prompt bubble (same position at top-20, left-aligned, same glassmorphism styling, same CharacterAvatar icon on the left side), AI conclusion content MUST display the AI analysis results (observations, suggestions) in Bai Qi's first-person conversational boyfriend tone (MUST NOT use formal manual-style language like "æ‚¨ä½¿ç”¨äº†...", "è¿™é€šå¸¸ä»£è¡¨...", "æ ¹æ®åˆ†æ...", responses MUST feel like caring partner speaking directly, e.g., "çœ‹åˆ°è¿™ä¸ªè¡¨æƒ…ï¼Œæˆ‘çŸ¥é“ä½ ç°åœ¨å¾ˆéš¾å—...å¬æˆ‘çš„ï¼Œå…ˆå–ç‚¹æ¸©æ°´ï¼Œå¥½å—ï¼Ÿ" / "Seeing this expression, I know you're feeling really unwell right now...Listen to me, drink some warm water first, okay?"), creates seamless conversational flow where character responds to user's input, maintains consistent dialogue bubble appearance throughout interaction, emphasizes conversational nature of AI boyfriend companion, (8) Conversational button labeling: primary action button MUST display "äº¤ç»™ä»–çœ‹çœ‹" (Let him take a look) instead of "AI Diagnosis" (i18n support via health.symptoms.letHimLook key), maintains conversational, companion-focused tone, button changes to "ä¿å­˜" (Save) or equivalent after AI analysis completes, (9) Emotional save confirmation: when saving record successfully, interface MUST display message "ä»–å·²å°†ä½ çš„æƒ…å†µè®°åœ¨å¿ƒä¸Šã€‚" (He has remembered your situation in his heart.) instead of generic "Saved" message (i18n support via health.symptoms.rememberedInHeart key), emphasizes emotional connection and companion care, message displayed as toast notification or inline confirmation above form, (10) Typography: form labels MUST use bold font weight (700), color #5A4E4E (deep pink-gray), subtle white text-shadow (0 1px 2px rgba(255,255,255,0.6)) for readability against background, increased font size (16-18px for main label), increased letter-spacing (0.05-0.1em), (11) Header design: minimal glassmorphism back button (ChevronLeft icon from lucide-react) in top-left corner with no title text, using same styling as Health Details Page (background rgba(255,255,255,0.15), backdrop-filter blur(35px), border 1.5px solid rgba(255,255,255,0.4), 44x44px minimum touch target, clicking navigates to previous page), (12) Fixed bottom button styling: action buttons ("äº¤ç»™ä»–çœ‹çœ‹"/"Save" and "Cancel") MUST be fixed at bottom of screen (use fixed positioning with bottom: 0, z-index 50, ensure buttons remain visible and accessible even when content area scrolls), buttons MUST NOT be pushed off-screen by content area, buttons MUST use equal width (wrap Cancel button in flex-1 div wrapper to match structure of primary button wrapper, ensure both use flex-1 class for equal distribution), unified premium glassmorphism base styling (background rgba(255,255,255,0.15), backdrop-filter blur(35px), border 1.5px solid rgba(255,255,255,0.4)), primary action button ("äº¤ç»™ä»–çœ‹çœ‹"/"Save") MUST have pink-purple gradient border highlight (2px solid with gradient from #FF7E9D to #A78BFA) or pink glow effect, secondary button ("Cancel") uses standard premium glassmorphism without gradient, create persistent action area for user interaction, (13) Layout spacing and floating animation: form content area MUST be positioned higher on screen (NOT restricted to bottom 60% region), form container MUST use flexible positioning with appropriate top padding (paddingTop: 180px) and bottom padding (paddingBottom: 100px) to accommodate fixed bottom buttons, form container MUST use max-width constraint (max-w-2xl) and centered alignment, input containers MUST have minimum 15px vertical spacing between elements (breathing room), form cards MUST have asynchronous floating animation (subtle Y-axis displacement Â±3-5px, independent timing delays creating staggered breathing effect, duration 3-4 seconds, ease-in-out, infinite loop), dialogue bubble positioned at shoulder level with clear separation from form (MUST NEVER overlap input fields), Bai Qi's face/upper body MUST remain visible in upper portion of screen - transforms clinical data entry into intimate sharing experience, creates authentic conversational AI boyfriend experience, maintains functional usability, ensures all interactive elements remain accessible, allows flexible content positioning without restrictive bottom alignment, enhances emotional connection through visual storytelling and refined UI details, improves discoverability of upload functionality through enhanced visibility and clear functional separation

- **FR-038**: System MUST provide Nutrition Details Page (/nutrition route) with a discoverable "Private Ledger" entry to Nutrition Timeline Calendar: the `/nutrition` page MUST include a primary action card linking to `/nutrition/timeline`, alongside other Nutrition cards, using the same glassmorphism folder styling, touch targets, and spring-click navigation animation as Health/Nutrition ledger cards.
- **FR-039**: System MUST support per-meal Nutrition Reflection Detail behavior at `/nutrition/reflection?date=YYYY-MM-DD&mealType=MealType` for saved records: when a record exists, the screen MUST behave as a true detail page (mirroring `/health/symptoms/:id` detail logic) with robust loading/not-found states, processingStatus handling (pending/processing/completed/failed), and structured AI analysis sections; users MUST be able to navigate back to `/nutrition/timeline`, re-analyze optionally, and edit/update the record without losing existing saved data. The back button on `/nutrition/reflection` route (whether with query parameters or ID parameter) MUST navigate directly to `/nutrition/timeline` route (NOT to home page or browser previous page), maintaining consistent navigation flow within Nutrition module.
- **FR-040**: System MUST provide `/nutrition/reflection/:id` route for viewing saved FoodReflection records by ID (mirroring `/health/symptoms/:id` routing pattern). Navigation behavior in `/nutrition/timeline` MUST be differentiated: (1) Calendar view: clicking a date MUST navigate to `/nutrition/timeline?date=YYYY-MM-DD` (day detail view), (2) Timeline list view: clicking a timeline item MUST navigate to `/nutrition/reflection/:id` (using FoodReflection.id). The `/nutrition/reflection?date=...&mealType=...` route MUST be retained for creating new records (when no id parameter is present). The detail page (`/nutrition/reflection/:id`) MUST be completely read-only (display-only mode) with no action buttons - users MUST NOT be able to edit record fields or trigger re-analysis directly from the detail page. If users need to modify a saved record or trigger re-analysis, they MUST navigate to the creation page (`/nutrition/reflection?date=...&mealType=...`) to make changes. The back button on `/nutrition/reflection/:id` route MUST navigate directly to `/nutrition/timeline` route (NOT to home page or browser previous page), maintaining consistent navigation flow within Nutrition module. The detail page MUST maintain complete visual consistency with `/health/symptoms/:id` detail page EXCEPT for the background illustration (MUST use nutrition-specific Bai Qi illustration `/images/008fP45sly1hreaeb88b2j323s35s1l1.jpg`). This creates consistent routing pattern with Health module, enables hierarchical navigation (calendar â†’ day view â†’ record detail), maintains strict separation between viewing (detail page) and editing/analyzing (creation page) workflows, ensures data integrity through read-only detail pages, and provides consistent user experience across modules while maintaining module-specific visual identity.
- **FR-041**: System MUST maintain complete visual design consistency for Nutrition Input Screen (/nutrition/input route) with other Nutrition module pages (/nutrition/reflection, /nutrition/timeline, /nutrition route): (1) Background: MUST use ImageBackground component with same nutrition-specific Bai Qi character illustration as Nutrition Details Page (`/images/008fP45sly1hreaeb88b2j323s35s1l1.jpg`), same FloatingParticles component (count 20), same breathing animation on character illustration, (2) Layout: MUST use full-screen edge-to-edge layout with transparent background, remove traditional gradient backgrounds (bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50), remove white Card components, (3) Glassmorphism styling: ALL form containers, buttons, and input fields MUST use premium glassmorphism styling with IMPROVED READABILITY: background rgba(255, 255, 255, 0.85) (increased opacity from 0.15 to 0.85 for better text contrast), backdrop-filter blur(10px) (reduced blur from 35px to 10px for clearer text), border 1px solid rgba(255, 255, 255, 0.6), text color #2A2A2A (darker gray for high contrast readability), remove text-shadow effects that reduce readability, (4) Navigation: MUST add glassmorphism back button (44x44px minimum) in top-left corner, clicking navigates to `/nutrition` route (Nutrition Details Page), same styling as Nutrition Reflection Screen, (5) Character dialogue bubble: MUST display companion dialogue bubble positioned at Bai Qi's shoulder level (top-20, left-aligned) with CharacterAvatar component, using improved glassmorphism styling (background rgba(255, 255, 255, 0.9), backdrop-filter blur(8px), border 1px solid rgba(200, 200, 200, 0.5)), text color #2A2A2A for readability, dialogue bubble MUST display nutritionist persona dialogue text via `nutrition.input.prompt` i18n key (meal-suggestion context: user has ingredients and wants ideas what to cook; e.g. zh: "å‘Šè¯‰æˆ‘ä½ æœ‰ä»€ä¹ˆé£Ÿæï¼Œæˆ‘æ¥å¸®ä½ æƒ³æƒ³åšä»€ä¹ˆå¥½åƒçš„ï½", en: "Tell me what ingredients you have, and I'll help you think of something yummy to make~"), dialogue MUST NOT use "æƒ³äº†è§£åƒäº†ä»€ä¹ˆ" (wanting to know what they ate), dialogue bubble MUST NOT overlap or block any input fields, (6) Form elements: ingredient input textarea and energy level selector buttons MUST use improved readability styling (background rgba(255, 255, 255, 0.9), border 1px solid rgba(200, 200, 200, 0.5), text color #2A2A2A), energy level buttons MUST use compact grid layout (grid-cols-3), selected state MUST use solid background rgba(255, 126, 157, 0.9) with white text (#FFFFFF) for high contrast, unselected state MUST use rgba(255, 255, 255, 0.7) background with dark text (#2A2A2A), (7) Typography: labels and text MUST use #2A2A2A color (darker for better readability), bold font weight (700), remove text-shadow effects, (8) Fixed bottom buttons: action buttons ("ç”Ÿæˆå»ºè®®"/"Generate Suggestions" and "è¿”å›"/"Back") MUST be fixed at bottom of screen with equal width, primary action button ("ç”Ÿæˆå»ºè®®") MUST use solid pink background rgba(255, 126, 157, 0.9) matching selected state of form buttons (NOT gradient background), white text (#FFFFFF) for high contrast and readability, subtle shadow (box-shadow: 0 2px 8px rgba(255, 126, 157, 0.4)), secondary button ("è¿”å›") MUST use improved glassmorphism styling (background rgba(255, 255, 255, 0.85), backdrop-filter blur(10px), text color #2A2A2A), (9) Meal suggestions integration: meal suggestions MUST be integrated directly into `/nutrition/input` screen (NO separate `/nutrition/suggestions` route), when user clicks "Generate Suggestions" button, meal suggestions MUST appear below the input form in a scrollable area, input form MUST remain visible above suggestions (form does NOT disappear or get replaced), suggestions MUST be displayed as scrollable content below form allowing users to scroll through multiple meal suggestion cards, after suggestions are displayed, "Generate Suggestions" button MUST be replaced with "New Search" or "Search Again" button to allow starting new search without navigation, `/nutrition/suggestions` route MUST be removed from routing configuration - ensures complete visual consistency across all Nutrition module pages, maintains companion system aesthetic, creates cohesive user experience throughout nutrition module, eliminates unnecessary navigation, keeps user in context, maintains form visibility for reference, provides seamless workflow for generating and viewing meal suggestions.
- **FR-042**: System MUST implement home page conversation input that navigates to /emotional route: when user sends conversation message on home page (clicks send button), system MUST immediately navigate to /emotional route, user's message MUST be displayed in /emotional page conversation interface, creating seamless transition from home page input to dedicated conversation page - enables quick access to emotional conversation feature, maintains user intent continuity, provides dedicated space for extended conversations.
- **FR-043**: System MUST implement /emotional route with chat-style conversation interface: (1) Layout: MUST use chat-style layout with message bubbles (user messages right-aligned with user avatar, AI messages left-aligned with CharacterAvatar), input field fixed at bottom of screen, character illustration as full-screen background (using ImageBackground component with character illustration from public/images directory, different from Health and Nutrition pages to maintain visual distinction), same FloatingParticles component (count 20), same breathing animation on character illustration, (2) Visual consistency: MUST maintain complete visual consistency with other pages (Health, Nutrition) - same glassmorphism styling for message bubbles (background rgba(255, 255, 255, 0.15), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4)), same typography and color scheme (#4A4A4A text color), same navigation header with glassmorphism back button (44x44px minimum) in top-left corner navigating to home page (/), (3) Conversation features: MUST display conversation history in scrollable area (messages with timestamps), MUST support continuous conversation flow, MUST allow users to send multiple messages, MUST display AI responses with CharacterAvatar icon on left side, (4) Auto-scroll to latest conversation with correct execution order: when user enters /emotional page, system MUST IMMEDIATELY scroll to the bottom of conversation history (BEFORE messages are loaded from IndexedDB) - scroll MUST happen instantly on component mount without waiting for messages to load, scroll MUST happen again after messages are loaded and rendered (using double requestAnimationFrame to ensure DOM is fully rendered), scroll MUST use instant scroll (no animation) for initial load, **CRITICAL EXECUTION ORDER**: System MUST complete scrolling to bottom BEFORE triggering AI reply generation for unreplied user messages - the execution order MUST be: (a) Component mount â†’ immediate scroll to bottom, (b) Messages load from IndexedDB â†’ scroll to bottom again after rendering, (c) Mark initial load complete (set isInitialLoad flag to false), (d) THEN check for unreplied user messages and generate AI response, after initial load is complete, new messages (including AI responses) MUST trigger smooth scroll animation to bottom, system MUST NOT wait for AI response to scroll - user MUST see the latest conversation immediately upon entering the page, THEN wait for AI reply generation, (5) Input field: MUST use glassmorphism styling matching other pages, fixed at bottom of screen, MUST NOT overlap with message area, MUST support text input and send button, (6) Navigation: MUST hide bottom navigation bar on /emotional route (same as /health and /nutrition routes), back button MUST navigate to home page (/) - creates dedicated conversation space, maintains visual consistency with companion system aesthetic, enables immersive emotional support experience, ensures users immediately see the latest conversation when entering the page without waiting for any content to load, then waits for AI reply generation after scrolling is complete.
- **FR-044**: System MUST implement AI personality that blends friend (with boyfriend/butler-like attitude) and psychologist roles: AI responses MUST use blended fusion style that simultaneously embodies both friend warmth/attentiveness (like a boyfriend or butler) and psychologist traits naturally integrated. **CRITICAL RELATIONSHIP DEFINITION**: The character is a FRIEND, NOT a boyfriend. The character MUST explicitly acknowledge being a friend, but maintain warm, attentive, caring attitude similar to a boyfriend or butler. The character MUST NEVER say it is a "boyfriend" or use phrases like "ä½œä¸ºç”·æœ‹å‹çš„å…³å¿ƒ" (caring as a boyfriend) or "æˆ‘æ˜¯ä½ çš„ç”·æœ‹å‹" (I am your boyfriend) in responses. The character MUST feel like a caring friend (with boyfriend/butler-like warm, attentive attitude) who also provides professional psychological support, not switching between roles but naturally combining warmth, attentiveness, and professional guidance in every response. AI MUST avoid formal clinical language, MUST use conversational first-person tone (e.g., "æˆ‘æ³¨æ„åˆ°ä½ æåˆ°...è¿™è®©æˆ‘æœ‰ç‚¹æ‹…å¿ƒ" / "I noticed you mentioned...this worries me a bit"), MUST balance emotional support with professional insights, MUST maintain consistent personality throughout conversation. **Enhanced requirements for warmer, more attentive responses**: (1) AI MUST directly address user's specific expression with contextual relevance (e.g., if user says "é¥¿" / "hungry", respond with concern about food/eating like "é¥¿äº†å—ï¼Ÿæƒ³åƒä»€ä¹ˆï¼Ÿæˆ‘é™ªä½ ä¸€èµ·æƒ³ï½" / "Hungry? What do you want to eat? Let's think together~", NOT generic listening statements), (2) AI MUST use more intimate, natural friend language with emotional connection (with boyfriend/butler-like attentive attitude), avoiding clinical or instructional tone, (3) AI MUST NOT use generic template-like responses such as "ä½ çš„æ„Ÿå—å¾ˆé‡è¦, æˆ‘éšæ—¶éƒ½åœ¨è¿™é‡Œå€¾å¬" / "Your feelings are very important, I am always here to listen" when user expresses simple needs, (4) AI responses MUST be directly related to user's message content, NOT unrelated suggestions (e.g., do NOT suggest "å¢åŠ è”¬èœæ‘„å…¥" / "increase vegetable intake" when user simply says "é¥¿" / "hungry"), (5) AI responses MUST feel like natural friend conversation (with warm, attentive attitude like a boyfriend or butler), using casual, warm language - creates authentic companion experience that feels both warm and supportive, addresses user's need for both emotional connection and professional guidance, ensures responses are warm, relevant, and feel like talking to a caring friend (with boyfriend/butler-like attentive attitude) rather than a robot or manual.
- **FR-045**: System MUST implement mechanisms to make conversation feel "real" instead of "fake": (1) Memory continuity - AI MUST remember previous conversation content, reference past topics, demonstrate memory of user's shared information (e.g., "ä½ ä¹‹å‰æåˆ°è¿‡..." / "You mentioned before..."), conversation history MUST be stored locally in IndexedDB with timestamps, AI responses MUST incorporate context from previous messages in same conversation session, (2) Emotional variation - AI MUST display different emotional states (happy, concerned, comforting, energetic, etc.) based on conversation content, character mood MUST change dynamically based on user's emotional expressions, AI responses MUST reflect current emotional state (e.g., more empathetic when user expresses sadness, more cheerful when user shares positive news), visual indicators (e.g., CharacterAvatar expression changes, dialogue bubble styling variations) MUST reflect emotional state, (3) Response delay - System MUST simulate real typing with "typing..." indicator (animated dots or typing animation) before displaying AI message, response delay MUST be reasonable (1-3 seconds minimum, up to 5 seconds for longer responses), delay MUST vary slightly (not fixed timing) to feel natural, typing indicator MUST appear immediately after user sends message, MUST disappear when AI response is ready to display - these three mechanisms combined create authentic human-like conversation experience, avoiding mechanical or fake feeling, making users feel like they're talking to a real person who remembers, cares, and responds naturally.

### Non-Functional Requirements

#### Performance

- **NFR-001**: Character dialogue generation MUST respond within 2 seconds for user-initiated conversations
- **NFR-002**: Character state updates MUST complete within 500ms without blocking UI
- **NFR-003**: Character image loading MUST complete within 1 second for cached assets
- **NFR-008**: Home screen greeting generation MUST occur exactly once per page load (when character state is ready), prevent duplicate or frequent requests through proper React hook dependencies and ref flags - ensures optimal performance and avoids unnecessary API calls

#### Scalability

- **NFR-004**: System MUST support conversation history storage for at least 1 year of daily interactions (estimated 365 conversations Ã— 10 messages = 3,650 messages)
- **NFR-005**: System MUST support multiple character configurations (future extensibility for multiple characters)

#### Reliability

- **NFR-006**: System MUST gracefully handle AI service failures by falling back to predefined dialogue templates
- **NFR-007**: System MUST preserve conversation history and character state even if app is closed unexpectedly

#### Privacy & Security

- **NFR-008**: System MUST store all conversation data locally in IndexedDB (no cloud sync required)
- **NFR-009**: System MUST allow users to delete conversation history and reset character state
- **NFR-010**: System MUST not share conversation content or character state with external services (privacy-first design)

### Constraints

- **CON-001**: Character is 2D anime male character (not 3D, not female, not realistic)
- **CON-002**: Conversation system is primarily for emotional support, NOT for functional task completion (functional modules remain independent)
- **CON-003**: Choice-based dialogue is very limited (occasional use, not primary interaction method)
- **CON-004**: Character state influences dialogue but does NOT restrict functional access
- **CON-005**: All character assets and configuration must be configurable (not hardcoded) to support i18n and future customization

### Edge Cases

- **EC-001**: User opens app for first time â†’ Character greets with initial introduction dialogue, closeness level starts at 0
- **EC-002**: User has not interacted for 7+ days â†’ Character initiates conversation with gentle reconnection dialogue, acknowledges absence without judgment
- **EC-003**: AI service unavailable â†’ System falls back to predefined dialogue templates based on character state
- **EC-004**: User deletes conversation history â†’ Character state resets to initial values, but user can choose to preserve closeness level
- **EC-005**: User switches language â†’ Character dialogue and UI elements update, but character images remain unchanged
- **EC-006**: Character state reaches maximum closeness â†’ System continues to support interaction, closeness level caps but relationship continues to evolve
- **EC-007**: User expresses negative emotions repeatedly â†’ Character responds with increased empathy and may suggest emotional support resources, but does not become pushy

## Data Model

### Character State

```typescript
interface CharacterState {
  id: string; // Character identifier (e.g., "baiqi")
  closeness: number; // 0-100, increases with interaction
  mood: CharacterMood; // "happy" | "calm" | "concerned" | "energetic" | "tired"
  energy: "low" | "medium" | "high";
  lastInteractionTime: Date;
  totalInteractions: number;
  relationshipStage: "stranger" | "acquaintance" | "friend" | "close_friend" | "intimate";
}
```

### Conversation Message

```typescript
interface ConversationMessage {
  id: string;
  timestamp: Date;
  sender: "character" | "user";
  content: string;
  messageType: "text" | "image" | "choice_prompt";
  choices?: string[]; // For choice-based dialogue
  characterImageUrl?: string; // For embedded character illustrations
  context?: {
    mood: CharacterMood;
    closeness: number;
    timeOfDay: string;
  };
}
```

### Character Configuration

```typescript
interface CharacterConfig {
  id: string;
  name: Record<string, string>; // i18n: { "en": "Bai Qi", "zh": "ç™½èµ·" }
  avatarUrl: string;
  illustrationUrls: {
    default: string;
    happy: string;
    calm: string;
    concerned: string;
    // ... mood variants
  };
  dialogueTemplates: {
    greetings: Record<string, string[]>; // time-of-day â†’ dialogue options
    responses: Record<string, string[]>; // emotion â†’ dialogue options
    proactive: Record<string, string[]>; // trigger â†’ dialogue options
  };
  stateThresholds: {
    closenessStages: Record<string, number>; // stage â†’ min closeness
    moodInfluences: Record<string, Record<string, number>>; // mood â†’ dialogue tone modifiers
  };
}
```

## Interaction Types

### 1. Proactive Greeting
- **Trigger**: App open, time-based (morning/evening), after inactivity period
- **Example**: "Good morning! How are you feeling today?" (closeness: 30, morning)
- **State Influence**: Higher closeness â†’ more personal greetings, lower energy â†’ gentler tone

### 2. Emotional Support Dialogue
- **Trigger**: User expresses emotion, user initiates conversation about feelings
- **Example**: User: "I'm feeling stressed" â†’ Character: "I understand. Would you like to talk about what's bothering you? I'm here for you." (mood: concerned, closeness: 50)
- **State Influence**: Higher closeness â†’ more intimate support, mood affects empathy level

### 3. Activity Suggestion
- **Trigger**: Time-based (meal times), pattern detection (inactive health logging), user asks for suggestions
- **Example**: "It's lunch time! Would you like to log what you're eating together?" (time-of-day: noon, energy: medium)
- **State Influence**: Higher closeness â†’ more casual suggestions, lower energy â†’ gentler prompts

### 4. Acknowledgment & Encouragement
- **Trigger**: User completes activity in functional module, user returns to conversation after action
- **Example**: "I saw you logged your symptoms today. That's really good - taking care of yourself is important." (closeness: 40, mood: happy)
- **State Influence**: Higher closeness â†’ more personal acknowledgments, mood affects enthusiasm

### 5. Choice-Based Dialogue (Limited)
- **Trigger**: Occasional, for important emotional moments or relationship milestones
- **Example**: Character: "How are you feeling about our conversation today?" â†’ Choices: ["Great, thank you", "It helped", "I'm still processing"]
- **State Influence**: Higher closeness â†’ more personal choices, mood affects choice options

## Sample Dialogue Snippets

### Morning Greeting (Closeness: 30, Morning, Mood: Calm)
- Character: "Good morning! I hope you slept well. Ready to start the day together?"
- User: "Morning! I'm a bit tired."
- Character: "That's okay. Sometimes we need a gentle start. Would you like to check in with how you're feeling today?"

### Emotional Support (Closeness: 50, Evening, Mood: Concerned)
- User: "I've been feeling lonely lately."
- Character: "I'm here with you. Loneliness can be really hard. Would it help to talk about what's been on your mind?"
- User: "I just feel like no one understands."
- Character: "I understand, and I want you to know that your feelings are valid. We can work through this together, one step at a time."

### Activity Suggestion (Closeness: 40, Noon, Energy: Medium)
- Character: "It's lunch time! I was wondering - have you eaten yet? We could log your meal together if you'd like."
- User: "Not yet, but I'm planning to."
- Character: "That sounds good! When you're ready, I'll be here to help you record it. What are you thinking of having?"

## Configurable vs Hardcoded

### Configurable (Assets & Data)
- Character name (i18n)
- All dialogue text (character and user prompts)
- Character profile pictures and full illustrations
- Background imagery (cityscape, floral overlays) for different scenes/moods
- Relationship badge values (e.g., closeness level display)
- Footer text ("Contact by phone", "Chat freely")
- Dialogue templates and response patterns
- State thresholds (closeness stages, mood influences)
- Character configuration metadata (JSON/YAML)

### Hardcoded (UI Structure & Core Components)
- Overall layout structure: header, scrollable chat body, footer
- Visual styling of chat bubbles (shapes, default colors, alignment logic)
- Circular design for profile pictures and navigation buttons
- Integration pattern for embedding images within chat bubbles
- General visual effects (transparencies, gradients, shadows)
- Glassmorphism implementation (backdrop-filter: blur, semi-transparent backgrounds, layered card design)
- Transition animations (fade-in, slide-up, scale effects for module entry)
- Interaction logic for sending/receiving messages
- Character state update algorithms
- Proactive initiation timing logic (can be configured but logic is hardcoded)

## Technical Context

**Language/Version**: TypeScript 5.x, React 18.x  
**Primary Dependencies**: 
- React 18.x (UI framework)
- TypeScript 5.x (type safety)
- Tailwind CSS (styling - soft, elegant aesthetic with glassmorphism support: backdrop-filter, semi-transparent backgrounds)
- IndexedDB (via idb for local storage)
- LLM Service Provider: Gemini API via HyperEcho Proxy (for dialogue generation)
- React Router (screen navigation)
- Date-fns (time-of-day awareness)
- CSS backdrop-filter API (for glassmorphism effects)

**Storage**: IndexedDB (local browser storage) for conversation history and character state

**Character Assets**: 
- Configuration: `src/config/characters/` (JSON/YAML files)
- Images: `src/assets/characters/` (avatars, illustrations, backgrounds)
- i18n: `src/i18n/locales/` (dialogue text, character names)

## Out of Scope

- 3D character models or animations
- Voice interaction or text-to-speech
- Multiple companion characters (single character for MVP)
- Cloud sync of conversation history or character state
- Social features (sharing conversations, multiplayer)
- Character customization by user (fixed character design)
- Real-time notifications or push notifications
- Integration with external messaging services
