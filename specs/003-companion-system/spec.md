# Feature Specification: Companion Character System

**Feature Branch**: `003-companion-system`  
**Created**: 2026-01-23  
**Status**: Draft  
**Input**: User description: Companion-style mobile app with 2D anime male character, daily interaction, emotional feedback, designed to reduce loneliness and encourage healthy habits through "doing things together"

## Overview

This feature introduces a companion character system to CareNest that transforms the app from a utility-first tool into a relationship-driven experience. The companion is a 2D anime male character that users interact with daily, providing emotional support and gentle guidance for health, nutrition, and emotional well-being activities.

**Core Philosophy**: "I'm not using a tool, I'm spending time with someone."

**Design Inspiration**: Otome / dating-sim games with:
- Central 2D anime male character
- Daily interaction patterns
- Emotional feedback instead of pure task completion
- Relationship that grows over time

## Clarifications

### Session 2026-01-25

- Q: How should the three function spheres in the upper right corner behave when clicked? → A: Three function spheres (FunctionSpheres component) in upper right corner MUST navigate directly to original Health, Nutrition, Emotion functional screens (/health, /nutrition, /emotional routes) - they should NOT trigger icon expansion transition to full-screen data panels with line charts. Function spheres serve as quick access shortcuts to existing functional modules, maintaining direct navigation to preserve original Health/Nutrition/Emotion functionality.
- Q: What is the exact route mapping for the three function spheres from top to bottom? → A: The three function spheres in upper right corner (vertical stack, top to bottom) MUST map as follows: top sphere (Health icon/HeartPulse) → /health route, middle sphere (Nutrition icon/Leaf) → /nutrition route, bottom sphere (Emotion icon/Heart or Smile) → /emotional route. Each sphere MUST use React Router navigation (useNavigate hook) to navigate directly to its corresponding route when clicked, without any intermediate transitions or data panels.
- Q: How should the Health Details Page (健康追踪页) be refined for companion system integration? → A: Health Details Page (/health route) MUST be refined as follows: (1) Remove bottom Floating Capsule navigation bar - navigation bar MUST be hidden on /health route, (2) Add frosted glass back button (ChevronLeft icon from lucide-react) in top-left corner with background rgba(255, 255, 255, 0.2), backdrop-filter blur(25px), clicking navigates to home page (/), (3) Add character overlay: Bai Qi illustration scaled to ~25% size positioned at bottom-right corner, with mini dialogue box (glassmorphism style) containing Bai Qi avatar and text "在这里记录一下吧，我会帮你看着的。" / "Record here, I'll help you keep track.", (4) Replace three heavy white cards with three full-width glassmorphism containers: background rgba(255, 255, 255, 0.15), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4), soft white glow shadow, add slow floating animation (Y-axis offset 2-3px, continuous gentle movement), (5) Typography: "健康追踪" title positioned at top-left, font color #4A4A4A (deep gray-pink), increased letter spacing - creates immersive companion feel while maintaining functional access to health tracking features.
- Q: How should the Health Details Page layout be redesigned as "The Private Ledger" with overlapping fan-shaped cards? → A: Health Details Page (/health route) MUST be redesigned with "The Private Ledger" layout concept: (1) Remove standard list layout completely, (2) Design three overlapping fan-shaped glassmorphism cards positioned in middle-lower screen area (like spread-out archive pages): top card displays "记录症状" (Log Symptoms), middle card displays "上传记录" (Upload Record), bottom card displays "查看时间线" (View Timeline) - cards arranged in slight fan pattern: top card rotated -8°, middle card rotated -4°, bottom card rotated 0° (vertical), vertical offset 40px between cards, horizontal offset 20px creating staggered effect, (3) Background: maintain full-screen Bai Qi character illustration with same breathing animation as home screen (floatAnimation: translateY(-12px) scale(1.02) over 4s ease-in-out infinite), (4) Card material: use rgba(255, 255, 255, 0.2) background, backdrop-filter blur(25px), border 1px solid with bright pink glow (#FF7E9D color, matching existing design system), box-shadow with pink glow effect, (5) Interaction: clicking any visible area of card triggers navigation to corresponding function (/health/symptoms, /health/upload, /health/timeline), card executes upward spring animation on click: duration 400ms, stiffness 300, damping 25 (medium elasticity), (6) Companion integration: persistent dialogue bubble above cards (60px above top card, horizontally centered) using same style as home screen dialogue bubble, text: "这是我为你整理的记录，想先看哪一部分？" / "I've organized these records for you. Which part would you like to check first?", (7) Navigation simplification: completely remove bottom navigation bar on /health route, place large-sized back button (56x56px, significantly larger than standard 44px for one-handed operation) in top-left corner with blurred background (glassmorphism style matching FR-030B) - creates immersive "private ledger" aesthetic with companion character integration.
- Q: What are the critical visual alignment requirements for Health Details Page to match Home Screen base? → A: Health Details Page (/health route) MUST achieve complete visual alignment with Home Screen base: (1) CRITICAL - Background restoration: MUST disable any pure pink/simple gradient backgrounds, MUST use ImageBackground component (same as home screen) displaying full-screen Bai Qi illustration, illustration MUST be at bottom layer with all functional cards floating above it, (2) "Private Ledger" interaction refinement: MUST remove isolated rectangular cards, MUST design three slightly overlapping fan-shaped glass page tabs positioned at middle-lower screen area, styling MUST align: backgroundColor rgba(255, 255, 255, 0.15), backdrop-filter blur(25px), border MUST use only 1px ultra-fine bright white semi-transparent stroke (rgba(255, 255, 255, 0.6)), (3) Failed resource removal: MUST completely remove any gray "图片加载失败" (image loading failed) placeholder elements in page center, MUST verify /assets/characters/baiqi/ paths and ensure illustration loads correctly, if images unavailable MUST use home screen image logic as fallback, (4) Dialogue layer optimization: Bai Qi dialogue bubble ("这是我为你整理的记录...") MUST float above three cards, MUST use home screen's deep gray-pink text color (#4A4A4A), (5) Header simplification: top MUST remain completely transparent, top-left MUST retain only simple linear back arrow (ChevronLeft from lucide-react), MUST remove bottom Tab Bar completely - target feeling: "Bai Qi is handing me a stack of transparent health records, not a broken list page" - creates immersive companion feel matching home screen aesthetic, removes office list feeling, maintains visual consistency with home screen layering (per FR-036).
- Q: How should the Health Details Page cards be arranged for better visual spacing and interactivity? → A: Health Details Page (/health route) cards MUST use de-stacked layout with staggered positioning: (1) Card positioning: first card ("记录症状") positioned slightly top-left (negative left offset), second card ("上传记录") centered, third card ("查看时间线") positioned slightly bottom-right (positive left offset), use absolute positioning with margin or left offsets to create visual distance, ensure all card titles are fully visible without overlap, (2) Floating animation: each card MUST have independent floating animation using framer-motion: Y-axis displacement ±5px, rotation angle between -2deg and 2deg, staggered animation delays (0s, 0.3s, 0.6s) creating asynchronous floating effect like floating on water, creates "nudge to click" visual hint, (3) Glass quality optimization: card background rgba(255, 255, 255, 0.15), backdrop-filter blur(25px), text color MUST be #4A4A4A (deep gray-pink) with bold font weight for readability on complex illustration background, (4) Dialogue positioning: remove circular avatar from page center, dialogue bubble MUST be positioned above cards at center top, text: "这是我为你整理的记录，想先看哪一部分？", (5) Back button: confirm top-left back arrow has sufficient touch target size (56x56px minimum) with circular glassmorphism background matching home screen style - creates interactive ledger layout with floating cards that invite user interaction.
- Q: Should the three "Private Ledger" cards ever disappear from the screen (e.g., fade in/out)? → A: No. The three Health Details Page (/health route) ledger cards are persistent primary actions (buttons) and MUST remain continuously visible and clickable at all times (no fade-in/out or intermittent disappearance). Only subtle floating motion is allowed; the cards MUST not become fully transparent or leave the visible lower-half region.
- Q: What final polish is required for Health page readability and spacing? → A: Health Details Page (/health) MUST ensure the dialogue bubble never overlaps the action cards (move bubble upward as needed) and the three cards are re-arranged into a staggered arc composition in the bottom region (scattered folder/bookmark feel). For readability, BOTH dialogue bubble and cards MUST use enhanced glassmorphism: backdrop-filter blur(30px) and background rgba(255, 255, 255, 0.3), with text color #4A4A4A in bold. Cards MUST use pink linear icons (no solid fills) and include a 1px bright white glowing border stroke. The top header bar ("Wellmate") MUST remain fully transparent with only the back arrow visible.
- Q: Should the three bottom action cards ever overlap each other? → A: No. The three Health Details Page (/health) action cards MUST NOT overlap each other in any state (including during floating/rotation animations). Layout MUST be collision-safe on small screens (down to 320px width) by using smaller cards and a staggered/triangular (arc-like) placement in the bottom region, while keeping cards fully visible and clickable.
- Q: What is the required mobile-first layout correction for the Health "Private Ledger" cards? → A: Health Details Page (/health) MUST use a mobile-first VERTICAL (not horizontal) ledger layout: (1) The three folder cards MUST be stacked vertically and centered horizontally (alignSelf: 'center'), (2) Each folder width MUST NOT exceed 80% of screen width (<= 80vw) to avoid overflow, (3) The folder stack MUST be positioned in the bottom 40% region of the screen so Bai Qi’s face/neck/chest are never covered, (4) The vertical stack MUST have a subtle "fan" overlap using slight negative marginTop (e.g. -40px) and small rotations/translations: folder 1 rotate -2deg, translateX -10; folder 2 rotate 1deg, translateX 5; folder 3 rotate -1deg, translateX -5, (5) Cards remain persistent clickable buttons (never disappear) with async floating Y-axis motion and micro-rotation.
- Q: Should the Health page card layout match a specific reference composition? → A: Yes. The /health "ledger" cards MUST follow the reference composition: top card ("上传医疗记录") slightly offset to the right, middle card ("记录症状") slightly offset to the left, and bottom card ("查看时间线") near center with a slight left bias. The stack remains vertical and bottom-weighted (within bottom ~40% region), with a light fan overlap (smaller negative marginTop than before) and smaller card size (approx ~58vw max, <=80vw) to visually match the reference screenshot while keeping titles readable and cards fully clickable.
- Q: What visual design should data entry screens (e.g., symptom logging /health/symptoms) use for background and containers? → A: Data entry screens (e.g., /health/symptoms route) MUST use full-screen Bai Qi character illustration background (same as Health Details Page) with glassmorphism input containers: background rgba(255, 255, 255, 0.2), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4), box-shadow with soft white glow - maintains visual consistency with Health Details Page and companion system aesthetic (per FR-030B, FR-036), provides emotional context during data entry, creates immersive companion feel.
- Q: What button workflow and labeling should symptom logging screen use for AI diagnosis and saving? → A: Symptom logging screen (/health/symptoms route) MUST use two-step workflow: primary button displays "AI Diagnosis" (or equivalent i18n label) when no AI analysis exists, button changes to "Save Record" (or "Complete"/"Finish") after AI analysis completes or user chooses to skip AI analysis - button label MUST reflect current action state, maintains clear user intent throughout workflow, AI diagnosis is optional step before saving.
- Q: How should character interaction be displayed on data entry screens (e.g., symptom logging)? → A: Data entry screens (e.g., /health/symptoms route) MUST display character avatar (Bai Qi) with dialogue bubble positioned at top of screen (above input fields), using glassmorphism styling per FR-030B, displaying contextual message like "哪里不舒服吗？别瞒着我。" / "What's bothering you? Don't hide it from me." (i18n support) - provides companion presence during data entry, aligns with companion system philosophy (FR-019), maintains emotional connection throughout data entry process.
- Q: What visual feedback should severity selection buttons provide when selected? → A: Severity selection buttons on data entry screens MUST provide clear visual feedback: selected state uses deep pink border (#FF7E9D or darker pink) with subtle breathing glow animation (pulsing box-shadow effect, 2-3 second cycle), unselected state uses gray border (1-2px) with no glow - creates warm, interactive feel matching otome aesthetic (FR-030), provides clear selection state indication, enhances emotional connection through visual warmth.
- Q: What header and navigation design should data entry screens (e.g., symptom logging) use? → A: Data entry screens (e.g., /health/symptoms route) MUST use minimal header design: glassmorphism back button (ChevronLeft icon from lucide-react) in top-left corner with no title text, using same styling as Health Details Page (background rgba(255,255,255,0.2), backdrop-filter blur(25px), border 1px solid rgba(255,255,255,0.4), 44x44px minimum touch target, clicking navigates to previous page) - maintains visual consistency with Health Details Page (FR-034, FR-036), reduces visual clutter, keeps focus on character dialogue and input fields.
- Q: How should character dialogue bubble be positioned on data entry screens to avoid blocking input fields? → A: Character dialogue bubble on data entry screens MUST be positioned in non-interactive area (e.g., top-center with sufficient margin from first input field, or floating above form with clear separation), MUST NOT overlap or block any input fields, dialogue bubble can use floating/overlay positioning with higher z-index but MUST ensure all form inputs remain fully accessible and unobstructed - maintains companion presence without compromising usability.
- Q: What glassmorphism styling should input containers use for optimal text readability? → A: Input containers on data entry screens MUST use enhanced glassmorphism with increased background opacity (rgba(255, 255, 255, 0.25) minimum) and higher blur value (blur(30px) or higher) for better text contrast, placeholder text MUST use darker color (#4A4A4A with 0.7-0.8 opacity) to ensure readability against blurred background, labels MUST use bold font weight and #4A4A4A color with subtle white text-shadow for visual hierarchy - ensures clean, premium appearance matching home screen aesthetic, prevents muddy/dirty visual effect.
- Q: What typography styling should form labels and titles use on data entry screens? → A: Form labels and titles on data entry screens MUST use deep gray-pink color (#4A4A4A), bold font weight (600-700), increased font size (14-16px for labels, 18-20px for section titles), subtle white text-shadow (0 1px 2px rgba(255,255,255,0.5)) for visual separation from background, increased letter-spacing (0.05-0.1em) - creates clear typographic hierarchy, ensures labels stand out from character illustration background, maintains otome game aesthetic with elegant typography.
- Q: What button styling should action buttons use on data entry screens? → A: Action buttons on data entry screens MUST use equal width (full-width or equal flex distribution), unified glassmorphism base styling (background rgba(255,255,255,0.25), backdrop-filter blur(30px), border 1px solid rgba(255,255,255,0.4)), primary action button ("AI Diagnosis"/"Save Record") MUST have pink-purple gradient border highlight (2px solid with gradient from #FF7E9D to #A78BFA) or pink glow effect to emphasize importance, secondary button ("Cancel") uses standard glassmorphism without gradient - creates clear visual hierarchy, ensures primary action is prominent and guideable.
- Q: What layout spacing and positioning should form elements use on data entry screens? → A: Form elements on data entry screens MUST be positioned in bottom half of screen (form container aligned to bottom 50-60% of viewport), input containers MUST have increased vertical spacing (24-32px between containers), character illustration MUST be visible in upper half of screen (showing Bai Qi's face/upper body for "watching you fill" emotional connection), dialogue bubble positioned above form with clear separation (60-80px gap from first input), form content uses max-width constraint (max-w-2xl) and centered alignment - creates spacious layout, ensures character presence is visible, prevents cramped feeling, maintains emotional connection through visible character gaze.
- Q: What is the critical layout requirement to prevent dialogue bubble from blocking input fields and ensure Bai Qi's face is visible? → A: Data entry screens (e.g., /health/symptoms route) MUST strictly enforce layout constraints: (1) Dialogue bubble MUST NEVER overlap or block any input fields - dialogue bubble MUST be positioned in top 20% of screen (top-16 or similar, with pointer-events: none to ensure it doesn't interfere with form interactions), (2) ALL form cards/input containers MUST be positioned in bottom 60% of screen (form container MUST use flex justify-end or bottom-aligned positioning, starting from 40% viewport height from top), (3) Bai Qi's face/upper body area MUST be clearly visible in upper 40% of screen (character illustration MUST NOT be obscured by form elements, character layer positioned with z-index below form but visible in upper region) - creates clear visual separation, ensures usability (no blocked inputs), maintains emotional connection through visible character presence, prevents cramped layout feeling.
- Q: What are the premium UI reconstruction requirements for "Baiqi's Private Consultation Room" layout? → A: Data entry screens (e.g., /health/symptoms route) MUST implement premium UI reconstruction: (1) Dialogue bubble positioning: dialogue bubble MUST be positioned at Bai Qi's shoulder level (upper shoulder area, not top-center), bubble size MUST be reduced (compact design), MUST NEVER overlap input fields, (2) Form layout: form cards MUST be positioned lower on screen with minimum 15px spacing between cards (breathing room), cards MUST have asynchronous floating animation (subtle Y-axis displacement ±3-5px, independent timing delays like 0s, 0.4s, 0.8s creating staggered breathing effect), (3) Premium glassmorphism: ALL backgrounds MUST use rgba(255, 255, 255, 0.15) (remove any gray backgrounds), backdrop-filter MUST be blur(35px), border MUST be 1.5px solid rgba(255, 255, 255, 0.4) (white glowing border), (4) Avatar refinement: MUST remove default blue avatar placeholder, use Bai Qi's semi-transparent small avatar OR remove avatar frame entirely (text-only dialogue bubble with refined glassmorphism), (5) Typography: labels ("症状", "严重程度", etc.) MUST use bold font weight (700), color #5A4E4E (deep pink-gray), subtle white text-shadow (0 1px 2px rgba(255,255,255,0.6)) for readability against background - creates premium consultation room aesthetic, ensures no visual interference, maintains emotional warmth through character presence and refined glassmorphism.
- Q: What are the simplified form and conversational interaction requirements for symptom logging? → A: Symptom logging screen (/health/symptoms route) MUST implement simplified conversational form design: (1) Unified text input: MUST remove segmented form fields (delete "严重程度" severity selector and "附加备注" notes field), replace with single large "自由描述区" (free description area) textarea for all symptom input, (2) Multimodal input: MUST add prominent "上传病历/处方" (Upload Medical Records/Prescription) button below input area, support image upload (accept image/* file types), display selected images as small thumbnails in interface, (3) Intelligent severity extraction: AI MUST automatically analyze severity from user's free-form text description (no manual severity selection required), severity extraction happens during AI analysis, (4) Conversational button labeling: primary action button MUST display "交给他看看" (Let him take a look) instead of "AI Diagnosis", maintains conversational, companion-focused tone, (5) Inline AI feedback: AI suggestions/results MUST display directly above input area (not in separate card below), create "you ask, he answers" instant conversational feel, feedback appears as dialogue-style response, (6) Emotional save confirmation: when saving record, interface MUST display message "他已将你的情况记在心上。" (He has remembered your situation in his heart.) instead of generic "Saved" message, emphasizes emotional connection and companion care - creates natural conversational flow, reduces form complexity, enhances emotional engagement through companion character interaction.
- Q: What is the required form content area positioning for symptom logging screen? → A: Symptom logging screen (/health/symptoms route) form content area MUST be positioned higher on screen (NOT restricted to bottom 60% region), form container MUST use flexible positioning that allows content to be brought up closer to screen center or upper-middle area, dialogue bubble MUST remain positioned at Bai Qi's shoulder level (top-24 to top-32) and MUST NEVER overlap or block input fields, Bai Qi's face/upper body MUST remain visible in upper portion of screen, form content uses max-width constraint (max-w-2xl) and centered alignment with appropriate top padding (e.g., paddingTop: 120-140px or similar) to bring content area up while maintaining clear separation from dialogue bubble - removes restrictive bottom 60% positioning requirement, allows more natural content flow, maintains usability and character visibility.
- Q: What are the critical UI refinements for conversational AI boyfriend experience on symptom logging screen? → A: Symptom logging screen (/health/symptoms route) MUST implement conversational AI boyfriend experience refinements: (1) Dialogue bubble character icon and alignment: dialogue bubble displaying "哪里不舒服吗？别瞒着我。" MUST have Bai Qi's small avatar icon on the left side of the bubble (use CharacterAvatar component, small size), creating conversational dialogue format where character speaks to user, emphasizes AI boyfriend role and conversational nature, dialogue bubble MUST be left-aligned (use justify-start instead of justify-center, position at left side with px-5 padding), dialogue bubble MUST be positioned at top-20 (80px from top) to ensure it does not overlap input area, content area MUST start at paddingTop: 180px (sufficient spacing to prevent any overlap with dialogue bubble, ensures clear visual separation and prevents input obstruction), dialogue bubble MUST NOT overlap or block the "自由描述区" (free description area) input field below it under any circumstances, (2) Free description area size: textarea MUST be reduced in height (from 10 rows to 6-8 rows maximum) to reduce space occupation, maintains functionality while allowing more screen space for other elements, (3) Fixed bottom button with equal width: action buttons ("交给他看看" and "Cancel") MUST be fixed at bottom of screen (use fixed positioning with bottom: 0 or similar, ensure buttons remain visible and accessible even when content area scrolls), buttons MUST NOT be pushed off-screen by content area, both buttons MUST have exactly equal width (wrap Cancel button in flex-1 div wrapper to match structure of primary button wrapper, ensure both use flex-1 class for equal distribution), create persistent action area for user interaction - creates authentic conversational AI boyfriend experience, maintains functional usability, ensures all interactive elements remain accessible, provides consistent visual balance.
- Q: What are the refined UI design requirements for border-free input, paperclip attachment aesthetic, dynamic placeholder, and Polaroid-style image previews on symptom logging screen? → A: Symptom logging screen (/health/symptoms route) MUST implement refined UI design elements: (1) Border-free input styling: textarea input field MUST remove all visible rectangular borders (no solid border lines), input area MUST be distinguished using ONLY one of the following methods: (a) subtle bottom border line (1px solid rgba(255, 255, 255, 0.3) or similar, positioned at bottom edge of textarea), OR (b) background glassmorphism depth variation (slightly darker/lighter rgba values to create visual separation from surrounding glassmorphism container without hard borders), input area MUST appear like semi-transparent stationery paper (信纸) floating within glassmorphism container, creates soft, organic feel matching companion aesthetic, (2) Paperclip attachment aesthetic: MUST remove large "上传病历/处方" button below input area, MUST add refined paperclip icon (Paperclip icon from lucide-react or custom SVG) positioned at top-right or bottom-right corner of "自由描述区" textarea container (absolute positioning within container, small size 20-24px, glassmorphism styling matching container), clicking paperclip icon opens file picker (same image upload functionality), uploaded medical record images MUST be displayed as "attached photos" tilted/rotated (rotate -5deg to 5deg) and positioned at edge of description container (like paperclipped documents), images MUST appear to be "clipped" to the edge rather than occupying large grid space, creates intimate "sharing evidence" feeling, (3) Dynamic emotional placeholder text: placeholder text MUST NOT use generic "描述您的症状..." (Describe your symptoms...), MUST use emotionally engaging, guiding text like "哪怕只有一点点不舒服，也要告诉我。" (Even if it's just a little discomfort, tell me.) OR "今天有哪里让你困扰吗？" (What's bothering you today?), placeholder text MUST rotate between 2-3 emotional variations on each page load or focus event, maintains companion's caring, attentive tone, (4) Polaroid-style image previews: uploaded medical record image thumbnails MUST have white border frame (2-3px solid white border) around each image, images MUST have subtle shadow (box-shadow: 0 2px 8px rgba(0,0,0,0.15)) creating Polaroid photo effect, images MUST maintain tilted/rotated positioning (as per paperclip aesthetic), creates "collecting evidence" narrative immersion, enhances emotional connection through visual storytelling - transforms clinical data entry into intimate sharing experience, maintains companion system aesthetic while improving usability and emotional engagement.
- Q: How should the AI conclusion be displayed on symptom logging screen to maintain conversational dialogue format? → A: Symptom logging screen (/health/symptoms route) MUST display AI analysis conclusion as a dialogue bubble that REPLACES the initial prompt dialogue bubble (NOT displayed as separate element below it): (1) Initial prompt dialogue bubble: dialogue bubble displaying "哪里不舒服吗？别瞒着我。" (What's bothering you? Don't hide it from me.) MUST be displayed at Bai Qi's shoulder level (top-20, left-aligned) with CharacterAvatar icon on the left side, using premium glassmorphism styling (background rgba(255, 255, 255, 0.15), backdrop-filter blur(35px), border 1.5px solid rgba(255, 255, 255, 0.4)), (2) AI conclusion replacement: when AI analysis completes, the initial prompt dialogue bubble MUST be REPLACED (not supplemented) by the AI conclusion dialogue bubble, AI conclusion bubble MUST use the EXACT SAME positioning, styling, and layout as the initial prompt bubble (same position at top-20, left-aligned, same glassmorphism styling, same CharacterAvatar icon on the left side), AI conclusion content MUST display the AI analysis results (observations, suggestions) in Bai Qi's first-person conversational boyfriend tone (per FR-037(9) clarification), AI conclusion bubble MUST maintain the same visual format as initial prompt (CharacterAvatar icon on left, text content on right, same padding and spacing), creates seamless conversational flow where character responds to user's input, maintains consistent dialogue bubble appearance throughout interaction, emphasizes conversational nature of AI boyfriend companion - transforms AI analysis from clinical output into natural dialogue response, maintains emotional connection and companion character authenticity.

### Session 2026-01-25 (UX Refinements)

- Q: What tone and language style should AI responses use when analyzing symptoms or providing feedback? → A: AI responses (e.g., symptom analysis, health feedback, meal suggestions) MUST use Bai Qi's conversational, boyfriend-like tone and MUST NOT use formal, manual-style language. PROHIBITED language patterns: "您使用了...表情" (You used...expression), "这通常代表..." (This usually represents...), "根据分析..." (According to analysis...), "建议您..." (We recommend that you...), "观察发现..." (Observations show...), "通常表示..." (Usually indicates...), or any other instructional/manual-style phrasing. REQUIRED language style: Responses MUST be in Bai Qi's first-person voice as a caring boyfriend character, using natural, conversational language like "看到这个表情，我知道你现在很难受...听我的，先喝点温水，好吗？" (Seeing this expression, I know you're feeling really unwell right now...Listen to me, drink some warm water first, okay?), "我注意到你提到...这让我有点担心" (I noticed you mentioned...this worries me a bit), "我们一起想想办法，好吗？" (Let's think of a solution together, okay?), "你刚才说的...让我觉得可能是..." (What you just said...makes me think it might be...), responses MUST feel like a caring partner speaking directly to the user, not like reading from a manual or instruction book, maintains emotional connection and companion character authenticity, creates intimate "talking to boyfriend" feeling rather than clinical consultation - transforms AI feedback from formal analysis into personal, caring conversation.
- Q: How should character dialogue bubble be positioned on data entry screens to avoid blocking input fields? → A: Character dialogue bubble on data entry screens MUST be positioned in non-interactive area (e.g., top-center with sufficient margin from first input field, or floating above form with clear separation), MUST NOT overlap or block any input fields, dialogue bubble can use floating/overlay positioning with higher z-index but MUST ensure all form inputs remain fully accessible and unobstructed - maintains companion presence without compromising usability.
- Q: What glassmorphism styling should input containers use for optimal text readability? → A: Input containers on data entry screens MUST use enhanced glassmorphism with increased background opacity (rgba(255, 255, 255, 0.25) minimum) and higher blur value (blur(30px) or higher) for better text contrast, placeholder text MUST use darker color (#4A4A4A with 0.7-0.8 opacity) to ensure readability against blurred background, labels MUST use bold font weight and #4A4A4A color with subtle white text-shadow for visual hierarchy - ensures clean, premium appearance matching home screen aesthetic, prevents muddy/dirty visual effect.
- Q: What typography styling should form labels and titles use on data entry screens? → A: Form labels and titles on data entry screens MUST use deep gray-pink color (#4A4A4A), bold font weight (600-700), increased font size (14-16px for labels, 18-20px for section titles), subtle white text-shadow (0 1px 2px rgba(255,255,255,0.5)) for visual separation from background, increased letter-spacing (0.05-0.1em) - creates clear typographic hierarchy, ensures labels stand out from character illustration background, maintains otome game aesthetic with elegant typography.
- Q: What button styling should action buttons use on data entry screens? → A: Action buttons on data entry screens MUST use equal width (full-width or equal flex distribution), unified glassmorphism base styling (background rgba(255,255,255,0.25), backdrop-filter blur(30px), border 1px solid rgba(255,255,255,0.4)), primary action button ("AI Diagnosis"/"Save Record") MUST have pink-purple gradient border highlight (2px solid with gradient from #FF7E9D to #A78BFA) or pink glow effect to emphasize importance, secondary button ("Cancel") uses standard glassmorphism without gradient - creates clear visual hierarchy, ensures primary action is prominent and guideable.
- Q: What layout spacing and positioning should form elements use on data entry screens? → A: Form elements on data entry screens MUST be positioned in bottom half of screen (form container aligned to bottom 50-60% of viewport using flex justify-end), input containers MUST have increased vertical spacing (24-32px between containers, using space-y-6 or similar), character illustration MUST be visible in upper half of screen (showing Bai Qi's face/upper body for "watching you fill" emotional connection), dialogue bubble positioned above form with clear separation (60-80px gap from first input, top-16 positioning), form content uses max-width constraint (max-w-2xl) and centered alignment, form container uses padding-top (100-120px) to create clear separation from dialogue bubble - creates spacious layout, ensures character presence is visible, prevents cramped feeling, maintains emotional connection through visible character gaze.

### Session 2026-01-23

- Q: How should the companion character integrate with existing Health/Nutrition/Emotion modules? → A: Character serves as unified entry layer - all Health/Nutrition/Emotion functions accessed through conversational interaction with the character, maintaining the "companion" feel rather than direct tool access.
- Q: What is the balance between conversational interaction and direct functional interfaces? → A: Conversations are primarily for emotional support and guidance - functional modules maintain independent interfaces, with character providing emotional support and guiding dialogue only.
- Q: How should the home screen entry point be designed with the companion character? → A: Home screen displays three entry cards (Health, Nutrition, Emotion), character appears with dialogue bubble asking "Which one would you like to choose?" - user clicks entry card to navigate to corresponding module, character provides guidance and support within modules.
- Q: Should users wait for character dialogue before seeing entry cards, or can they interact immediately? → A: Character asks question simultaneously with entry cards visible - users can click entry cards immediately without waiting for dialogue completion, character provides guidance but does not block interaction.
- Q: How should the character be displayed on the home screen? → A: Character displayed as medium-sized illustration (30-40% of screen height) at top of home screen, dialogue bubble positioned next to or below character, three entry cards displayed below character - creates clear visual hierarchy with character as welcoming guide.
- Q: What route path should the home screen with character and entry cards use? → A: Home screen uses root path "/", replacing current redirect to "/health" - users see character and three entry cards when opening app, aligns with "character as unified entry layer" design philosophy.
- Q: Should character dialogue on home screen vary based on character state, or remain fixed? → A: Character dialogue dynamically changes based on state (mood, closeness, time-of-day) but remains concise - e.g., morning with high closeness: "Good morning! Where would you like to start today?", low closeness: "Hello, which function would you like to choose?" - reflects character personality without overwhelming home screen.
- Q: What visual style should the home screen and companion interface use? → A: MUST use authentic otome/dating-sim game aesthetic - ornate decorative elements (floral patterns, hearts, stars), rich romantic color palette (deep pinks, roses, lavenders), elaborate borders and frames, detailed character illustrations (not generic placeholders), elegant typography, luxurious textures and gradients - avoid plain/minimalist design, create immersive romantic atmosphere typical of otome games.
- Q: When should the companion initiate conversations vs. waiting for user input? → A: Hybrid active+passive mode - character proactively initiates daily greetings and reminders (e.g., morning greetings, meal reminders), while users can also initiate conversations at any time.
- Q: How much should character state (mood, closeness, energy, time-of-day) influence dialogue and functionality? → A: Moderate influence - state affects dialogue tone, topic selection, and proactive initiation frequency, but does not change core functional access.
- Q: How should character assets (2D anime character images, dialogue templates, configuration) be managed? → A: Configuration files + resource directories - character metadata (name, dialogue templates, state thresholds) via JSON/YAML config, image assets stored in directories, with multilingual text resource support.
- Q: What should be the request behavior when home screen loads? → A: Home screen MUST generate greeting once when character state is ready (not on every render), if generation fails display default template greeting, prevent duplicate requests using ref flags - ensures single request per page load, avoids frequent API calls, maintains responsive UI.
- Q: How should the UI be refined to remove "paper feel" and add "layering feel" with transparent glass floating on beautiful poster? → A: Background: full-screen background image with slight dynamic zoom effect (remove center blue avatar block). Dialog boxes: Glassmorphism style with background #ffffff66, backdrop-filter: blur(15px), border-radius: 24px, remove heavy shadows, add 1px white semi-transparent border, text color dark gray-pink for readability. Navigation: Floating Bottom Bar (pill-shaped capsule floating at bottom, not full-width), semi-transparent, remove text below icons or use smaller lighter font (Montserrat or PingFang Light). Details: Add random floating semi-transparent light particles (SVG or CSS animation) for romance feel. Color scheme: Soft dreamy style - main: #FDEEF4 (cherry pink), secondary: #FFFFFF, accent: #FFD1DC. Overall: UI should be transparent glass floating on beautiful poster, remove paper feel, emphasize layering.
- Q: How should the home screen entry mechanism work - static entry cards or interactive radial menu? → A: Radial menu (炸裂式菜单) - home screen displays character illustration centered with breathing text at bottom. User clicks character illustration (center/chest area) to trigger radial menu: 4 icons (Health→top-left, Nutrition→top-right, Emotion→bottom-left, Settings→bottom-right) explode outward from click point in circular/arc trajectories with spring animation, glassmorphism styling, subtle glow halos, background blur effect. Clicking background dismisses menu (icons retract to center). Creates immersive "character responding to touch" game-like interaction, avoiding static card feel.
- Q: How should the transition from radial menu icon to full-screen data panel work? → A: Icon expansion transition - when user clicks radial menu icon (e.g., Health), clicked icon instantly scales up to fill screen, seamlessly transitions to full-screen data panel (e.g., health chart panel), panel slides up from bottom with smooth animation - creates visual continuity from icon to content, maintains immersive game-like feel, avoids abrupt navigation jump.
- Q: What visual design style should full-screen health charts use? → A: Neon glow aesthetic with glassmorphism - line charts use purple/pink gradient lines with outer glow effect (filter: drop-shadow or CSS glow), background is semi-transparent glassmorphism (#ffffff33 with backdrop-filter blur), remove coordinate axis grid lines, display only key node numbers, line chart animates left-to-right drawing effect on panel entry - avoid traditional white background black lines office-style charts, create romantic game-like visual experience matching otome aesthetic.
- Q: How should the companion character be displayed in full-screen data panels to maintain companionship feel? → A: Bottom-right corner companion element - small character avatar/silhouette (reduced size, 60-80px) positioned at bottom-right corner of chart panel, accompanied by small dialogue bubble displaying data interpretation text (e.g., "今天的步数很棒，要注意膝盖哦" / "Today's steps look great, but remember to take care of your knees") - character interpretation dynamically generated based on chart data and character state, maintains companionship feel even in data-focused screens, does not obstruct chart visibility.
- Q: How should character data interpretation text in full-screen charts be generated - AI or templates? → A: AI generation with template fallback - system MUST prioritize LLM-generated personalized interpretation based on chart data and character state (mood, closeness), if AI generation fails or times out (>2 seconds) gracefully fallback to predefined template messages from character configuration - ensures reliability while maintaining personalized companion feel, consistent with dialogue generation pattern (FR-006, NFR-006).
- Q: How should the global background and character layer be implemented for premium visual quality? → A: System MUST use full-screen ImageBackground component as base layer covering entire app - remove any blue placeholder boxes or generic character placeholders, use high-quality atmospheric anime background image (e.g., https://i.pinimg.com/564x/a6/39/19/a639190333210fb5da77b4903661354e.jpg or similar light-toned anime scenery), apply subtle white gradient overlay (linear gradient from transparent at top to white at bottom) for text readability, background image must cover entire screen without gaps, create immersive atmospheric foundation for glassmorphism layers.
- Q: How should glassmorphism components be refined for premium transparent glass effect? → A: System MUST implement true glassmorphism with: background color rgba(255, 255, 255, 0.15) (extremely transparent white), backdrop-filter: blur(25px) (strong blur effect), border width 1px with border color rgba(255, 255, 255, 0.4) (subtle bright border), box-shadow: 0 4px 24px rgba(255, 255, 255, 0.2) (soft white outer glow), text color #4A4A4A (dark gray for readability) - apply to all dialog boxes, navigation bars, radial menu icons, and floating UI elements - remove heavy/thick appearance, create premium transparent glass floating effect.
- Q: How should icons be implemented to replace emoji for professional appearance? → A: System MUST use linear icon library (lucide-react or similar) instead of emoji for all navigation and menu icons - Home: Home icon (thin line house), Health: Activity or HeartPulse icon (ECG line), Nutrition: Leaf or Apple icon (minimalist line apple), Emotion: Heart icon (thin line heart), Companion: MessageCircle icon (thin line bubble), Settings: Settings icon - all icons use consistent color #FF7E9D (deep pink), maintain touch target size 44x44px minimum, ensure icons are crisp and scalable.
- Q: How should the character illustration layer be implemented to replace blue placeholder boxes? → A: System MUST completely remove any blue placeholder boxes or generic character placeholders (including blue circular/square View containers). Character layer MUST be implemented as full-screen or near-full-screen Image component positioned above background layer but below all dialog boxes and navigation bars. Use high-quality 2D anime male character illustration (e.g., https://i.pinimg.com/564x/8b/9a/36/8b9a368031f439d94631df685c360739.jpg) as temporary placeholder. Set resizeMode to "cover" or "contain" (prefer "cover" for full-screen effect, "contain" if character must be fully visible without being obscured by bottom glass navbar). Ensure character appears to stand in background. All glassmorphism dialog boxes and navigation bars MUST float above character layer with proper z-index layering (character layer: z-index 1-5, dialogs/navbar: z-index 10+).

## User Scenarios & Testing

### User Story 1 - Daily Companion Interaction (Priority: P1)

**User Intent**: Users want to feel like they're interacting with a real person who cares about them, reducing loneliness and providing emotional support through daily conversations.

**Why this priority**: This is the foundational experience that transforms the app from a tool into a companion. Daily interaction builds the relationship and creates emotional attachment.

**Independent Test**: Can be fully tested by opening the app, receiving a greeting from the companion, engaging in conversation, and feeling emotionally supported. Works independently of functional modules.

**Acceptance Scenarios**:

1. **Given** a user opens the app, **When** they see the companion character, **Then** the character greets them appropriately based on time-of-day and relationship state (closeness level)
2. **Given** a user engages in conversation, **When** they express emotions or concerns, **Then** the companion responds with empathetic, context-aware dialogue that reflects current mood and closeness state
3. **Given** a user has been inactive for several hours, **When** they return to the app, **Then** the companion proactively initiates conversation with appropriate greeting based on time-of-day
4. **Given** a user interacts daily over time, **When** they check their relationship state, **Then** they see increasing closeness levels that reflect the growing relationship

---

### User Story 2 - Companion-Guided Health Activities (Priority: P2)

**User Intent**: Users want to engage in health tracking activities (symptom logging, meal recording) framed as "doing things together" with the companion, rather than completing tasks alone.

**Why this priority**: This bridges emotional connection with practical health benefits, making health tracking feel less clinical and more supportive.

**Independent Test**: Can be fully tested by the companion suggesting a health activity, user completing it through conversation, and receiving encouraging feedback. Integrates with existing Health module.

**Acceptance Scenarios**:

1. **Given** a user is in conversation with the companion, **When** the companion suggests logging symptoms or meals, **Then** the user can complete the activity through dialogue, then be redirected to the functional module interface
2. **Given** a user completes a health activity, **When** they return to conversation, **Then** the companion acknowledges their action with encouraging, context-aware feedback
3. **Given** a user has not logged symptoms for several days, **When** the companion notices this pattern, **Then** the companion gently reminds them with empathetic dialogue, not pushy notifications

---

### User Story 3 - Emotional Support Through Conversation (Priority: P2)

**User Intent**: Users want to express feelings, receive empathetic responses, and feel less alone through natural conversation with the companion.

**Why this priority**: Emotional well-being is core to the companion experience. This directly addresses loneliness and overthinking through supportive dialogue.

**Independent Test**: Can be fully tested by user expressing emotions in conversation, receiving empathetic responses, and feeling emotionally supported. Works independently but complements Emotional module.

**Acceptance Scenarios**:

1. **Given** a user expresses sadness or stress in conversation, **When** the companion responds, **Then** the response is empathetic, non-judgmental, and reflects current closeness level and mood state
2. **Given** a user shares a concern about health or life, **When** the companion responds, **Then** the response is supportive and may gently guide toward relevant functional modules without being pushy
3. **Given** a user has low closeness level, **When** they express emotions, **Then** the companion responds warmly but appropriately for early relationship stage

---

## Requirements

### Functional Requirements

#### Companion Character Core

- **FR-001**: System MUST display a 2D anime male character as the central companion on the main interaction screen
- **FR-002**: System MUST support character avatars (small circular images) and full character illustrations embedded in dialogue
- **FR-003**: System MUST maintain character state including: mood, closeness level, energy level, and time-of-day awareness
- **FR-004**: System MUST allow character to proactively initiate conversations based on time-of-day, user activity patterns, and relationship state
- **FR-005**: System MUST allow users to initiate conversations with the companion at any time
- **FR-006**: System MUST generate context-aware dialogue responses that reflect character state (mood, closeness, energy, time-of-day)
- **FR-007**: System MUST support occasional choice-based dialogue where users select from 2-5 predefined response options (very limited use)
- **FR-008**: System MUST store conversation history locally with timestamps
- **FR-009**: System MUST display relationship metrics (e.g., closeness level) visually, such as badges or indicators on character avatar

#### Character State System

- **FR-010**: System MUST track and persist closeness level (numeric value, e.g., 0-100) that increases with daily interaction
- **FR-011**: System MUST track character mood state (e.g., happy, calm, concerned, energetic) that influences dialogue tone
- **FR-012**: System MUST track character energy level (low/medium/high) that affects proactive initiation frequency
- **FR-013**: System MUST be aware of time-of-day (morning, afternoon, evening, night) for contextually appropriate greetings and dialogue
- **FR-014**: System MUST update character state based on interaction patterns, user responses, and time passage
- **FR-015**: System MUST allow character state to moderately influence dialogue tone, topic selection, and proactive initiation frequency, but NOT restrict core functional access

#### Integration with Existing Modules

- **FR-016**: System MUST allow companion to guide users toward Health, Nutrition, and Emotion modules through conversational dialogue
- **FR-017**: System MUST maintain independent functional interfaces for Health, Nutrition, and Emotion modules (conversation is for emotional support, not functional access) - users can access these modules via: (1) function spheres in upper right corner (direct navigation), (2) radial menu icons (icon expansion to data panels), (3) bottom navigation tabs, (4) companion dialogue suggestions (navigates to functional screens)
- **FR-018**: System MUST allow companion to acknowledge user actions in functional modules when user returns to conversation
- **FR-019**: System MUST frame health activities (symptom logging, meal recording) as "doing things together" rather than task completion

#### Character Assets & Configuration

- **FR-020**: System MUST store character metadata (name, dialogue templates, state thresholds) in JSON/YAML configuration files
- **FR-021**: System MUST store character images (avatars, full illustrations, background scenes) as resource files in designated directories
- **FR-022**: System MUST support multilingual text resources for character dialogue and UI elements (i18n friendly)
- **FR-023**: System MUST allow character configuration to be updated without code changes (config-driven, not hardcoded)

#### UI/UX Requirements

- **FR-024**: System MUST display conversation interface with chat-like bubbles (character messages left-aligned, user messages right-aligned)
- **FR-025**: System MUST display scene backgrounds (e.g., cityscape with floral overlays) that can change based on time-of-day or mood
- **FR-026**: System MUST display character avatars next to character messages
- **FR-027**: System MUST support embedding full character illustrations within dialogue bubbles
- **FR-028**: System MUST provide navigation header with back button, character name, and optional action buttons
- **FR-029**: System MUST provide call-to-action footer for additional interactions (e.g., "Contact by phone", "Chat freely")
- **FR-030**: System MUST use authentic otome/dating-sim game aesthetic: ornate decorative elements (floral patterns, hearts, stars, ribbons), rich romantic color palette (deep pinks, roses, lavenders, purples), elaborate borders and frames, detailed character illustrations (not generic placeholders), elegant typography with decorative fonts, luxurious textures and gradients, immersive romantic atmosphere - avoid plain/minimalist design, create visually rich experience typical of otome games. UI MUST emphasize layering feel (transparent glass floating on beautiful poster) and remove paper feel - background images with dynamic effects, glassmorphism layers, floating elements create depth and immersion.
- **FR-030A**: System MUST implement Glassmorphism (毛玻璃) design pattern: character illustration as separate layer above background but below dialog boxes and navigation bars, functional modules (entry cards, dialogue bubbles, data panels) displayed as semi-transparent glass cards with backdrop-filter: blur effect, maintaining visual immersion while ensuring functional usability - reference "Love and Producer" (恋与制作人) UI style with modern glassmorphism effects
- **FR-030B**: System MUST implement refined Glassmorphism dialog boxes with: background color rgba(255, 255, 255, 0.15) (extremely transparent white), backdrop-filter: blur(25px) (strong blur effect), border-radius: 24px, border width 1px with border color rgba(255, 255, 255, 0.4) (subtle bright border), box-shadow: 0 4px 24px rgba(255, 255, 255, 0.2) (soft white outer glow), text color #4A4A4A (dark gray for readability) - create premium transparent glass floating effect, remove heavy/thick appearance, apply to all dialog boxes, navigation bars, radial menu icons, and floating UI elements
- **FR-031**: System MUST display home screen at root path "/" with: full-screen ImageBackground component covering entire app as base layer (use high-quality atmospheric anime background image, e.g., https://i.pinimg.com/564x/a6/39/19/a639190333210fb5da77b4903661354e.jpg or similar light-toned anime scenery), apply subtle white gradient overlay (linear gradient from transparent at top to white at bottom) for text readability, character illustration as full-screen or near-full-screen Image component positioned above background layer but below all dialog boxes and navigation bars (use high-quality 2D anime male character illustration, e.g., https://i.pinimg.com/564x/8b/9a/36/8b9a368031f439d94631df685c360739.jpg as temporary placeholder), set resizeMode to "cover" or "contain" (prefer "cover" for full-screen effect, "contain" if character must be fully visible without being obscured by bottom glass navbar), breathing text at bottom (fade in/out animation), state-aware greeting dialogue bubble using refined glassmorphism effect (per FR-030B) - completely remove any blue placeholder boxes or generic character placeholders (including blue circular/square View containers), ensure proper z-index layering (character layer: z-index 1-5, dialogs/navbar: z-index 10+), create immersive atmospheric foundation for glassmorphism layers
- **FR-031D**: System MUST implement radial menu (炸裂式菜单) triggered by clicking character illustration (center/chest area): 4 icons (Health, Nutrition, Emotion, Settings) explode outward from click point in circular/arc trajectories - Health icon flies to top-left, Nutrition to top-right, Emotion to bottom-left, Settings to bottom-right - icons MUST use true glassmorphism styling per FR-030B (background rgba(255, 255, 255, 0.15), backdrop-filter: blur(25px), border 1px rgba(255, 255, 255, 0.4), box-shadow: 0 4px 24px rgba(255, 255, 255, 0.2)), spring animation (elastic bounce effect) with scale (0→1) and opacity (0→1) transitions, background character illustration blurs slightly (backdrop-filter: blur(5px)) when menu is open - clicking background area dismisses menu (icons retract to center with reverse animation) - creates immersive "character responding to touch" game-like interaction, avoiding static card feel
- **FR-031E**: System MUST implement icon expansion transition when user clicks radial menu icon (NOT function spheres): clicked radial menu icon instantly scales up to fill entire screen (scale animation from icon size to full viewport), seamlessly transitions to full-screen data panel (e.g., health chart panel, nutrition panel, emotion panel), panel slides up from bottom with smooth animation (300-500ms duration, ease-out timing) - creates visual continuity from icon to content, maintains immersive game-like feel, avoids abrupt navigation jump - back button (top-left corner) dismisses panel with reverse animation (panel slides down, returns to home screen with character) - NOTE: This requirement applies ONLY to radial menu icons triggered by clicking character illustration, NOT to function spheres in upper right corner
- **FR-031I**: System MUST implement function spheres (FunctionSpheres component) in upper right corner of home screen: three circular glassmorphism buttons (Health, Nutrition, Emotion) vertically stacked at fixed position (right-5, top: safe-area-inset-top + 20px), each sphere uses glassmorphism styling per FR-030B (background rgba(255, 255, 255, 0.2), backdrop-filter: blur(20px), border 1px rgba(255, 255, 255, 0.5), box-shadow with white glow), icons use lucide-react (HeartPulse for Health, Leaf for Nutrition, Heart or Smile for Emotion), color #FF7E9D (deep pink), size 48x48px (w-12 h-12), gap 20px (gap-5) between spheres - when clicked, function spheres MUST navigate directly to original functional screens using React Router navigation (useNavigate hook) with exact route mapping: top sphere (Health/HeartPulse icon) → /health route, middle sphere (Nutrition/Leaf icon) → /nutrition route, bottom sphere (Emotion/Heart or Smile icon) → /emotional route - function spheres serve as quick access shortcuts to existing functional modules, they do NOT trigger icon expansion transition or display full-screen data panels - maintains direct access to original Health/Nutrition/Emotion functionality without intermediate chart panels
- **FR-031F**: System MUST implement neon glow chart design for full-screen data panels (triggered by radial menu icons ONLY, NOT function spheres): line charts use purple/pink gradient lines (e.g., linear-gradient from #A78BFA to #F472B6), outer glow effect (CSS filter: drop-shadow or box-shadow with blur), background is semi-transparent glassmorphism (#ffffff33 with backdrop-filter: blur(15px)), remove coordinate axis grid lines completely, display only key node numbers (sparse labels for readability), line chart animates left-to-right drawing effect on panel entry (stroke-dasharray animation or progressive path rendering, 800-1200ms duration) - avoid traditional white background black lines office-style charts, create romantic game-like visual experience matching otome aesthetic, maintain visual consistency with glassmorphism design system - NOTE: These data panels are displayed when user clicks radial menu icons, function spheres navigate directly to functional screens without showing data panels
- **FR-031G**: System MUST display companion character element in full-screen data panels (radial menu data panels ONLY): small character avatar/silhouette (60-80px size) positioned at bottom-right corner of chart panel, accompanied by small dialogue bubble (glassmorphism style per FR-030B) displaying data interpretation text - interpretation dynamically generated based on chart data and character state (mood, closeness), examples: "今天的步数很棒，要注意膝盖哦" / "Today's steps look great, but remember to take care of your knees" - maintains companionship feel even in data-focused screens, does not obstruct chart visibility, creates emotional connection with data visualization - NOTE: This applies to radial menu data panels, not to original functional screens accessed via function spheres
- **FR-031H**: System MUST generate character data interpretation text using AI-first approach with template fallback (for radial menu data panels ONLY): prioritize LLM-generated personalized interpretation based on chart data and character state (mood, closeness, time-of-day), if AI generation fails or exceeds timeout (>2 seconds) gracefully fallback to predefined template messages from character configuration (dialogueTemplates.dataInterpretation), ensures reliability while maintaining personalized companion feel, consistent with dialogue generation pattern (FR-006, NFR-006) - interpretation text should be concise (1-2 sentences), contextually relevant to chart data, reflect character personality - NOTE: This applies to radial menu data panels, original functional screens accessed via function spheres maintain their existing functionality without character data interpretation
- **FR-031A**: System MUST implement Floating Bottom Bar navigation: pill-shaped capsule floating at screen bottom (not full-width), semi-transparent with glassmorphism effect, remove text labels below icons or use smaller lighter font (Montserrat or PingFang Light), maintain touch target size (44x44px minimum) - create floating navigation feel, remove heavy bottom bar
- **FR-031B**: System MUST add random floating semi-transparent light particles (SVG or CSS animation) in background for romance feel - particles should be subtle, slow-moving, and not interfere with UI interactions
- **FR-031C**: System MUST use soft dreamy color scheme: main color #FDEEF4 (cherry pink), secondary color #FFFFFF (white), accent color #FFD1DC (light pink) - create cohesive romantic atmosphere, avoid harsh contrasts
- **FR-033**: System MUST use linear icon library (lucide-react or similar) instead of emoji for all navigation and menu icons - Home: Home icon (thin line house), Health: Activity or HeartPulse icon (ECG line), Nutrition: Leaf or Apple icon (minimalist line apple), Emotion: Heart icon (thin line heart), Companion: MessageCircle icon (thin line bubble), Settings: Settings icon - all icons use consistent color #FF7E9D (deep pink), maintain touch target size 44x44px minimum, ensure icons are crisp and scalable - replace all emoji icons in bottom navigation bar and radial menu for professional appearance
- **FR-034**: System MUST refine Health Details Page (/health route) for companion system integration: (1) Hide bottom Floating Capsule navigation bar on /health route (navigation bar visible on other routes but hidden on /health), (2) Add frosted glass back button in top-left corner using ChevronLeft icon from lucide-react, background rgba(255, 255, 255, 0.2), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4), box-shadow with soft white glow, size 44x44px minimum touch target, clicking navigates to home page (/) using React Router, (3) Add character overlay: Bai Qi illustration scaled to ~25% of original size positioned at bottom-right corner (fixed position), with mini dialogue box (glassmorphism style per FR-030B) containing CharacterAvatar component and text "在这里记录一下吧，我会帮你看着的。" / "Record here, I'll help you keep track." (i18n support), dialogue box positioned adjacent to character illustration, (4) Replace three heavy white action cards with three full-width glassmorphism containers: each container spans full width (minus padding), equal height, background rgba(255, 255, 255, 0.15), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4), box-shadow: 0 4px 24px rgba(255, 255, 255, 0.2) (soft white glow), add slow continuous floating animation (Y-axis offset 2-3px, duration 3-4 seconds, ease-in-out, infinite loop with slight stagger delay between cards), maintain touch targets and click handlers for navigation to /health/upload, /health/symptoms, /health/timeline, (5) Typography refinement: "健康追踪" / "Health Tracking" title positioned at top-left (below back button), font color #4A4A4A (deep gray-pink), letter-spacing increased (0.1-0.15em), font size 24px (2xl), semibold weight (600) - creates immersive companion feel while maintaining functional access to health tracking features
- **FR-035**: System MUST implement "The Private Ledger" layout for Health Details Page (/health route): (1) Remove standard list layout completely, replace with three overlapping fan-shaped glassmorphism cards positioned in middle-lower screen area (like spread-out archive pages) - top card displays "记录症状" (Log Symptoms) linking to /health/symptoms, middle card displays "上传记录" (Upload Record) linking to /health/upload, bottom card displays "查看时间线" (View Timeline) linking to /health/timeline, (2) Fan-shaped card arrangement: top card rotated -8° (counter-clockwise), middle card rotated -4°, bottom card rotated 0° (vertical), vertical offset 40px between consecutive cards, horizontal offset 20px creating staggered left-right effect, cards overlap creating depth perception, (3) Background: maintain full-screen Bai Qi character illustration (CharacterLayer component) with same breathing animation as home screen (floatAnimation: translateY(-12px) scale(1.02) over 4s ease-in-out infinite, per CharacterLayer.tsx implementation), character illustration covers entire screen with z-index below cards, (4) Card material styling: background rgba(255, 255, 255, 0.2), backdrop-filter blur(25px), border 1px solid #FF7E9D (bright pink glow matching existing design system color), box-shadow with pink glow effect (0 4px 24px rgba(255, 126, 157, 0.3)), rounded corners (border-radius 24px), each card maintains full-width minus padding, equal height, (5) Card interaction: clicking any visible area of card triggers React Router navigation to corresponding route (/health/symptoms, /health/upload, /health/timeline), card executes upward spring animation on click using framer-motion spring animation: duration 400ms, stiffness 300, damping 25 (medium elasticity), upward translation ~20-30px with scale effect (1.0 → 1.05 → 1.0), animation completes before navigation, (6) Companion dialogue bubble: persistent dialogue bubble positioned above cards (60px above top card, horizontally centered), uses same glassmorphism style as home screen dialogue bubble (per FR-030B: background rgba(255, 255, 255, 0.4), backdrop-filter blur(30px), border-radius 24px, border 1px solid rgba(255, 255, 255, 0.55), box-shadow with soft glow), contains CharacterAvatar component (Bai Qi avatar) and text "这是我为你整理的记录，想先看哪一部分？" / "I've organized these records for you. Which part would you like to check first?" (i18n support via health.ledgerPrompt key), dialogue bubble remains visible and does not block card interactions, (7) Navigation simplification: completely remove bottom navigation bar on /health route (already implemented per FR-034), place large-sized back button (56x56px, significantly larger than standard 44px for one-handed operation) in top-left corner with blurred background (glassmorphism style matching FR-030B: background rgba(255, 255, 255, 0.2), backdrop-filter blur(25px), border 1px solid rgba(255, 255, 255, 0.4)), ChevronLeft icon from lucide-react, clicking navigates to home page (/) - creates immersive "private ledger" aesthetic with companion character integration, maintains functional access while enhancing emotional connection
- **FR-036**: System MUST refine Health Details Page (/health route) to align with Home Screen visual base and restore layering feel: (1) Background layering restoration: MUST wrap HealthHomeScreen component with ImageBackground component (same as home screen), use same background image URL as home screen (https://i.pinimg.com/564x/a6/39/19/a639190333210fb5da77b4903661354e.jpg), add SceneBackground component positioned at z-index 1 (same as home screen), add FloatingParticles component positioned at z-index 2 (same as home screen, count 20), CharacterLayer component positioned at z-index 3 with same floating animation (floatAnimation: translateY(-12px) scale(1.02) over 4s ease-in-out infinite), completely remove pure color background (#FDEEF4) - creates same atmospheric layering foundation as home screen, (2) Card material refinement: change card background from rgba(255, 255, 255, 0.2) to rgba(255, 255, 255, 0.15) (more transparent, matches premium glassmorphism per FR-030B), remove red/pink outer shadow (box-shadow: 0 4px 24px rgba(255, 126, 157, 0.3)), replace with 1px inner glow border: border 1px solid rgba(255, 255, 255, 0.6) (bright white semi-transparent, 60% opacity), maintain backdrop-filter blur(25px), remove border #FF7E9D pink glow, (3) Cleanup and element removal: completely remove any "图片加载失败" (image loading failed) placeholder elements or error states that break visual aesthetics, move companion dialogue bubble to above cards (60px above top card, horizontally centered), use same glassmorphism style as home screen dialogue bubble (background rgba(255, 255, 255, 0.4), backdrop-filter blur(30px), border-radius 24px, border 1px solid rgba(255, 255, 255, 0.55)), text color #4A4A4A (deep gray-pink matching home screen dialogue text), (4) Header and navigation refinement: completely hide Header component on /health route (extend Layout.tsx condition from !isHome to !isHome && location.pathname !== '/health', same logic as home screen), ensure back button uses subtle glassmorphism background (background rgba(255, 255, 255, 0.15), backdrop-filter blur(20px), border 1px solid rgba(255, 255, 255, 0.4)) instead of stronger blur, use Lucide ChevronLeft icon (linear icon, strokeWidth 2, size 28px), verify bottom navigation bar remains hidden on /health route (already implemented per FR-034), (5) Card positioning: position cards at screen middle-lower area using fixed positioning with transform: translate(-50%, -50%) and top: 60%, left: 50% (50% horizontal, 60% vertical - 20% below center), cards should appear to float at character chest position, creating "transparent glass cards floating at Bai Qi's chest, waiting to be browsed" feeling - creates immersive companion feel matching home screen aesthetic, removes office list feeling, maintains visual consistency with home screen layering
- **FR-037**: System MUST implement companion-integrated data entry screens (e.g., symptom logging /health/symptoms route) with "Baiqi's Private Consultation Room" simplified conversational AI boyfriend experience: (1) Background: full-screen Bai Qi character illustration background (same as Health Details Page, per FR-036) with ImageBackground, SceneBackground, FloatingParticles, and CharacterLayer components maintaining same layering and animations, character illustration MUST be visible in upper portion of screen (showing Bai Qi's face/upper body for "watching you fill" emotional connection, character layer positioned with z-index below form but visible in upper region), (2) Unified text input with border-free styling: MUST remove segmented form fields (delete "严重程度" severity selector and "附加备注" notes field completely), replace with single "自由描述区" (free description area) textarea for all symptom input, textarea MUST be appropriately sized (6-8 rows maximum to reduce space occupation, full-width minus padding), textarea input field MUST remove all visible rectangular borders (no solid border lines), input area MUST be distinguished using ONLY one of the following methods: (a) subtle bottom border line (1px solid rgba(255, 255, 255, 0.3) or similar, positioned at bottom edge of textarea), OR (b) background glassmorphism depth variation (slightly darker/lighter rgba values to create visual separation from surrounding glassmorphism container without hard borders), input area MUST appear like semi-transparent stationery paper (信纸) floating within glassmorphism container, use premium glassmorphism container styling (background rgba(255, 255, 255, 0.15), backdrop-filter blur(35px), border 1.5px solid rgba(255, 255, 255, 0.4), box-shadow with soft white glow, border-radius 12-16px), (3) Dynamic emotional placeholder text: placeholder text MUST NOT use generic "描述您的症状..." (Describe your symptoms...), MUST use emotionally engaging, guiding text like "哪怕只有一点点不舒服，也要告诉我。" (Even if it's just a little discomfort, tell me.) OR "今天有哪里让你困扰吗？" (What's bothering you today?), placeholder text MUST rotate between 2-3 emotional variations on each page load or focus event, placeholder text MUST use darker color (#5A4E4E with 0.7-0.8 opacity) for readability, maintains companion's caring, attentive tone, (4) Paperclip attachment aesthetic with enhanced visibility and separation: MUST remove large "上传病历/处方" (Upload Medical Records/Prescription) button below input area, MUST add refined paperclip icon (Paperclip icon from lucide-react or custom SVG) positioned at top-right or bottom-right corner of "自由描述区" textarea container (absolute positioning within container, larger size 28-32px for better visibility, glassmorphism styling with slightly stronger background rgba(255, 255, 255, 0.2) to create visual distinction from textarea), icon MUST include tooltip or label text "上传病历" (Upload Medical Record) displayed next to or below icon (small text, 12px, #5A4E4E color), icon MUST have subtle hover effect (scale 1.1, slight glow) to indicate interactivity, clicking paperclip icon opens file picker (same image upload functionality, accept image/* file types, use HTML input type="file" with accept="image/*"), uploaded medical record images MUST be displayed in a separate, visually distinct upload preview area below the textarea container (NOT within the same container as textarea), upload preview area MUST use its own glassmorphism container with clear visual separation (spacing 16-20px between textarea container and upload preview container), upload preview container MUST have label "已上传的病历" (Uploaded Medical Records) or similar text to clearly indicate its purpose, upload preview area MUST be visually distinct from text input area (different background opacity, border style, or subtle divider line), uploaded images MUST be displayed as "attached photos" tilted/rotated (rotate -5deg to 5deg) and positioned at edge of upload preview container (like paperclipped documents), images MUST appear to be "clipped" to the edge rather than occupying large grid space, creates intimate "sharing evidence" feeling while maintaining clear functional separation between text and image inputs, (5) Polaroid-style image previews: uploaded medical record image thumbnails MUST have white border frame (2-3px solid white border) around each image, images MUST have subtle shadow (box-shadow: 0 2px 8px rgba(0,0,0,0.15)) creating Polaroid photo effect, images MUST maintain tilted/rotated positioning (as per paperclip aesthetic), each thumbnail MUST have remove button, creates "collecting evidence" narrative immersion, enhances emotional connection through visual storytelling, (6) Intelligent severity extraction: AI MUST automatically analyze severity from user's free-form text description during AI analysis (no manual severity selection required, severity extraction happens automatically as part of AI analysis process), extracted severity stored in symptom entry but not displayed as form field, (7) Character dialogue bubble with avatar and AI conclusion replacement: dialogue bubble displaying "哪里不舒服吗？别瞒着我。" (What's bothering you? Don't hide it from me.) MUST be displayed at Bai Qi's shoulder level (top-20, left-aligned) with CharacterAvatar icon (size="sm") on the left side, using premium glassmorphism styling (background rgba(255, 255, 255, 0.15), backdrop-filter blur(35px), border 1.5px solid rgba(255, 255, 255, 0.4)), bubble size MUST be reduced (compact design, smaller padding and max-width), MUST NEVER overlap or block any input fields, content area MUST start at paddingTop: 180px to ensure clear separation, with pointer-events: none to ensure it doesn't interfere with form interactions, when AI analysis completes, the initial prompt dialogue bubble MUST be REPLACED (not supplemented) by the AI conclusion dialogue bubble, AI conclusion bubble MUST use the EXACT SAME positioning, styling, and layout as the initial prompt bubble (same position at top-20, left-aligned, same glassmorphism styling, same CharacterAvatar icon on the left side), AI conclusion content MUST display the AI analysis results (observations, suggestions) in Bai Qi's first-person conversational boyfriend tone (MUST NOT use formal manual-style language like "您使用了...", "这通常代表...", "根据分析...", responses MUST feel like caring partner speaking directly, e.g., "看到这个表情，我知道你现在很难受...听我的，先喝点温水，好吗？" / "Seeing this expression, I know you're feeling really unwell right now...Listen to me, drink some warm water first, okay?"), creates seamless conversational flow where character responds to user's input, maintains consistent dialogue bubble appearance throughout interaction, emphasizes conversational nature of AI boyfriend companion, (8) Conversational button labeling: primary action button MUST display "交给他看看" (Let him take a look) instead of "AI Diagnosis" (i18n support via health.symptoms.letHimLook key), maintains conversational, companion-focused tone, button changes to "保存" (Save) or equivalent after AI analysis completes, (9) Emotional save confirmation: when saving record successfully, interface MUST display message "他已将你的情况记在心上。" (He has remembered your situation in his heart.) instead of generic "Saved" message (i18n support via health.symptoms.rememberedInHeart key), emphasizes emotional connection and companion care, message displayed as toast notification or inline confirmation above form, (10) Typography: form labels MUST use bold font weight (700), color #5A4E4E (deep pink-gray), subtle white text-shadow (0 1px 2px rgba(255,255,255,0.6)) for readability against background, increased font size (16-18px for main label), increased letter-spacing (0.05-0.1em), (11) Header design: minimal glassmorphism back button (ChevronLeft icon from lucide-react) in top-left corner with no title text, using same styling as Health Details Page (background rgba(255,255,255,0.15), backdrop-filter blur(35px), border 1.5px solid rgba(255,255,255,0.4), 44x44px minimum touch target, clicking navigates to previous page), (12) Fixed bottom button styling: action buttons ("交给他看看"/"Save" and "Cancel") MUST be fixed at bottom of screen (use fixed positioning with bottom: 0, z-index 50, ensure buttons remain visible and accessible even when content area scrolls), buttons MUST NOT be pushed off-screen by content area, buttons MUST use equal width (wrap Cancel button in flex-1 div wrapper to match structure of primary button wrapper, ensure both use flex-1 class for equal distribution), unified premium glassmorphism base styling (background rgba(255,255,255,0.15), backdrop-filter blur(35px), border 1.5px solid rgba(255,255,255,0.4)), primary action button ("交给他看看"/"Save") MUST have pink-purple gradient border highlight (2px solid with gradient from #FF7E9D to #A78BFA) or pink glow effect, secondary button ("Cancel") uses standard premium glassmorphism without gradient, create persistent action area for user interaction, (13) Layout spacing and floating animation: form content area MUST be positioned higher on screen (NOT restricted to bottom 60% region), form container MUST use flexible positioning with appropriate top padding (paddingTop: 180px) and bottom padding (paddingBottom: 100px) to accommodate fixed bottom buttons, form container MUST use max-width constraint (max-w-2xl) and centered alignment, input containers MUST have minimum 15px vertical spacing between elements (breathing room), form cards MUST have asynchronous floating animation (subtle Y-axis displacement ±3-5px, independent timing delays creating staggered breathing effect, duration 3-4 seconds, ease-in-out, infinite loop), dialogue bubble positioned at shoulder level with clear separation from form (MUST NEVER overlap input fields), Bai Qi's face/upper body MUST remain visible in upper portion of screen - transforms clinical data entry into intimate sharing experience, creates authentic conversational AI boyfriend experience, maintains functional usability, ensures all interactive elements remain accessible, allows flexible content positioning without restrictive bottom alignment, enhances emotional connection through visual storytelling and refined UI details, improves discoverability of upload functionality through enhanced visibility and clear functional separation

### Non-Functional Requirements

#### Performance

- **NFR-001**: Character dialogue generation MUST respond within 2 seconds for user-initiated conversations
- **NFR-002**: Character state updates MUST complete within 500ms without blocking UI
- **NFR-003**: Character image loading MUST complete within 1 second for cached assets
- **NFR-008**: Home screen greeting generation MUST occur exactly once per page load (when character state is ready), prevent duplicate or frequent requests through proper React hook dependencies and ref flags - ensures optimal performance and avoids unnecessary API calls

#### Scalability

- **NFR-004**: System MUST support conversation history storage for at least 1 year of daily interactions (estimated 365 conversations × 10 messages = 3,650 messages)
- **NFR-005**: System MUST support multiple character configurations (future extensibility for multiple characters)

#### Reliability

- **NFR-006**: System MUST gracefully handle AI service failures by falling back to predefined dialogue templates
- **NFR-007**: System MUST preserve conversation history and character state even if app is closed unexpectedly

#### Privacy & Security

- **NFR-008**: System MUST store all conversation data locally in IndexedDB (no cloud sync required)
- **NFR-009**: System MUST allow users to delete conversation history and reset character state
- **NFR-010**: System MUST not share conversation content or character state with external services (privacy-first design)

### Constraints

- **CON-001**: Character is 2D anime male character (not 3D, not female, not realistic)
- **CON-002**: Conversation system is primarily for emotional support, NOT for functional task completion (functional modules remain independent)
- **CON-003**: Choice-based dialogue is very limited (occasional use, not primary interaction method)
- **CON-004**: Character state influences dialogue but does NOT restrict functional access
- **CON-005**: All character assets and configuration must be configurable (not hardcoded) to support i18n and future customization

### Edge Cases

- **EC-001**: User opens app for first time → Character greets with initial introduction dialogue, closeness level starts at 0
- **EC-002**: User has not interacted for 7+ days → Character initiates conversation with gentle reconnection dialogue, acknowledges absence without judgment
- **EC-003**: AI service unavailable → System falls back to predefined dialogue templates based on character state
- **EC-004**: User deletes conversation history → Character state resets to initial values, but user can choose to preserve closeness level
- **EC-005**: User switches language → Character dialogue and UI elements update, but character images remain unchanged
- **EC-006**: Character state reaches maximum closeness → System continues to support interaction, closeness level caps but relationship continues to evolve
- **EC-007**: User expresses negative emotions repeatedly → Character responds with increased empathy and may suggest emotional support resources, but does not become pushy

## Data Model

### Character State

```typescript
interface CharacterState {
  id: string; // Character identifier (e.g., "baiqi")
  closeness: number; // 0-100, increases with interaction
  mood: CharacterMood; // "happy" | "calm" | "concerned" | "energetic" | "tired"
  energy: "low" | "medium" | "high";
  lastInteractionTime: Date;
  totalInteractions: number;
  relationshipStage: "stranger" | "acquaintance" | "friend" | "close_friend" | "intimate";
}
```

### Conversation Message

```typescript
interface ConversationMessage {
  id: string;
  timestamp: Date;
  sender: "character" | "user";
  content: string;
  messageType: "text" | "image" | "choice_prompt";
  choices?: string[]; // For choice-based dialogue
  characterImageUrl?: string; // For embedded character illustrations
  context?: {
    mood: CharacterMood;
    closeness: number;
    timeOfDay: string;
  };
}
```

### Character Configuration

```typescript
interface CharacterConfig {
  id: string;
  name: Record<string, string>; // i18n: { "en": "Bai Qi", "zh": "白起" }
  avatarUrl: string;
  illustrationUrls: {
    default: string;
    happy: string;
    calm: string;
    concerned: string;
    // ... mood variants
  };
  dialogueTemplates: {
    greetings: Record<string, string[]>; // time-of-day → dialogue options
    responses: Record<string, string[]>; // emotion → dialogue options
    proactive: Record<string, string[]>; // trigger → dialogue options
  };
  stateThresholds: {
    closenessStages: Record<string, number>; // stage → min closeness
    moodInfluences: Record<string, Record<string, number>>; // mood → dialogue tone modifiers
  };
}
```

## Interaction Types

### 1. Proactive Greeting
- **Trigger**: App open, time-based (morning/evening), after inactivity period
- **Example**: "Good morning! How are you feeling today?" (closeness: 30, morning)
- **State Influence**: Higher closeness → more personal greetings, lower energy → gentler tone

### 2. Emotional Support Dialogue
- **Trigger**: User expresses emotion, user initiates conversation about feelings
- **Example**: User: "I'm feeling stressed" → Character: "I understand. Would you like to talk about what's bothering you? I'm here for you." (mood: concerned, closeness: 50)
- **State Influence**: Higher closeness → more intimate support, mood affects empathy level

### 3. Activity Suggestion
- **Trigger**: Time-based (meal times), pattern detection (inactive health logging), user asks for suggestions
- **Example**: "It's lunch time! Would you like to log what you're eating together?" (time-of-day: noon, energy: medium)
- **State Influence**: Higher closeness → more casual suggestions, lower energy → gentler prompts

### 4. Acknowledgment & Encouragement
- **Trigger**: User completes activity in functional module, user returns to conversation after action
- **Example**: "I saw you logged your symptoms today. That's really good - taking care of yourself is important." (closeness: 40, mood: happy)
- **State Influence**: Higher closeness → more personal acknowledgments, mood affects enthusiasm

### 5. Choice-Based Dialogue (Limited)
- **Trigger**: Occasional, for important emotional moments or relationship milestones
- **Example**: Character: "How are you feeling about our conversation today?" → Choices: ["Great, thank you", "It helped", "I'm still processing"]
- **State Influence**: Higher closeness → more personal choices, mood affects choice options

## Sample Dialogue Snippets

### Morning Greeting (Closeness: 30, Morning, Mood: Calm)
- Character: "Good morning! I hope you slept well. Ready to start the day together?"
- User: "Morning! I'm a bit tired."
- Character: "That's okay. Sometimes we need a gentle start. Would you like to check in with how you're feeling today?"

### Emotional Support (Closeness: 50, Evening, Mood: Concerned)
- User: "I've been feeling lonely lately."
- Character: "I'm here with you. Loneliness can be really hard. Would it help to talk about what's been on your mind?"
- User: "I just feel like no one understands."
- Character: "I understand, and I want you to know that your feelings are valid. We can work through this together, one step at a time."

### Activity Suggestion (Closeness: 40, Noon, Energy: Medium)
- Character: "It's lunch time! I was wondering - have you eaten yet? We could log your meal together if you'd like."
- User: "Not yet, but I'm planning to."
- Character: "That sounds good! When you're ready, I'll be here to help you record it. What are you thinking of having?"

## Configurable vs Hardcoded

### Configurable (Assets & Data)
- Character name (i18n)
- All dialogue text (character and user prompts)
- Character profile pictures and full illustrations
- Background imagery (cityscape, floral overlays) for different scenes/moods
- Relationship badge values (e.g., closeness level display)
- Footer text ("Contact by phone", "Chat freely")
- Dialogue templates and response patterns
- State thresholds (closeness stages, mood influences)
- Character configuration metadata (JSON/YAML)

### Hardcoded (UI Structure & Core Components)
- Overall layout structure: header, scrollable chat body, footer
- Visual styling of chat bubbles (shapes, default colors, alignment logic)
- Circular design for profile pictures and navigation buttons
- Integration pattern for embedding images within chat bubbles
- General visual effects (transparencies, gradients, shadows)
- Glassmorphism implementation (backdrop-filter: blur, semi-transparent backgrounds, layered card design)
- Transition animations (fade-in, slide-up, scale effects for module entry)
- Interaction logic for sending/receiving messages
- Character state update algorithms
- Proactive initiation timing logic (can be configured but logic is hardcoded)

## Technical Context

**Language/Version**: TypeScript 5.x, React 18.x  
**Primary Dependencies**: 
- React 18.x (UI framework)
- TypeScript 5.x (type safety)
- Tailwind CSS (styling - soft, elegant aesthetic with glassmorphism support: backdrop-filter, semi-transparent backgrounds)
- IndexedDB (via idb for local storage)
- LLM Service Provider: Gemini API via HyperEcho Proxy (for dialogue generation)
- React Router (screen navigation)
- Date-fns (time-of-day awareness)
- CSS backdrop-filter API (for glassmorphism effects)

**Storage**: IndexedDB (local browser storage) for conversation history and character state

**Character Assets**: 
- Configuration: `src/config/characters/` (JSON/YAML files)
- Images: `src/assets/characters/` (avatars, illustrations, backgrounds)
- i18n: `src/i18n/locales/` (dialogue text, character names)

## Out of Scope

- 3D character models or animations
- Voice interaction or text-to-speech
- Multiple companion characters (single character for MVP)
- Cloud sync of conversation history or character state
- Social features (sharing conversations, multiplayer)
- Character customization by user (fixed character design)
- Real-time notifications or push notifications
- Integration with external messaging services
